<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presales Discovery & ROI Tool</title>
    <!-- Document Icon (Favicon) - Simple SVG document icon in base64 -->
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBwdiI+PHBhdGggZD0iTTE1IDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY3WiIvPjxwYXRoIGQ9Ik0xNCAydjRhMiAyIDAgMCAyIDJoNCIvPjxwYXRoIGQ9Ik0xMCA5SDh2NHoiLz48cGF0aCBkPSJNMTYgMTNoNCIvPjxwYXRoGkQ9Ik0xNiAxN2g0Ii8+PC9zdmc+" type="image/svg+xml">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN (for icons like ChevronDown, Calculator, FileText, XCircle, CheckCircle) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles for the app, ensuring Inter font and smooth transitions */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Define a custom Tailwind color for Microsoft Blue for consistency */
        .bg-ms-blue { background-color: #0078D4; }
        .hover\:bg-ms-blue-dark { background-color: #005B9C; }
        .text-ms-blue { color: #0078D4; }
        .border-ms-blue-light { border-color: #A0CBE8; } /* Lighter blue for borders */
        .ring-ms-blue { --tw-ring-color: #0078D4; }

        select, input[type="number"], textarea {
            transition: all 0.2s ease-in-out;
            /* Add subtle shadow for Material Design feel */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        select:focus, input[type="number"]:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.25); /* Focus ring with Microsoft blue tint */
            border-color: #0078D4;
        }
        button {
            transition: all 0.3s ease-in-out;
            /* Larger, more prominent buttons with a stronger shadow */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0.5rem; /* More rounded */
        }
        button:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px); /* Slight lift on hover */
        }

        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 flex flex-col items-center p-4 font-sans text-gray-800">
    <div class="w-full max-w-4xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-ms-blue mb-6">
            Presales Discovery & ROI Tool
        </h1>

        <!-- Module Selection -->
        <div class="mb-8 p-4 bg-blue-100 rounded-lg shadow-md flex flex-col md:flex-row items-center justify-center gap-4">
            <label for="module-select" class="text-lg font-semibold text-blue-800">
                Select Module:
            </label>
            <div class="relative w-full md:w-1/2">
                <select
                    id="module-select"
                    class="block w-full px-4 py-2 pr-8 rounded-md border border-blue-300 bg-white text-gray-900 focus:outline-none focus:ring-2 ring-ms-blue focus:border-transparent appearance-none"
                >
                    <option value="">-- Choose Module --</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-blue-700">
                    <!-- ChevronDown icon from Lucide -->
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>

        <div id="app-content">
            <!-- Content will be dynamically loaded here by JavaScript -->
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 flex flex-col md:flex-row justify-center items-center gap-4">
            <button id="clear-form-button" class="flex items-center bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                Clear Form
            </button>

            <!-- Export Options -->
            <div class="flex flex-col items-center p-4 bg-blue-50 rounded-lg shadow-sm">
                <p class="font-semibold text-blue-800 mb-2">Export As:</p>
                <div class="flex gap-4">
                    <label class="inline-flex items-center">
                        <input type="radio" name="export-format" value="md" checked class="form-radio text-ms-blue">
                        <span class="ml-2 text-gray-700">Markdown (.md)</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="export-format" value="txt" class="form-radio text-ms-blue">
                        <span class="ml-2 text-gray-700">Plain Text (.txt)</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="export-format" value="html" class="form-radio text-ms-blue">
                        <span class="ml-2 text-gray-700">HTML (.html)</span>
                    </label>
                </div>
                <button id="export-data-button" class="flex items-center bg-ms-blue hover:bg-ms-blue-dark text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 ring-ms-blue focus:ring-offset-2 mt-4">
                    <!-- FileText icon from Lucide -->
                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5l2 2h4a2 2 0 012 2v10a2 2 0 01-2 2z"></path></svg>
                    Export Data
                </button>
            </div>
        </div>

        <!-- Export Success Message -->
        <div id="export-success-message" class="hidden mt-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-md flex items-center" role="alert">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>Data exported successfully!</span>
        </div>
        
        <!-- Copy to ROI Success Message -->
        <div id="copy-success-message" class="hidden mt-4 bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg shadow-md flex items-center" role="alert">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7l3-3m-3 0l-3 3m-3-3h6"></path></svg>
            <span>Values copied to ROI Calculator!</span>
        </div>

        <!-- Validation Error Message -->
        <div id="validation-error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-md mb-4 flex items-center justify-between" role="alert">
            <div class="flex items-center">
                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span>Please ensure all required fields are filled, especially for ROI calculation.</span>
            </div>
            <button id="close-validation-error" class="ml-4 text-red-700 hover:text-red-900">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </button>
        </div>
    </div>

    <!-- Clear Form Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content">
            <p class="text-lg font-semibold mb-4">Are you sure you want to clear the form?</p>
            <div class="flex justify-center gap-4">
                <button id="confirm-clear-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-all duration-300">OK</button>
                <button id="cancel-clear-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-5 rounded-lg shadow-md transition-all duration-300">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Copyright Notice -->
    <footer class="mt-8 text-gray-500 text-sm">
        (c) Brad Whatman 2025
    </footer>

    <script>
        // Define modules and their discovery questions
        const eskerModules = {
            'Accounts Receivable': {
                questions: [
                    { id: 'ar1', text: 'How many invoices do you issue per month? (Per Month)', type: 'number' },
                    { id: 'ar2', text: 'What is your average invoice value? (Currency)', type: 'number' },
                    { id: 'ar3', text: 'What is your current DSO (Days Sales Outstanding)? (Days)', type: 'number' },
                    { id: 'ar4', text: 'What percentage of invoices are paid on time? (Percentage)', type: 'number' },
                    { id: 'ar5', text: 'What challenges do you face with cash application? (Text Response)', type: 'textarea' },
                    { id: 'ar6', text: 'How do you currently handle customer disputes? (Text Response)', type: 'textarea' },
                    { id: 'ar7', text: 'Do you use a customer portal for payments/inquiries? If so, describe. (Text Response)', type: 'textarea' },
                    { id: 'ar8', text: 'How many staff are involved in AR processes (full-time equivalents)? (FTEs)', type: 'number' },
                    { id: 'ar9', text: 'What is the average time spent on follow-up calls/emails per invoice (in minutes)? (Minutes) (Per Invoice)', type: 'number' },
                    { id: 'ar10', text: 'What is your current bad debt percentage? (Percentage)', type: 'number' },
                    { id: 'ar11', text: 'What is your current process for credit management and risk assessment? (Text Response)', type: 'textarea' },
                    { id: 'ar12', text: 'How do you onboard new customers from an AR perspective? (Text Response)', type: 'textarea' },
                    { id: 'ar13', text: 'What is your current method for sending invoices (e.g., email, postal mail, EDI)? (Text Response)', type: 'textarea' },
                    { id: 'ar14', text: 'How do you track and manage payment promises? (Text Response)', type: 'textarea' },
                    { id: 'ar15', text: 'What reporting and analytics do you currently use for AR performance? (Text Response)', type: 'textarea' },
                    { id: 'ar16', text: 'Are there any specific compliance requirements for your invoicing process? (Text Response)', type: 'textarea' },
                    { id: 'ar17', text: 'How do you handle multi-currency invoices? (Text Response)', type: 'textarea' },
                    { id: 'ar18', text: 'What is the biggest pain point in your current AR process? (Text Response)', type: 'textarea' },
                    { id: 'ar19', text: 'What systems are currently integrated with your AR process (e.g., ERP, CRM)? (Text Response)', type: 'textarea' },
                    { id: 'ar20', text: 'What are your goals for improving your AR process? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_ar1', text: 'Average cost to manually process one invoice ($) (Per Invoice)', type: 'number' },
                    { id: 'roi_ar2', text: 'Number of full-time employees (FTEs) dedicated to AR collections (FTEs)', type: 'number' },
                    { id: 'roi_ar3', text: 'Average annual salary + benefits for AR staff ($) (Annual)', type: 'number' },
                    { id: 'roi_ar4_current_manual_intervention_pct', text: 'Current percentage of invoices requiring manual intervention (%)', type: 'number' },
                    { id: 'roi_ar4_target_manual_intervention_pct', text: 'Target percentage of invoices requiring manual intervention (%)', type: 'number' },
                    { id: 'roi_ar5', text: 'Current annual cost of printing, postage, and archiving invoices ($) (Annual)', type: 'number' },
                    { id: 'roi_ar6', text: 'Number of customer disputes (Monthly)', type: 'number' },
                    { id: 'roi_ar7', text: 'Average time spent resolving one dispute (Hours) (Per Dispute)', type: 'number' },
                    { id: 'roi_ar8', text: 'Cost of capital (annual interest rate for outstanding receivables, %) (Percentage)', type: 'number' },
                    { id: 'roi_ar9', text: 'Average annual bad debt write-offs ($) (Annual)', type: 'number' },
                    { id: 'roi_ar10', text: 'Annual volume of invoices issued (Annual)', type: 'number' },
                ],
            },
            'Order Management': {
                questions: [
                    { id: 'om1', text: 'How many sales orders do you process per month? (Per Month)', type: 'number' },
                    { id: 'om2', text: 'What is your average order value? (Currency)', type: 'number' },
                    { id: 'om3', text: 'What percentage of orders are received manually (e.g., phone, fax, email)? (Percentage)', type: 'number' },
                    { id: 'om4', text: 'What is your average order processing time (from receipt to fulfilment)? (Days)', type: 'number' },
                    { id: 'om5', text: 'What challenges do you face with order entry accuracy? (Text Response)', type: 'textarea' },
                    { id: 'om6', text: 'How do you currently handle order changes or cancellations? (Text Response)', type: 'textarea' },
                    { id: 'om7', text: 'Do you have a customer self-service portal for order placement or tracking? If so, describe. (Text Response)', type: 'textarea' },
                    { id: 'om8', text: 'How many staff are involved in Order Management processes (full-time equivalents)? (FTEs)', type: 'number' },
                    { id: 'om9', text: 'What is the average time spent on order status inquiries (in minutes)? (Minutes) (Per Inquiry)', type: 'number' },
                    { id: 'om10', text: 'What is your current order error rate? (Percentage)', type: 'number' },
                    { id: 'om11', text: 'How do you manage pricing and discounts for orders? (Text Response)', type: 'textarea' },
                    { id: 'om12', text: 'What is your process for managing backorders and partial shipments? (Text Response)', type: 'textarea' },
                    { id: 'om13', text: 'How do you integrate with your warehouse or logistics partners? (Text Response)', type: 'textarea' },
                    { id: 'om14', text: 'What reporting and analytics do you currently use for OM performance? (Text Response)', type: 'textarea' },
                    { id: 'om15', text: 'Are there any specific compliance requirements for your order processing? (Text Response)', type: 'textarea' },
                    { id: 'om16', text: 'How do you handle multi-currency orders? (Text Response)', type: 'textarea' },
                    { id: 'om17', text: 'What is the biggest pain point in your current Order Management process? (Text Response)', type: 'textarea' },
                    { id: 'om18', text: 'What systems are currently integrated with your OM process (e.g., ERP, CRM, WMS)? (Text Response)', type: 'textarea' },
                    { id: 'om19', text: 'What are your goals for improving your Order Management process? (Text Response)', type: 'textarea' },
                    { id: 'om20', text: 'How do you manage customer credit limits during the order process? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_om1', text: 'Average cost to manually process one sales order ($) (Per Order)', type: 'number' },
                    { id: 'roi_om2', text: 'Number of full-time employees (FTEs) dedicated to order entry and processing (FTEs)', type: 'number' },
                    { id: 'roi_om3', text: 'Average annual salary + benefits for OM staff ($) (Annual)', type: 'number' },
                    { id: 'roi_om4_current_manual_entry_pct', text: 'Current percentage of orders requiring manual data entry (%)', type: 'number' },
                    { id: 'roi_om4_target_manual_entry_pct', text: 'Target percentage of orders requiring manual data entry (%)', type: 'number' },
                    { id: 'roi_om5', text: 'Average cost of correcting an order error ($) (Per Error)', type: 'number' },
                    { id: 'roi_om6', text: 'Number of order errors (Monthly)', type: 'number' },
                    { id: 'roi_om8', text: 'Annual volume of sales orders processed (Annual)', type: 'number' },
                    { id: 'roi_om9', text: 'Average revenue per order ($) (Per Order)', type: 'number' },
                    { id: 'roi_om10', text: 'Current order cycle time (Days) (Days)', type: 'number' },
                ],
            },
            'Collections Management': {
                questions: [
                    { id: 'cm1', text: 'What is your current collection effectiveness index (CEI)? (Index Value)', type: 'number' },
                    { id: 'cm2', text: 'How many collection calls/emails do you make per day/week? (Per Day/Week)', type: 'number' },
                    { id: 'cm3', text: 'What percentage of overdue invoices require manual follow-up? (Percentage)', type: 'number' },
                    { id: 'cm4', text: 'How do you prioritise collection activities? (Text Response)', type: 'textarea' },
                    { id: 'cm5', text: 'What tools do you use for collections (e.g., spreadsheets, ERP module)? (Text Response)', type: 'textarea' },
                    { id: 'cm6', text: 'How do you handle payment promises and broken promises? (Text Response)', type: 'textarea' },
                    { id: 'cm7', text: 'What is your average time to resolve a collection dispute? (Days)', type: 'number' },
                    { id: 'cm8', text: 'How many FTEs are dedicated to collections? (FTEs)', type: 'number' },
                    { id: 'cm9', text: 'What is your current write-off rate for uncollectible debt? (Percentage)', type: 'number' },
                    { id: 'cm10', text: 'How do you communicate with customers regarding overdue payments? (Text Response)', type: 'textarea' },
                    { id: 'cm11', text: 'Do you use dunning letters? If so, what is the process? (Text Response)', type: 'textarea' },
                    { id: 'cm12', text: 'How do you escalate overdue accounts? (Text Response)', type: 'textarea' },
                    { id: 'cm13', text: 'What reporting do you have on collection performance? (Text Response)', type: 'textarea' },
                    { id: 'cm14', text: 'Are there any specific compliance requirements for your collections process? (Text Response)', type: 'textarea' },
                    { id: 'cm15', text: 'How do you manage customer relationships during collections? (Text Response)', type: 'textarea' },
                    { id: 'cm16', text: 'What is the biggest challenge in your current collections process? (Text Response)', type: 'textarea' },
                    { id: 'cm17', text: 'How do you handle partial payments or payment plans? (Text Response)', type: 'textarea' },
                    { id: 'cm18', text: 'What is your process for sending accounts to third-party collections? (Text Response)', type: 'textarea' },
                    { id: 'cm19', text: 'How do you ensure consistency in your collection efforts? (Text Response)', type: 'textarea' },
                    { id: 'cm20', text: 'What are your goals for improving collections efficiency and effectiveness? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_cm1', text: 'Average cost per manual collection activity (call/email) ($) (Per Activity)', type: 'number' },
                    { id: 'roi_cm2', text: 'Number of full-time employees (FTEs) dedicated to collections (FTEs)', type: 'number' },
                    { id: 'roi_cm3', text: 'Average annual salary + benefits for collections staff ($) (Annual)', type: 'number' },
                    { id: 'roi_cm4', text: 'Annual volume of overdue invoices requiring follow-up (Annual)', type: 'number' },
                    { id: 'roi_cm5', text: 'Annual bad debt write-offs ($) (Annual)', type: 'number' },
                    { id: 'roi_cm6', text: 'Average value of overdue invoices ($) (Per Invoice)', type: 'number' },
                    { id: 'roi_cm7', text: 'Current DSO (Days Sales Outstanding) (Days)', type: 'number' },
                    { id: 'roi_cm8', text: 'Cost of capital (annual interest rate for outstanding receivables, %) (Percentage)', type: 'number' },
                ],
            },
            'Customer Inquiries': {
                questions: [
                    { id: 'ci1', text: 'How many customer enquiries (e.g., invoice, order status) do you receive per day/week? (Per Day/Week)', type: 'number' },
                    { id: 'ci2', text: 'What is the average time to resolve a customer enquiry (in minutes)? (Minutes) (Per Enquiry)', type: 'number' },
                    { id: 'ci3', text: 'What channels do customers use to submit enquiries (e.g., phone, email, portal)? (Text Response)', type: 'textarea' },
                    { id: 'ci4', text: 'What percentage of enquiries require manual research across multiple systems? (Percentage)', type: 'number' },
                    { id: 'ci5', text: 'How many FTEs are dedicated to handling customer enquiries? (FTEs)', type: 'number' },
                    { id: 'ci6', text: 'What is your current customer satisfaction (CSAT) score related to enquiry resolution? (Score)', type: 'number' },
                    { id: 'ci7', text: 'How do you track and report on enquiry volumes and resolution times? (Text Response)', type: 'textarea' },
                    { id: 'ci8', text: 'What are the most common types of customer enquiries you receive? (Text Response)', type: 'textarea' },
                    { id: 'ci9', text: 'Do you have a knowledge base or FAQ for customers? (Text Response)', type: 'textarea' },
                    { id: 'ci10', text: 'How do you escalate complex enquiries? (Text Response)', type: 'textarea' },
                    { id: 'ci11', text: 'What systems do your enquiry agents access to resolve issues? (Text Response)', type: 'textarea' },
                    { id: 'ci12', text: 'How do you handle enquiries outside of business hours? (Text Response)', type: 'textarea' },
                    { id: 'ci13', text: 'What is the biggest pain point in your current enquiry process? (Text Response)', type: 'textarea' },
                    { id: 'ci14', text: 'How do you ensure consistent responses to common enquiries? (Text Response)', type: 'textarea' },
                    { id: 'ci15', text: 'What training do your staff receive for handling enquiries? (Text Response)', type: 'textarea' },
                    { id: 'ci16', text: 'Do you have self-service options for customers to find answers? (Text Response)', type: 'textarea' },
                    { id: 'ci17', text: 'How do you measure the efficiency of your enquiry handling? (Text Response)', type: 'textarea' },
                    { id: 'ci18', text: 'What is the impact of unresolved enquiries on customer relationships? (Text Response)', type: 'textarea' },
                    { id: 'ci19', text: 'How do you manage communication with customers during the enquiry resolution process? (Text Response)', type: 'textarea' },
                    { id: 'ci20', text: 'What are your goals for improving customer enquiry handling? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_ci1', text: 'Average cost per manual enquiry resolution ($) (Per Enquiry)', type: 'number' },
                    { id: 'roi_ci2', text: 'Number of full-time employees (FTEs) dedicated to customer enquiries (FTEs)', type: 'number' },
                    { id: 'roi_ci3', text: 'Average annual salary + benefits for enquiry staff ($) (Annual)', type: 'number' },
                    { id: 'roi_ci4', text: 'Annual volume of customer enquiries (Annual)', type: 'number' },
                    { id: 'roi_ci5_current_fcr_pct', text: 'Current First Contact Resolution (FCR) percentage (%)', type: 'number' },
                    { id: 'roi_ci5_target_fcr_pct', text: 'Target First Contact Resolution (FCR) percentage (%)', type: 'number' },
                    { id: 'roi_ci6', text: 'Average time spent on each enquiry (Minutes) (Per Enquiry)', type: 'number' },
                    { id: 'roi_ci7', text: 'Cost of lost customer due to poor service ($) (Annual)', type: 'number' },
                ],
            },
            'Cash Application': {
                questions: [
                    { id: 'ca1', text: 'How many payments do you receive per day/week? (Per Day/Week)', type: 'number' },
                    { id: 'ca2', text: 'What percentage of payments are received via cheque/manual methods? (Percentage)', type: 'number' },
                    { id: 'ca3', text: 'What is the average time to apply a payment (in minutes)? (Minutes) (Per Payment)', type: 'number' },
                    { id: 'ca4', text: 'What percentage of payments are unapplied or suspense items? (Percentage)', type: 'number' },
                    { id: 'ca5', text: 'How do you handle remittances without clear invoice matching? (Text Response)', type: 'textarea' },
                    { id: 'ca6', text: 'How many FTEs are dedicated to cash application? (FTEs)', type: 'number' },
                    { id: 'ca7', text: 'What systems are involved in your cash application process? (Text Response)', type: 'textarea' },
                    { id: 'ca8', text: 'How do you resolve payment discrepancies or short payments? (Text Response)', type: 'textarea' },
                    { id: 'ca9', text: 'What is your current reconciliation process for bank statements and applied cash? (Text Response)', type: 'textarea' },
                    { id: 'ca10', text: 'How do you manage lockbox services, if applicable? (Text Response)', type: 'textarea' },
                    { id: 'ca11', text: 'What is the biggest pain point in your current cash application process? (Text Response)', type: 'textarea' },
                    { id: 'ca12', text: 'How quickly are payments reflected in customer accounts? (Text Response)', type: 'textarea' },
                    { id: 'ca13', text: 'What reporting do you have on cash application accuracy and efficiency? (Text Response)', type: 'textarea' },
                    { id: 'ca14', text: 'Do you use any automation for cash application today? (Text Response)', type: 'textarea' },
                    { id: 'ca15', text: 'How do you handle multi-currency payments? (Text Response)', type: 'textarea' },
                    { id: 'ca16', text: 'What is the volume of customer deductions or chargebacks you process? (Volume)', type: 'number' },
                    { id: 'ca17', text: 'How do you ensure data security and compliance in cash application? (Text Response)', type: 'textarea' },
                    { id: 'ca18', text: 'What impact does slow cash application have on your DSO or credit limits? (Text Response)', type: 'textarea' },
                    { id: 'ca19', text: 'How do you communicate with customers about payment application issues? (Text Response)', type: 'textarea' },
                    { id: 'ca20', text: 'What are your goals for improving cash application speed and accuracy? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_ca1', text: 'Average cost to manually apply one payment ($) (Per Payment)', type: 'number' },
                    { id: 'roi_ca2', text: 'Number of full-time employees (FTEs) dedicated to cash application (FTEs)', type: 'number' },
                    { id: 'roi_ca3', text: 'Average annual salary + benefits for cash application staff ($) (Annual)', type: 'number' },
                    { id: 'roi_ca4', text: 'Annual volume of payments received (Annual)', type: 'number' },
                    { id: 'roi_ca5_current_manual_intervention_pct', text: 'Current percentage of payments requiring manual intervention (%)', type: 'number' },
                    { id: 'roi_ca5_target_manual_intervention_pct', text: 'Target percentage of payments requiring manual intervention (%)', type: 'number' },
                    { id: 'roi_ca6', text: 'Average time spent resolving unapplied cash (Hours) (Per Unapplied Item)', type: 'number' },
                    { id: 'roi_ca7', text: 'Annual value of unapplied cash ($) (Annual)', type: 'number' },
                    { id: 'roi_ca8', text: 'Cost of capital (annual interest rate for outstanding receivables, %) (Percentage)', type: 'number' },
                ],
            },
            'Credit Management': {
                questions: [
                    { id: 'crm1', text: 'How many new credit applications do you process per month? (Per Month)', type: 'number' },
                    { id: 'crm2', text: 'What is your average time to approve/deny a credit application? (Days)', type: 'number' },
                    { id: 'crm3', text: 'What sources of information do you use for credit assessment (e.g., D&B, trade references)? (Text Response)', type: 'textarea' },
                    { id: 'crm4', text: 'How do you set and manage customer credit limits? (Text Response)', type: 'textarea' },
                    { id: 'crm5', text: 'What percentage of credit applications require manual review and approval? (Percentage)', type: 'number' },
                    { id: 'crm6', text: 'How many FTEs are dedicated to credit management? (FTEs)', type: 'number' },
                    { id: 'crm7', text: 'What is your current bad debt rate? (Percentage)', type: 'number' },
                    { id: 'crm8', text: 'How do you monitor customer credit risk on an ongoing basis? (Text Response)', type: 'textarea' },
                    { id: 'crm9', text: 'How do you process for reviewing and adjusting existing credit limits? (Text Response)', type: 'textarea' },
                    { id: 'crm10', text: 'How do you communicate credit decisions to customers? (Text Response)', type: 'textarea' },
                    { id: 'crm11', text: 'What is the biggest pain point in your current credit management process? (Text Response)', type: 'textarea' },
                    { id: 'crm12', text: 'How do credit decisions impact sales cycles? (Text Response)', type: 'textarea' },
                    { id: 'crm13', text: 'What reporting do you have on credit risk and exposure? (Text Response)', type: 'textarea' },
                    { id: 'crm14', text: 'Do you have a consistent credit policy across all customers/regions? (Text Response)', type: 'textarea' },
                    { id: 'crm15', text: 'How do you handle credit holds or blocked orders? (Text Response)', type: 'textarea' },
                    { id: 'crm16', text: 'What systems are integrated with your credit management process? (Text Response)', type: 'textarea' },
                    { id: 'crm17', text: 'How do you manage credit insurance, if applicable? (Text Response)', type: 'textarea' },
                    { id: 'crm18', text: 'What is the impact of manual credit checks on operational efficiency? (Text Response)', type: 'textarea' },
                    { id: 'crm19', text: 'How do you ensure compliance with credit regulations? (Text Response)', type: 'textarea' },
                    { id: 'crm20', text: 'What are your goals for improving credit decision speed and risk mitigation? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_crm1', text: 'Average cost to manually process one credit application ($) (Per Application)', type: 'number' },
                    { id: 'roi_crm2', text: 'Number of full-time employees (FTEs) dedicated to credit management (FTEs)', type: 'number' },
                    { id: 'roi_crm3', text: 'Average annual salary + benefits for credit staff ($) (Annual)', type: 'number' },
                    { id: 'roi_crm4', text: 'Annual volume of new credit applications (Annual)', type: 'number' },
                    { id: 'roi_crm5', text: 'Average time spent on manual credit review (Hours) (Per Review)', type: 'number' },
                    { id: 'roi_crm6', text: 'Annual bad debt write-offs ($) (Annual)', type: 'number' },
                    { id: 'roi_crm7', text: 'Cost of lost sales due to slow credit decisions ($) (Annual)', type: 'number' },
                ],
            },
            'Procurement': {
                questions: [
                    { id: 'p1', text: 'How many purchase requisitions do you process per month? (Per Month)', type: 'number' },
                    { id: 'p2', text: 'What is your average purchase order value? (Currency)', type: 'number' },
                    { id: 'p3', text: 'What percentage of purchases are made off-contract or through "maverick spend"? (Percentage)', type: 'number' },
                    { id: 'p4', text: 'What is your average requisition-to-PO cycle time (in days)? (Days)', type: 'number' },
                    { id: 'p5', text: 'What challenges do you face with manual purchase order creation and approval? (Text Response)', type: 'textarea' },
                    { id: 'p6', text: 'How do you manage supplier catalogues and pricing? (Text Response)', type: 'textarea' },
                    { id: 'p7', text: 'How many staff are involved in the procurement process (from requisition to PO)? (FTEs)', type: 'number' },
                    { id: 'p8', text: 'What is your current PO error rate? (Percentage)', type: 'number' },
                    { id: 'p9', text: 'How do you handle purchase order changes or cancellations? (Text Response)', type: 'textarea' },
                    { id: 'p10', text: 'What systems are currently integrated with your procurement process (e.g., ERP, inventory)? (Text Response)', type: 'textarea' },
                    { id: 'p11', text: 'What is the biggest pain point in your current procurement process? (Text Response)', type: 'textarea' },
                    { id: 'p12', text: 'How do you ensure compliance with procurement policies and regulations? (Text Response)', type: 'textarea' },
                    { id: 'p13', text: 'What reporting and analytics do you use for procurement performance? (Text Response)', type: 'textarea' },
                    { id: 'p14', text: 'How do you manage non-PO based invoices? (Text Response)', type: 'textarea' },
                    { id: 'p15', text: 'Do you have a centralised purchasing function? (Text Response)', type: 'textarea' },
                    { id: 'p16', text: 'How do you track savings generated by procurement initiatives? (Text Response)', type: 'textarea' },
                    { id: 'p17', text: 'What is your process for managing goods receipt and invoice matching? (Text Response)', type: 'textarea' },
                    { id: 'p18', text: 'How do you onboard new suppliers from a procurement perspective? (Text Response)', type: 'textarea' },
                    { id: 'p19', text: 'What is the impact of manual procurement on budget control? (Text Response)', type: 'textarea' },
                    { id: 'p20', text: 'What are your goals for improving procurement efficiency and cost savings? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_p1', text: 'Average cost to manually process one purchase order ($) (Per PO)', type: 'number' },
                    { id: 'roi_p2', text: 'Number of full-time employees (FTEs) dedicated to procurement (FTEs)', type: 'number' },
                    { id: 'roi_p3', text: 'Average annual salary + benefits for procurement staff ($) (Annual)', type: 'number' },
                    { id: 'roi_p4', text: 'Annual volume of purchase orders (Annual)', type: 'number' },
                    { id: 'roi_p5_current_maverick_spend_pct', text: 'Current percentage of "maverick spend" (%)', type: 'number' },
                    { id: 'roi_p5_target_maverick_spend_pct', text: 'Target percentage of "maverick spend" (%)', type: 'number' },
                    { id: 'roi_p6', text: 'Average time spent on manual PO approval (Hours) (Per PO)', type: 'number' },
                    { id: 'roi_p7', text: 'Annual cost of PO errors ($) (Annual)', type: 'number' },
                    { id: 'roi_p8', text: 'Total annual spend ($) (Annual)', type: 'number' },
                ],
            },
            'Supplier Management': {
                questions: [
                    { id: 'sm1', text: 'How many active suppliers do you manage? (Number)', type: 'number' },
                    { id: 'sm2', text: 'What is your average time to onboard a new supplier? (Days)', type: 'number' },
                    { id: 'sm3', text: 'How do you collect and maintain supplier information (e.g., banking, certifications)? (Text Response)', type: 'textarea' },
                    { id: 'sm4', text: 'How do you assess and monitor supplier performance? (Text Response)', type: 'textarea' },
                    { id: 'sm5', text: 'What challenges do you face with supplier communication and collaboration? (Text Response)', type: 'textarea' },
                    { id: 'sm6', text: 'How do you manage supplier contracts and renewals? (Text Response)', type: 'textarea' },
                    { id: 'sm7', text: 'How many FTEs are involved in supplier management activities? (FTEs)', type: 'number' },
                    { id: 'sm8', text: 'What is your current process for supplier risk assessment? (Text Response)', type: 'textarea' },
                    { id: 'sm9', text: 'How do you handle supplier disputes or issues? (Text Response)', type: 'textarea' },
                    { id: 'sm10', text: 'What systems do you use for supplier management? (Text Response)', type: 'textarea' },
                    { id: 'sm11', text: 'What is the biggest pain point in your current supplier management process? (Text Response)', type: 'textarea' },
                    { id: 'sm12', text: 'How do you ensure compliance with supplier diversity initiatives? (Text Response)', type: 'textarea' },
                    { id: 'sm13', text: 'What reporting do you have on supplier performance and compliance? (Text Response)', type: 'textarea' },
                    { id: 'sm14', text: 'How do you manage supplier master data accuracy? (Text Response)', type: 'textarea' },
                    { id: 'sm15', text: 'Do you have a supplier portal? If so, describe its functionality. (Text Response)', type: 'textarea' },
                    { id: 'sm16', text: 'How do you handle supplier enquiries regarding payments or POs? (Text Response)', type: 'textarea' },
                    { id: 'sm17', text: 'What is the impact of poor supplier data quality? (Text Response)', type: 'textarea' },
                    { id: 'sm18', text: 'How do you manage supplier segmentation? (Text Response)', type: 'textarea' },
                    { id: 'sm19', text: 'What is your process for offboarding suppliers? (Text Response)', type: 'textarea' },
                    { id: 'sm20', text: 'What are your goals for improving supplier relationships and compliance? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_sm1', text: 'Average cost to manually onboard one supplier ($) (Per Supplier)', type: 'number' },
                    { id: 'roi_sm2', text: 'Number of full-time employees (FTEs) dedicated to supplier management (FTEs)', type: 'number' },
                    { id: 'roi_sm3', text: 'Average annual salary + benefits for supplier management staff ($) (Annual)', type: 'number' },
                    { id: 'roi_sm4', text: 'Annual volume of new supplier onboarding (Annual)', type: 'number' },
                    { id: 'roi_sm5', text: 'Average time spent on manual supplier data entry (Hours) (Per Supplier)', type: 'number' },
                    { id: 'roi_sm6', text: 'Annual cost of supplier non-compliance issues ($) (Annual)', type: 'number' },
                    { id: 'roi_sm7_current_inaccurate_data_pct', text: 'Current percentage of suppliers with incomplete or inaccurate data (%)', type: 'number' },
                    { id: 'roi_sm7_target_inaccurate_data_pct', text: 'Target percentage of suppliers with incomplete or inaccurate data (%)', type: 'number' },
                ],
            },
            'Sourcing': {
                questions: [
                    { id: 's1', text: 'How many sourcing events (RFQs, RFPs) do you conduct per month/year? (Per Month/Year)', type: 'number' },
                    { id: 's2', text: 'What is your average sourcing cycle time (from need identification to contract award)? (Days)', type: 'number' },
                    { id: 's3', text: 'How do you identify potential suppliers for sourcing events? (Text Response)', type: 'textarea' },
                    { id: 's4', text: 'What tools do you use for managing sourcing events (e.g., email, spreadsheets, e-sourcing platform)? (Text Response)', type: 'textarea' },
                    { id: 's5', text: 'What challenges do you face with supplier bidding and negotiation? (Text Response)', type: 'textarea' },
                    { id: 's6', text: 'How do you analyse bids and select suppliers? (Text Response)', type: 'textarea' },
                    { id: 's7', text: 'How many FTEs are involved in sourcing activities? (FTEs)', type: 'number' },
                    { id: 's8', text: 'What is your average savings percentage achieved through sourcing events? (Percentage)', type: 'number' },
                    { id: 's9', text: 'How do you manage contract creation and signing after sourcing? (Text Response)', type: 'textarea' },
                    { id: 's10', text: 'What is the biggest pain point in your current sourcing process? (Text Response)', type: 'textarea' },
                    { id: 's11', text: 'How do you ensure transparency and fairness in your sourcing? (Text Response)', type: 'textarea' },
                    { id: 's12', text: 'What reporting do you have on sourcing performance and savings? (Text Response)', type: 'textarea' },
                    { id: 's13', text: 'How do you manage supplier communication during the sourcing process? (Text Response)', type: 'textarea' },
                    { id: 's14', text: 'Do you use reverse auctions or other advanced sourcing techniques? (Text Response)', type: 'textarea' },
                    { id: 's15', text: 'How do you handle multi-currency sourcing events? (Text Response)', type: 'textarea' },
                    { id: 's16', text: 'What is the impact of manual sourcing on time-to-market for new products/services? (Text Response)', type: 'textarea' },
                    { id: 's17', text: 'How do you manage supplier qualifications and compliance during sourcing? (Text Response)', type: 'textarea' },
                    { id: 's18', text: 'What is your process for conducting spend analysis to identify sourcing opportunities? (Text Response)', type: 'textarea' },
                    { id: 's19', text: 'How do you ensure data security for sensitive sourcing information? (Text Response)', type: 'textarea' },
                    { id: 's20', text: 'What are your goals for improving sourcing efficiency and achieving greater savings? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_s1', text: 'Average cost to manually conduct one sourcing event ($) (Per Event)', type: 'number' },
                    { id: 'roi_s2', text: 'Number of full-time employees (FTEs) dedicated to sourcing (FTEs)', type: 'number' },
                    { id: 'roi_s3', text: 'Average annual salary + benefits for sourcing staff ($) (Annual)', type: 'number' },
                    { id: 'roi_s4', text: 'Annual volume of sourcing events (Annual)', type: 'number' },
                    { id: 'roi_s5', text: 'Average sourcing cycle time (Days) (Days)', type: 'number' },
                    { id: 'roi_s6', text: 'Total annual spend under management ($) (Annual)', type: 'number' },
                    { id: 'roi_s7_current_avg_savings_pct', text: 'Current average savings from sourcing (%)', type: 'number' },
                    { id: 'roi_s7_target_avg_savings_pct', text: 'Target average savings from sourcing (%)', type: 'number' },
                ],
            },
            'Claims & Deductions': {
                questions: [
                    { id: 'cd1', text: 'How many customer claims/deductions do you receive per month? (Per Month)', type: 'number' },
                    { id: 'cd2', text: 'What is the average value of a claim/deduction ($)? (Currency)', type: 'number' },
                    { id: 'cd3', text: 'What percentage of claims are invalid or unauthorised? (Percentage)', type: 'number' },
                    { id: 'cd4', text: 'What is your average time to resolve a claim/deduction (in days)? (Days)', type: 'number' },
                    { id: 'cd5', text: 'How do you receive and log claims/deductions? (Text Response)', type: 'textarea' },
                    { id: 'cd6', text: 'How do you research and validate claims? (Text Response)', type: 'textarea' },
                    { id: 'cd7', text: 'How many FTEs are involved in claims and deductions management? (FTEs)', type: 'number' },
                    { id: 'cd8', text: 'What systems are involved in your claims resolution process? (Text Response)', type: 'textarea' },
                    { id: 'cd9', text: 'How do you communicate with customers regarding claim status and resolution? (Text Response)', type: 'textarea' },
                    { id: 'cd10', text: 'What is the biggest pain point in your current claims and deductions process? (Text Response)', type: 'textarea' },
                    { id: 'cd11', text: 'How do you track and report on claim types and root causes? (Text Response)', type: 'textarea' },
                    { id: 'cd12', text: 'What is the impact of unresolved claims on customer relationships and cash flow? (Text Response)', type: 'textarea' },
                    { id: 'cd13', text: 'How do you handle claims related to pricing, promotions, or damaged goods? (Text Response)', type: 'textarea' },
                    { id: 'cd14', text: 'Do you have a formal dispute resolution process for claims? (Text Response)', type: 'textarea' },
                    { id: 'cd15', text: 'How do you recover invalid deductions? (Text Response)', type: 'textarea' },
                    { id: 'cd16', text: 'What is the volume of chargebacks you receive? (Volume)', type: 'number' },
                    { id: 'cd17', text: 'How do you ensure proper documentation for each claim? (Text Response)', type: 'textarea' },
                    { id: 'cd18', text: 'What is the average cost to process one claim/deduction? (Currency) (Per Claim)', type: 'number' },
                    { id: 'cd19', text: 'How do you identify and address recurring claim issues? (Text Response)', type: 'textarea' },
                    { id: 'cd20', text: 'What are your goals for improving claims resolution efficiency and reducing invalid deductions? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_cd1', text: 'Average cost to manually process one claim/deduction ($) (Per Claim)', type: 'number' },
                    { id: 'roi_cd2', text: 'Number of full-time employees (FTEs) dedicated to claims and deductions (FTEs)', type: 'number' },
                    { id: 'roi_cd3', text: 'Average annual salary + benefits for claims staff ($) (Annual)', type: 'number' },
                    { id: 'roi_cd4', text: 'Annual volume of claims/deductions received (Annual)', type: 'number' },
                    { id: 'roi_cd5', text: 'Average time spent resolving one claim (Hours) (Per Claim)', type: 'number' },
                    { id: 'roi_cd6', text: 'Annual value of invalid claims/deductions ($) (Annual)', type: 'number' },
                    { id: 'roi_cd7_current_manual_research_pct', text: 'Current percentage of claims requiring manual research (%)', type: 'number' },
                    { id: 'roi_cd7_target_manual_research_pct', text: 'Target percentage of claims requiring manual research (%)', type: 'number' },
                ],
            },
            'Invoice Delivery': {
                questions: [
                    { id: 'id1', text: 'How many invoices do you deliver per month? (Per Month)', type: 'number' },
                    { id: 'id2', text: 'What percentage of invoices are delivered manually (e.g., postal mail, email attachments)? (Percentage)', type: 'number' },
                    { id: 'id3', text: 'What is your average cost per invoice for printing, postage, and archiving? (Currency) (Per Invoice)', type: 'number' },
                    { id: 'id4', text: 'What is your current invoice delivery success rate? (Percentage)', type: 'number' },
                    { id: 'id5', text: 'How do you handle failed invoice deliveries or rejections? (Text Response)', type: 'textarea' },
                    { id: 'id6', text: 'How many FTEs are involved in invoice delivery activities? (FTEs)', type: 'number' },
                    { id: 'id7', text: 'What channels do you use for invoice delivery (e.g., email, EDI, portal, postal)? (Text Response)', type: 'textarea' },
                    { id: 'id8', text: 'How do you track and confirm invoice receipt by customers? (Text Response)', type: 'textarea' },
                    { id: 'id9', text: 'What challenges do you face with customer preferences for invoice format/delivery method? (Text Response)', type: 'textarea' },
                    { id: 'id10', text: 'What is the biggest pain point in your current invoice delivery process? (Text Response)', type: 'textarea' },
                    { id: 'id11', text: 'How does invoice delivery impact your DSO? (Text Response)', type: 'textarea' },
                    { id: 'id12', text: 'What reporting do you have on invoice delivery status and performance? (Text Response)', type: 'textarea' },
                    { id: 'id13', text: 'How do you ensure compliance with e-invoicing regulations (e.g., Peppol, local mandates)? (Text Response)', type: 'textarea' },
                    { id: 'id14', text: 'How do you handle multi-currency invoices? (Text Response)', type: 'textarea' },
                    { id: 'id15', text: 'What is your process for archiving delivered invoices? (Text Response)', type: 'textarea' },
                    { id: 'id16', text: 'How do you manage customer master data for delivery preferences? (Text Response)', type: 'textarea' },
                    { id: 'id17', text: 'What is the impact of slow or failed invoice delivery on customer satisfaction? (Text Response)', type: 'textarea' },
                    { id: 'id18', text: 'Do you use a customer portal for invoice access? (Text Response)', type: 'textarea' },
                    { id: 'id19', text: 'How do you handle large volumes of invoices efficiently? (Text Response)', type: 'textarea' },
                    { id: 'id20', text: 'What are your goals for improving invoice delivery speed, accuracy, and cost-efficiency? (Text Response)', type: 'textarea' },
                ],
                roiQuestions: [
                    { id: 'roi_id1', text: 'Average cost per invoice for printing, postage, and manual handling ($) (Per Invoice)', type: 'number' },
                    { id: 'roi_id2', text: 'Number of full-time employees (FTEs) involved in invoice delivery (FTEs)', type: 'number' },
                    { id: 'roi_id3', text: 'Average annual salary + benefits for invoice delivery staff ($) (Annual)', type: 'number' },
                    { id: 'roi_id4', text: 'Annual volume of invoices delivered (Annual)', type: 'number' },
                    { id: 'roi_id5_current_manual_intervention_pct', text: 'Current percentage of invoices requiring manual intervention (%)', type: 'number' },
                    { id: 'roi_id5_target_manual_intervention_pct', text: 'Target percentage of invoices requiring manual intervention (%)', type: 'number' },
                    { id: 'roi_id6', text: 'Average time spent resolving failed deliveries (Hours) (Per Failed Delivery)', type: 'number' },
                    { id: 'roi_id7', text: 'Cost of lost early payment discounts due to delayed delivery ($) (Annual)', type: 'number' },
                ],
            },
        };

        // Demo data for ROI calculation fields (excluding annual subscription, professional services, and years utilised)
        const demoRoiData = {
            'Accounts Receivable': {
                roi_ar1: 3.50,
                roi_ar2: 5,
                roi_ar3: 75000,
                roi_ar4_current_manual_intervention_pct: 70,
                roi_ar4_target_manual_intervention_pct: 15,
                roi_ar5: 15000,
                roi_ar6: 50,
                roi_ar7: 2,
                roi_ar8: 5,
                roi_ar9: 50000,
                roi_ar10: 120000,
            },
            'Order Management': {
                roi_om1: 4.00,
                roi_om2: 4,
                roi_om3: 70000,
                roi_om4_current_manual_entry_pct: 65,
                roi_om4_target_manual_entry_pct: 10,
                roi_om5: 25,
                roi_om6: 30,
                roi_om8: 72000,
                roi_om9: 500,
                roi_om10: 5,
            },
            'Collections Management': {
                roi_cm1: 2.00,
                roi_cm2: 3,
                roi_cm3: 65000,
                roi_cm4: 10000,
                roi_cm5: 50000,
                roi_cm6: 1000,
                roi_cm7: 45,
                roi_cm8: 5,
            },
            'Customer Inquiries': {
                roi_ci1: 2.00,
                roi_ci2: 3,
                roi_ci3: 60000,
                roi_ci4: 10000,
                roi_ci5_current_fcr_pct: 60,
                roi_ci5_target_fcr_pct: 85,
                roi_ci6: 15,
                roi_ci7: 10000,
            },
            'Cash Application': {
                roi_ca1: 2.50,
                roi_ca2: 2,
                roi_ca3: 65000,
                roi_ca4: 50000,
                roi_ca5_current_manual_intervention_pct: 50,
                roi_ca5_target_manual_intervention_pct: 5,
                roi_ca6: 4,
                roi_ca7: 200000,
                roi_ca8: 4,
            },
            'Credit Management': {
                roi_crm1: 7.00,
                roi_crm2: 2,
                roi_crm3: 70000,
                roi_crm4: 1000,
                roi_crm5: 2,
                roi_crm6: 75000,
                roi_crm7: 20000,
            },
            'Procurement': {
                roi_p1: 8.00,
                roi_p2: 3,
                roi_p3: 70000,
                roi_p4: 24000,
                roi_p5_current_maverick_spend_pct: 15,
                roi_p5_target_maverick_spend_pct: 5,
                roi_p6: 1,
                roi_p7: 10000,
                roi_p8: 5000000,
            },
            'Supplier Management': {
                roi_sm1: 15.00,
                roi_sm2: 1,
                roi_sm3: 65000,
                roi_sm4: 200,
                roi_sm5: 3,
                roi_sm6: 5000,
                roi_sm7_current_inaccurate_data_pct: 30,
                roi_sm7_target_inaccurate_data_pct: 5,
            },
            'Sourcing': {
                roi_s1: 20.00,
                roi_s2: 2,
                roi_s3: 80000,
                roi_s4: 50,
                roi_s5: 14,
                roi_s6: 10000000,
                roi_s7_current_avg_savings_pct: 2,
                roi_s7_target_avg_savings_pct: 5,
            },
            'Claims & Deductions': {
                roi_cd1: 6.00,
                roi_cd2: 2,
                roi_cd3: 68000,
                roi_cd4: 1200,
                roi_cd5: 1.5,
                roi_cd6: 40000,
                roi_cd7_current_manual_research_pct: 60,
                roi_cd7_target_manual_research_pct: 10,
            },
            'Invoice Delivery': {
                roi_id1: 1.50,
                roi_id2: 1,
                roi_id3: 60000,
                roi_id4: 150000,
                roi_id5_current_manual_intervention_pct: 40,
                roi_id5_target_manual_intervention_pct: 5,
                roi_id6: 0.5,
                roi_id7: 15000,
            },
        };


        // Mapping for copying Discovery Questions to ROI Calculator fields
        const discoveryToRoiMapping = {
            'Accounts Receivable': [
                { discoveryId: 'ar1', roiId: 'roi_ar10', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 12).toFixed(0) }, // Monthly invoices to Annual
                { discoveryId: 'ar3', roiId: 'roi_ar7' }, // DSO (Direct Copy)
                { discoveryId: 'ar8', roiId: 'roi_ar2' }, // FTEs AR (Direct Copy)
            ],
            'Order Management': [
                { discoveryId: 'om1', roiId: 'roi_om8', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 12).toFixed(0) }, // Monthly sales orders to Annual
                { discoveryId: 'om8', roiId: 'roi_om2' }, // FTEs OM (Direct Copy)
            ],
            'Collections Management': [
                { discoveryId: 'cm8', roiId: 'roi_cm2' }, // FTEs Collections (Direct Copy)
                { discoveryId: 'cm7', roiId: 'roi_cm7' }, // DSO Collections (Direct Copy)
            ],
            'Customer Inquiries': [
                { discoveryId: 'ci1', roiId: 'roi_ci4', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 52).toFixed(0) }, // Assuming 'Per Day/Week' implies weekly input * 52 for annual
                { discoveryId: 'ci5', roiId: 'roi_ci2' }, // FTEs Customer Inquiries (Direct Copy)
            ],
            'Cash Application': [
                { discoveryId: 'ca1', roiId: 'roi_ca4', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 52).toFixed(0) }, // Assuming 'Per Day/Week' implies weekly input * 52 for annual
                { discoveryId: 'ca6', roiId: 'roi_ca2' }, // FTEs Cash App (Direct Copy)
            ],
            'Credit Management': [
                { discoveryId: 'crm1', roiId: 'roi_crm4', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 12).toFixed(0) }, // Monthly new credit applications to Annual
                { discoveryId: 'crm6', roiId: 'roi_crm2' }, // FTEs Credit Management (Direct Copy)
            ],
            'Procurement': [
                { discoveryId: 'p1', roiId: 'roi_p4', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 12).toFixed(0) }, // Monthly requisitions to Annual POs
                { discoveryId: 'p7', roiId: 'roi_p2' }, // FTEs Procurement (Direct Copy)
            ],
            'Supplier Management': [
                // No direct, semantically identical mappings that make sense to auto-copy
            ],
            'Sourcing': [
                { discoveryId: 's1', roiId: 'roi_s4' }, // Assuming user inputs Annual volume directly if s1 is numerical and matches 'per year' part
                { discoveryId: 's7', roiId: 'roi_s2' }, // FTEs Sourcing (Direct Copy)
            ],
            'Claims & Deductions': [
                { discoveryId: 'cd1', roiId: 'roi_cd4', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 12).toFixed(0) }, // Monthly claims to Annual
                { discoveryId: 'cd7', roiId: 'roi_cd2' }, // FTEs Claims & Deductions (Direct Copy)
            ],
            'Invoice Delivery': [
                { discoveryId: 'id1', roiId: 'roi_id4', transform: (val) => isNaN(parseFloat(val)) ? '' : (parseFloat(val) * 12).toFixed(0) }, // Monthly invoices delivered to Annual
                { discoveryId: 'id6', roiId: 'roi_id2' }, // FTEs Invoice Delivery (Direct Copy)
            ],
        };

        // State variables (simulated with global variables for simplicity in vanilla JS)
        let selectedModule = '';
        let discoveryAnswers = {};
        let roiAnswers = {};
        let calculatedRoi = null;
        let currentView = 'discovery'; // 'discovery' or 'roi'
        let eskerSubscriptionCost = {}; // Stores annual subscription cost per module
        let eskerProfessionalServicesCost = {}; // Stores upfront professional services cost per module
        let numberOfYearsUtilized = {}; // Stores number of years software will be utilised for
        let additionalDiscoveryNotes = {}; // Stores additional free text notes per module

        // DOM elements
        const moduleSelect = document.getElementById('module-select');
        const appContent = document.getElementById('app-content');
        const exportSuccessMessage = document.getElementById('export-success-message');
        const copySuccessMessage = document.getElementById('copy-success-message'); // New element
        const validationErrorMessage = document.getElementById('validation-error-message');
        const closeValidationErrorButton = document.getElementById('close-validation-error');
        const clearFormButton = document.getElementById('clear-form-button');
        const exportDataButton = document.getElementById('export-data-button');
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmClearButton = document.getElementById('confirm-clear-button');
        const cancelClearButton = document.getElementById('cancel-clear-button');


        // Helper function to render Lucide icons (as SVGs)
        function getLucideIcon(iconName, classes = '') {
            const icon = lucide.createIcons()[iconName];
            if (icon) {
                const svgString = lucide.icons[iconName].toSvg({ class: classes });
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgString, 'image/svg+xml');
                return doc.documentElement;
            }
            return null;
        }

        // Function to render the main app content based on selected module and view
        function renderAppContent() {
            appContent.innerHTML = ''; // Clear previous content

            if (!selectedModule) {
                // Display a message prompting user to select a module
                appContent.innerHTML = `
                    <div class="text-center py-10 text-gray-500 text-xl">
                        Please select a module from the dropdown above to begin.
                    </div>
                `;
                return;
            }

            const moduleData = eskerModules[selectedModule];
            if (!moduleData) {
                console.error(`Error: Module data not found for selected module: ${selectedModule}`);
                appContent.innerHTML = `
                    <div class="text-center py-10 text-red-500 text-xl">
                        Error loading module data. Please try again or select a different module.
                    </div>
                `;
                return;
            }

            // Navigation Tabs
            const navTabsHtml = `
                <div class="flex justify-center mb-6">
                    <button id="discovery-tab" class="px-6 py-3 rounded-l-lg text-lg font-medium transition-all duration-300
                        ${currentView === 'discovery' ? 'bg-ms-blue text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                        Discovery Questions
                    </button>
                    <button id="roi-tab" class="px-6 py-3 rounded-r-lg text-lg font-medium transition-all duration-300
                        ${currentView === 'roi' ? 'bg-ms-blue text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                        ROI Calculator
                    </button>
                </div>
            `;
            appContent.insertAdjacentHTML('beforeend', navTabsHtml);

            // Attach event listeners for tabs
            document.getElementById('discovery-tab').addEventListener('click', () => {
                currentView = 'discovery';
                renderAppContent();
            });
            document.getElementById('roi-tab').addEventListener('click', () => {
                currentView = 'roi';
                renderAppContent();
            });

            // Render current view content
            if (currentView === 'discovery') {
                let discoveryHtml = `
                    <div class="bg-white p-6 rounded-xl shadow-inner">
                        <h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">
                            Discovery Questions: ${selectedModule}
                        </h2>
                `;
                moduleData.questions.forEach((q, index) => {
                    discoveryHtml += `
                        <div class="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                            <label for="${q.id}" class="block text-md font-semibold text-gray-700 mb-2">
                                ${index + 1}. ${q.text}
                            </label>
                    `;
                    if (q.type === 'textarea') {
                        discoveryHtml += `
                            <textarea
                                id="${q.id}"
                                rows="4"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                                placeholder="Enter customer's answer here..."
                            >${discoveryAnswers[q.id] || ''}</textarea>
                        `;
                    } else {
                        discoveryHtml += `
                            <input
                                id="${q.id}"
                                type="${q.type}"
                                value="${discoveryAnswers[q.id] || ''}"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                                placeholder="Enter numerical value"
                            />
                        `;
                    }
                    discoveryHtml += `</div>`;
                });

                discoveryHtml += `
                    <div class="mt-8 p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">Additional Discovery Notes</h3>
                        <div id="additional-notes-container" class="space-y-4">
                            <!-- Dynamic notes will be rendered here -->
                        </div>
                        <button id="add-note-button" class="mt-4 flex items-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            <svg class="h-5 w-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            Add Note
                        </button>
                    </div>
                    <div class="flex justify-center mt-6">
                        <button id="copy-to-roi-button" class="flex items-center bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2">
                            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v4m0 0l-3-3m3 3l3-3m0 6v4m0 0l3 3m-3-3l-3 3m-3-3H4m0 0l-3 3m3-3l-3-3m9-5h4m0 0l3-3m-3 3l3 3"></path></svg>
                            Copy to ROI
                        </button>
                    </div>
                `;
                
                discoveryHtml += `</div>`;
                appContent.insertAdjacentHTML('beforeend', discoveryHtml);

                // Attach event listeners for discovery inputs
                moduleData.questions.forEach(q => {
                    const inputElement = document.getElementById(q.id);
                    if (inputElement) {
                        inputElement.addEventListener('input', (e) => {
                            discoveryAnswers[q.id] = e.target.value;
                        });
                    }
                });
                
                document.getElementById('copy-to-roi-button').addEventListener('click', copyDiscoveryToRoi);

                renderAdditionalNotes(); // Render the additional notes section
            } else if (currentView === 'roi') {
                let roiHtml = `
                    <div class="bg-white p-6 rounded-xl shadow-inner">
                        <h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">
                            ROI Calculator: ${selectedModule}
                        </h2>
                        <p class="text-gray-600 mb-6 text-center">
                            Please enter the customer's current metrics to calculate potential ROI.
                        </p>
                        <div class="mb-6 p-4 border border-ms-blue-light rounded-lg bg-blue-50 shadow-sm">
                            <label for="annual-subscription-cost" class="block text-md font-semibold text-blue-800 mb-2">
                                Annual Subscription Cost ($) (Annual)
                            </label>
                            <input
                                id="annual-subscription-cost"
                                type="number"
                                value="${eskerSubscriptionCost[selectedModule] || ''}"
                                class="w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                                placeholder="Enter annual subscription cost"
                                min="0"
                            />
                        </div>
                        <div class="mb-6 p-4 border border-ms-blue-light rounded-lg bg-blue-50 shadow-sm">
                            <label for="professional-services-cost" class="block text-md font-semibold text-blue-800 mb-2">
                                Professional Services Upfront Cost ($) (One-Time)
                            </label>
                            <input
                                id="professional-services-cost"
                                type="number"
                                value="${eskerProfessionalServicesCost[selectedModule] || ''}"
                                class="w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                                placeholder="Enter upfront professional services cost"
                                min="0"
                            />
                        </div>
                        <div class="mb-6 p-4 border border-ms-blue-light rounded-lg bg-blue-50 shadow-sm">
                            <label for="number-of-years-utilized" class="block text-md font-semibold text-blue-800 mb-2">
                                Number of Years Software Will Be Utilised For (Years)
                            </label>
                            <input
                                id="number-of-years-utilized"
                                type="number"
                                value="${numberOfYearsUtilized[selectedModule] || '3'}"
                                class="w-full px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                                placeholder="e.g., 3, 5, 7"
                                min="1"
                            />
                        </div>
                `;
                moduleData.roiQuestions.forEach((q, index) => {
                    roiHtml += `
                        <div class="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                            <label for="${q.id}" class="block text-md font-semibold text-gray-700 mb-2">
                                ${index + 1}. ${q.text}
                            </label>
                            <input
                                id="${q.id}"
                                type="number"
                                value="${roiAnswers[q.id] || ''}"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                                placeholder="Enter numerical value"
                                min="0"
                            />
                        `;
                    // Populate ROI answers based on the current state if available
                    roiAnswers[q.id] = roiAnswers[q.id] || document.getElementById(q.id)?.value || '';
                    roiHtml += `</div>`;
                });
                roiHtml += `
                    <div class="flex flex-col md:flex-row justify-center items-center gap-4 mt-6">
                        <button id="calculate-roi-button" class="flex-1 flex items-center justify-center bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                            <!-- Calculator icon from Lucide -->
                            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v4m0-4h6m-6 0H9m6 0a1 1 0 11-2 0 1 1 0 012 0zM12 10V4m0 6a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2a2 2 0 012-2h2z"></path></svg>
                            Calculate ROI
                        </button>
                        <button id="populate-demo-data-button" class="flex-1 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                             <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            Demo Data
                        </button>
                    </div>
                `;

                if (calculatedRoi) {
                    let detailsHtml = '';
                    for (const key in calculatedRoi.details) {
                        detailsHtml += `
                            <p class="text-gray-700">
                                <span class="font-medium">${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:</span> $${calculatedRoi.details[key]}
                            </p>
                        `;
                    }
                    roiHtml += `
                        <div class="mt-8 p-6 bg-blue-50 border border-blue-200 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold text-blue-700 mb-4 text-center">ROI Calculation Results</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                                <p class="font-semibold">Total Annual Savings:</p>
                                <p class="text-right text-green-700 font-bold">$${calculatedRoi.totalAnnualSavings}</p>

                                <p class="font-semibold">Total Annual Investment:</p>
                                <p class="text-right text-red-700 font-bold">$${calculatedRoi.annualEskerInvestment}</p>

                                <p class="font-semibold">Net Annual Benefit:</p>
                                <p class="text-right text-blue-800 font-bold">$${calculatedRoi.netAnnualBenefit}</p>

                                <p class="font-semibold text-xl">Total Investment (${numberOfYearsUtilized[selectedModule] || 3} Years):</p>
                                <p class="text-right text-xl text-red-700 font-bold">$${calculatedRoi.totalInvestmentOverYears}</p>

                                <p class="font-semibold text-xl">Total Benefit (${numberOfYearsUtilized[selectedModule] || 3} Years):</p>
                                <p class="text-right text-xl text-green-700 font-bold">$${calculatedRoi.totalBenefitOverYears}</p>

                                <p class="font-semibold text-2xl">Net Benefit (${numberOfYearsUtilized[selectedModule] || 3} Years):</p>
                                <p class="text-right text-2xl font-bold text-blue-800">$${calculatedRoi.netBenefitOverYears}</p>

                                <p class="font-semibold text-3xl">ROI Percentage (${numberOfYearsUtilized[selectedModule] || 3} Years):</p>
                                <p class="text-right text-3xl font-bold text-purple-700">${calculatedRoi.roiPercentage}%</p>

                                <p class="font-semibold text-2xl">Payback Period:</p>
                                <p class="text-right text-2xl font-bold text-orange-700">${calculatedRoi.paybackPeriodMonths} Months</p>
                            </div>
                            <div class="mt-6 border-t pt-4 border-gray-200">
                                <h4 class="text-lg font-semibold text-blue-600 mb-2">Detailed Savings Breakdown:</h4>
                                ${detailsHtml}
                            </div>
                        </div>

                        <!-- New Annual Breakdown Table -->
                        <div class="mt-8 p-6 bg-gray-50 border border-gray-200 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold text-gray-700 mb-4 text-center">Annual Breakdown of Investment, Savings & ROI</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden shadow-sm">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Annual Investment ($)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Annual Savings ($)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Annual Benefit ($)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cumulative Investment ($)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cumulative Benefit ($)</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cumulative ROI (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        ${calculatedRoi.annualBreakdown.map(yearData => `
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${yearData.year}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-red-700">$${yearData.annualInvestment}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-green-700">$${yearData.annualSavings}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-800">$${yearData.netAnnualBenefit}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-red-700">$${yearData.cumulativeInvestment}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-green-700">$${yearData.cumulativeBenefit}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold ${parseFloat(yearData.cumulativeRoiPercentage) >= 0 ? 'text-purple-700' : 'text-red-700'}">${yearData.cumulativeRoiPercentage}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }
                roiHtml += `</div>`;
                appContent.insertAdjacentHTML('beforeend', roiHtml);

                // Attach event listeners for costs and utilisation years
                document.getElementById('annual-subscription-cost').addEventListener('input', (e) => {
                    eskerSubscriptionCost[selectedModule] = e.target.value;
                });
                document.getElementById('professional-services-cost').addEventListener('input', (e) => {
                    eskerProfessionalServicesCost[selectedModule] = e.target.value;
                });
                 document.getElementById('number-of-years-utilized').addEventListener('input', (e) => {
                    numberOfYearsUtilized[selectedModule] = e.target.value;
                });

                // Attach event listeners for ROI inputs
                moduleData.roiQuestions.forEach(q => {
                    const inputElement = document.getElementById(q.id);
                    if (inputElement) {
                        inputElement.addEventListener('input', (e) => {
                            roiAnswers[q.id] = e.target.value;
                        });
                    }
                });

                // Attach event listener for calculate ROI button
                document.getElementById('calculate-roi-button').addEventListener('click', calculateRoi);
                // Attach event listener for demo data button
                document.getElementById('populate-demo-data-button').addEventListener('click', populateDemoData);
            }
        }

        // Populate module dropdown
        function populateModuleDropdown() {
            for (const moduleName in eskerModules) {
                const option = document.createElement('option');
                option.value = moduleName;
                option.textContent = moduleName;
                moduleSelect.appendChild(option);
            }
        }

        // Show/Hide messages
        function showMessage(element) {
            element.classList.remove('hidden');
        }

        function hideMessage(element) {
            element.classList.add('hidden');
        }

        // Show/hide confirmation modal
        function showConfirmationModal() {
            confirmationModal.classList.remove('hidden');
            confirmationModal.style.display = 'flex'; // Ensure flexbox for centering
        }

        function hideConfirmationModal() {
            confirmationModal.classList.add('hidden');
        }

        // Execute Clear Form Function (after confirmation)
        function executeClearForm() {
            // Reset all state variables
            selectedModule = '';
            discoveryAnswers = {};
            roiAnswers = {};
            calculatedRoi = null;
            currentView = 'discovery';
            eskerSubscriptionCost = {};
            eskerProfessionalServicesCost = {};
            numberOfYearsUtilized = {};
            additionalDiscoveryNotes = {}; // Clear all additional notes

            // Reset dropdown
            moduleSelect.value = '';

            // Hide messages
            hideMessage(exportSuccessMessage);
            hideMessage(copySuccessMessage);
            hideMessage(validationErrorMessage);

            // Re-render app content to reflect cleared state
            renderAppContent();
            hideConfirmationModal(); // Hide the modal after clearing
        }

        // Add Note to Additional Discovery Notes
        function addNote() {
            if (!additionalDiscoveryNotes[selectedModule]) {
                additionalDiscoveryNotes[selectedModule] = [];
            }
            const newNoteId = 'note-' + Date.now(); // Simple unique ID
            additionalDiscoveryNotes[selectedModule].push({ id: newNoteId, text: '' });
            renderAdditionalNotes();
        }

        // Delete Note from Additional Discovery Notes
        function deleteNote(noteId) {
            if (additionalDiscoveryNotes[selectedModule]) {
                additionalDiscoveryNotes[selectedModule] = additionalDiscoveryNotes[selectedModule].filter(note => note.id !== noteId);
                renderAdditionalNotes();
            }
        }

        // Handle input change for Additional Discovery Notes
        function handleNoteInput(noteId, value) {
            if (additionalDiscoveryNotes[selectedModule]) {
                const noteIndex = additionalDiscoveryNotes[selectedModule].findIndex(note => note.id === noteId);
                if (noteIndex !== -1) {
                    additionalDiscoveryNotes[selectedModule][noteIndex].text = value;
                }
            }
        }

        // Render (or re-render) the Additional Notes section
        function renderAdditionalNotes() {
            const notesContainer = document.getElementById('additional-notes-container');
            if (!notesContainer) return;

            notesContainer.innerHTML = ''; // Clear existing notes

            const currentNotes = additionalDiscoveryNotes[selectedModule] || [];
            currentNotes.forEach((note) => {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'flex items-start space-x-2 mb-2';
                noteDiv.innerHTML = `
                    <textarea
                        id="${note.id}"
                        rows="3"
                        class="flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 ring-ms-blue"
                        placeholder="Enter additional discovery details here..."
                    >${note.text}</textarea>
                    <button data-note-id="${note.id}" class="delete-note-button p-2 bg-red-500 hover:bg-red-600 text-white rounded-md shadow-sm flex-shrink-0">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                `;
                notesContainer.appendChild(noteDiv);

                document.getElementById(note.id).addEventListener('input', (e) => handleNoteInput(note.id, e.target.value));
                noteDiv.querySelector('.delete-note-button').addEventListener('click', (e) => deleteNote(e.currentTarget.dataset.noteId));
            });

            // Ensure add note button listener is attached only once
            const addNoteButton = document.getElementById('add-note-button');
            if (addNoteButton && !addNoteButton.dataset.listenerAttached) {
                addNoteButton.addEventListener('click', addNote);
                addNoteButton.dataset.listenerAttached = true;
            }
        }


        // Function to copy values from Discovery Questions to ROI Calculator
        function copyDiscoveryToRoi() {
            if (!selectedModule) {
                // No module selected, nothing to copy
                return;
            }

            const mappings = discoveryToRoiMapping[selectedModule];
            if (!mappings) {
                console.warn(`No mapping defined for module: ${selectedModule}`);
                return;
            }

            mappings.forEach(map => {
                const discoveryValue = discoveryAnswers[map.discoveryId];
                let valueToCopy = discoveryValue;

                if (map.transform) {
                    valueToCopy = map.transform(discoveryValue);
                }

                // Only copy if the value is a valid number (or empty string if it's a number field)
                if (valueToCopy !== undefined && valueToCopy !== null && valueToCopy !== '' && !isNaN(parseFloat(valueToCopy))) {
                    roiAnswers[map.roiId] = valueToCopy;
                } else if (valueToCopy === '') { // Allow empty string for numerical inputs
                    roiAnswers[map.roiId] = '';
                }
            });

            // Re-render the ROI tab's inputs to show copied values immediately
            // This is a bit of a hack since we are not changing the tab, but updating the state
            // and re-rendering will ensure inputs reflect the new values.
            // A full re-render of just the ROI inputs would be cleaner, but this works for now.
            // For now, simply update the state and the fields in the ROI tab.
            // No need to switch tabs automatically, just notify.
            showMessage(copySuccessMessage);
            setTimeout(() => hideMessage(copySuccessMessage), 3000);

            // Re-render the app content to ensure inputs reflect the new values if the user switches tabs
            // Or if they are already on the ROI tab, the values will be updated
            renderAppContent();
        }

        // Function to populate ROI fields with demo data
        function populateDemoData() {
            if (!selectedModule) {
                console.warn('No module selected to populate demo data.');
                return;
            }

            const demoDataForModule = demoRoiData[selectedModule];
            if (!demoDataForModule) {
                console.warn(`No demo data defined for module: ${selectedModule}`);
                return;
            }

            // Populate roiAnswers with demo data, preserving existing cost/years fields
            for (const key in demoDataForModule) {
                roiAnswers[key] = demoDataForModule[key];
            }

            // Re-render the ROI tab to show the populated values
            renderAppContent();
            // Optionally, run calculation immediately after populating demo data
            calculateRoi();
        }


        // Calculate ROI based on selected module and answers
        function calculateRoi() {
            if (!selectedModule) {
                showMessage(validationErrorMessage);
                return;
            }

            const currentModule = eskerModules[selectedModule];
            if (!currentModule || !currentModule.roiQuestions) {
                showMessage(validationErrorMessage);
                return;
            }

            // Get costs and utilisation years
            const annualSubscription = parseFloat(document.getElementById('annual-subscription-cost').value);
            const upfrontProfessionalServices = parseFloat(document.getElementById('professional-services-cost').value);
            const yearsUtilized = parseFloat(document.getElementById('number-of-years-utilized').value);

            // Validate if all required number fields are filled, including costs and utilisation years
            const isAnnualSubscriptionValid = !isNaN(annualSubscription) && isFinite(annualSubscription) && annualSubscription >= 0;
            const isUpfrontProfessionalServicesValid = !isNaN(upfrontProfessionalServices) && isFinite(upfrontProfessionalServices) && upfrontProfessionalServices >= 0;
            const isYearsUtilizedValid = !isNaN(yearsUtilized) && isFinite(yearsUtilized) && yearsUtilized > 0;

            const allRoiQuestionsValid = currentModule.roiQuestions.every(q => {
                // For 'current' and 'target' percentage fields, ensure they are numbers
                if (q.id.includes('_current_') || q.id.includes('_target_')) {
                     const value = parseFloat(roiAnswers[q.id]);
                     // Allow empty string for current/target percentage fields if they are not yet filled,
                     // but the calculation will treat them as 0, or they will be caught by the validation.
                     // The problem statement says "ensure all required fields are filled", so empty is not allowed.
                     return !isNaN(value) && isFinite(value) && value >= 0;
                } else if (q.type === 'number') {
                    const value = parseFloat(roiAnswers[q.id]);
                    return !isNaN(value) && isFinite(value) && value >= 0; // Check if it's a valid non-negative number
                }
                return true; // Non-number types are always considered valid in this loop
            });

            const allRequiredFieldsFilled = isAnnualSubscriptionValid && isUpfrontProfessionalServicesValid && isYearsUtilizedValid && allRoiQuestionsValid;

            if (!allRequiredFieldsFilled) {
                showMessage(validationErrorMessage);
                return;
            }

            hideMessage(validationErrorMessage);

            let roiResult = {};
            const FTE_HOURS_PER_YEAR = 2080; // Standard work hours per year for 1 FTE
            const dsoReductionDays = 10; // Common assumption for DSO impact across modules

            // Annual Investment (only subscription for annual net benefit)
            const annualInvestmentBase = annualSubscription;

            // Total Investment over the years utilised
            const totalInvestmentOverYears = upfrontProfessionalServices + (annualInvestmentBase * yearsUtilized);

            let totalAnnualSavings = 0; // This will be calculated per module
            let detailedSavingsBreakdown = {}; // To store detailed calculation steps

            if (selectedModule === 'Accounts Receivable') {
                // Inputs
                const manualProcessCostPerInvoice = parseFloat(roiAnswers.roi_ar1 || 0);
                const fteAR = parseFloat(roiAnswers.roi_ar2 || 0);
                const avgAnnualSalaryAR = parseFloat(roiAnswers.roi_ar3 || 0);
                const currentManualInterventionPct = parseFloat(roiAnswers.roi_ar4_current_manual_intervention_pct || 0) / 100;
                const targetManualInterventionPct = parseFloat(roiAnswers.roi_ar4_target_manual_intervention_pct || 0) / 100;
                const annualPrintPostageArchivingCost = parseFloat(roiAnswers.roi_ar5 || 0);
                const monthlyDisputes = parseFloat(roiAnswers.roi_ar6 || 0);
                const timePerDisputeHours = parseFloat(roiAnswers.roi_ar7 || 0);
                const costOfCapital = parseFloat(roiAnswers.roi_ar8 || 0) / 100;
                const annualBadDebtWriteOffs = parseFloat(roiAnswers.roi_ar9 || 0);
                const annualVolumeInvoices = parseFloat(roiAnswers.roi_ar10 || 0);

                // Assumptions for impact
                const printCostReductionPct = 0.8; // 80% reduction in print/postage costs
                const disputeResolutionTimeReductionPct = 0.5; // 50% reduction in dispute resolution time
                const badDebtReductionPct = 0.15; // 15% reduction in bad debt

                // Savings Calculations
                const manualProcessingSavings = (annualVolumeInvoices * (currentManualInterventionPct - targetManualInterventionPct)) * manualProcessCostPerInvoice;
                detailedSavingsBreakdown.manualProcessingSavingsCalculation = `(${annualVolumeInvoices} invoices/year * (${(currentManualInterventionPct * 100).toFixed(0)}% current - ${(targetManualInterventionPct * 100).toFixed(0)}% target) * $${manualProcessCostPerInvoice}/invoice) = $${manualProcessingSavings.toFixed(2)}`;

                const printCostSavings = annualPrintPostageArchivingCost * printCostReductionPct;
                detailedSavingsBreakdown.printCostSavingsCalculation = `($${annualPrintPostageArchivingCost}/year * ${printCostReductionPct * 100}% reduction) = $${printCostSavings.toFixed(2)}`;

                const annualDisputes = monthlyDisputes * 12;
                const hourlyCostAR = fteAR > 0 ? (avgAnnualSalaryAR / FTE_HOURS_PER_YEAR) : 0;
                const disputeSavings = annualDisputes * timePerDisputeHours * hourlyCostAR * disputeResolutionTimeReductionPct;
                detailedSavingsBreakdown.disputeResolutionSavingsCalculation = `(${annualDisputes} disputes/year * ${timePerDisputeHours} hours/dispute * $${hourlyCostAR.toFixed(2)}/hour * ${disputeResolutionTimeReductionPct * 100}% reduction) = $${disputeSavings.toFixed(2)}`;

                const badDebtSavings = annualBadDebtWriteOffs * badDebtReductionPct;
                detailedSavingsBreakdown.badDebtReductionSavingsCalculation = `($${annualBadDebtWriteOffs}/year * ${badDebtReductionPct * 100}% reduction) = $${badDebtSavings.toFixed(2)}`;

                // DSO Cash Flow Savings (assuming AR1 and AR2 from discovery are annual figures)
                const disco_ar1_monthly_invoices = parseFloat(discoveryAnswers.ar1 || 0);
                const disco_ar2_avg_invoice_value = parseFloat(discoveryAnswers.ar2 || 0);
                const annualInvoiceValue = (disco_ar1_monthly_invoices * 12) * disco_ar2_avg_invoice_value;
                const dailySales = annualInvoiceValue / 365;
                const dsoCashFlowSavings = dailySales * dsoReductionDays * costOfCapital;
                detailedSavingsBreakdown.dsoCashFlowSavingsCalculation = `(${annualInvoiceValue.toFixed(2)} annual invoice value / 365 days * ${dsoReductionDays} days DSO reduction * ${costOfCapital * 100}% cost of capital) = $${dsoCashFlowSavings.toFixed(2)}`;

                totalAnnualSavings = manualProcessingSavings + printCostSavings + disputeSavings + badDebtSavings + dsoCashFlowSavings;

                roiResult.details = {
                    ManualProcessingSavings: manualProcessingSavings.toFixed(2),
                    PrintCostSavings: printCostSavings.toFixed(2),
                    DisputeResolutionSavings: disputeSavings.toFixed(2),
                    BadDebtReductionSavings: badDebtSavings.toFixed(2),
                    DSOCashFlowSavings: dsoCashFlowSavings.toFixed(2),
                };

            } else if (selectedModule === 'Order Management') {
                // Inputs
                const manualProcessCostPerOrder = parseFloat(roiAnswers.roi_om1 || 0);
                const fteOM = parseFloat(roiAnswers.roi_om2 || 0);
                const avgAnnualSalaryOM = parseFloat(roiAnswers.roi_om3 || 0);
                const currentManualEntryPct = parseFloat(roiAnswers.roi_om4_current_manual_entry_pct || 0) / 100;
                const targetManualEntryPct = parseFloat(roiAnswers.roi_om4_target_manual_entry_pct || 0) / 100;
                const costCorrectingError = parseFloat(roiAnswers.roi_om5 || 0);
                const monthlyOrderErrors = parseFloat(roiAnswers.roi_om6 || 0);
                const annualVolumeSalesOrders = parseFloat(roiAnswers.roi_om8 || 0);

                // Assumptions for impact
                const errorReductionPct = 0.7; // 70% reduction in order errors
                // Removed inquiryTimeReductionPct as per request

                // Savings Calculations
                const manualProcessingSavings = (annualVolumeSalesOrders * (currentManualEntryPct - targetManualEntryPct)) * manualProcessCostPerOrder;
                detailedSavingsBreakdown.manualProcessingSavingsCalculation = `(${annualVolumeSalesOrders} orders/year * (${(currentManualEntryPct * 100).toFixed(0)}% current - ${(targetManualEntryPct * 100).toFixed(0)}% target) * $${manualProcessCostPerOrder}/order) = $${manualProcessingSavings.toFixed(2)}`;
                
                const annualOrderErrors = monthlyOrderErrors * 12;
                const errorCorrectionSavings = annualOrderErrors * costCorrectingError * errorReductionPct;
                detailedSavingsBreakdown.errorCorrectionSavingsCalculation = `(${annualOrderErrors} errors/year * $${costCorrectingError}/error * ${errorReductionPct * 100}% reduction) = $${errorCorrectionSavings.toFixed(2)}`;

                // Removed inquiryTimeSavings calculation as per request
                totalAnnualSavings = manualProcessingSavings + errorCorrectionSavings;

                roiResult.details = {
                    ManualProcessingSavings: manualProcessingSavings.toFixed(2),
                    ErrorCorrectionSavings: errorCorrectionSavings.toFixed(2),
                };
            } else if (selectedModule === 'Collections Management') {
                // Inputs
                const avgCostPerManualActivity = parseFloat(roiAnswers.roi_cm1 || 0);
                const fteCM = parseFloat(roiAnswers.roi_cm2 || 0);
                const avgAnnualSalaryCM = parseFloat(roiAnswers.roi_cm3 || 0);
                const annualOverdueInvoicesFollowUp = parseFloat(roiAnswers.roi_cm4 || 0);
                const annualBadDebtWriteOffs = parseFloat(roiAnswers.roi_cm5 || 0);
                const avgOverdueInvoiceValue = parseFloat(roiAnswers.roi_cm6 || 0);
                const currentDSO = parseFloat(roiAnswers.roi_cm7 || 0);
                const costOfCapital = parseFloat(roiAnswers.roi_cm8 || 0) / 100;

                // Assumptions for impact
                const manualActivityReductionPct = 0.6; // 60% reduction in manual collection activities
                const badDebtReductionPct = 0.2; // 20% reduction in bad debt
                const dsoReductionDays = 7; // 7 days reduction in DSO

                // Savings Calculations
                const manualCollectionsSavings = annualOverdueInvoicesFollowUp * avgCostPerManualActivity * manualActivityReductionPct;
                detailedSavingsBreakdown.manualCollectionsSavingsCalculation = `(${annualOverdueInvoicesFollowUp} activities/year * $${avgCostPerManualActivity}/activity * ${manualActivityReductionPct * 100}% reduction) = $${manualCollectionsSavings.toFixed(2)}`;

                const badDebtSavings = annualBadDebtWriteOffs * badDebtReductionPct;
                detailedSavingsBreakdown.badDebtReductionSavingsCalculation = `($${annualBadDebtWriteOffs}/year * ${badDebtReductionPct * 100}% reduction) = $${badDebtSavings.toFixed(2)}`;
                
                const dsoCashFlowSavings = (annualOverdueInvoicesFollowUp * avgOverdueInvoiceValue / 365) * dsoReductionDays * costOfCapital;
                detailedSavingsBreakdown.dsoCashFlowSavingsCalculation = `((${annualOverdueInvoicesFollowUp} invoices * $${avgOverdueInvoiceValue}/invoice) / 365 days * ${dsoReductionDays} days DSO reduction * ${costOfCapital * 100}% cost of capital) = $${dsoCashFlowSavings.toFixed(2)}`;

                totalAnnualSavings = manualCollectionsSavings + badDebtSavings + dsoCashFlowSavings;

                roiResult.details = {
                    ManualCollectionsSavings: manualCollectionsSavings.toFixed(2),
                    BadDebtReductionSavings: badDebtSavings.toFixed(2),
                    DSOCashFlowSavings: dsoCashFlowSavings.toFixed(2),
                };
            } else if (selectedModule === 'Customer Inquiries') {
                // Inputs
                const avgCostPerManualInquiry = parseFloat(roiAnswers.roi_ci1 || 0);
                const fteCI = parseFloat(roiAnswers.roi_ci2 || 0);
                const avgAnnualSalaryCI = parseFloat(roiAnswers.roi_ci3 || 0);
                const annualInquiries = parseFloat(roiAnswers.roi_ci4 || 0);
                const currentFCR = parseFloat(roiAnswers.roi_ci5_current_fcr_pct || 0) / 100;
                const targetFCR = parseFloat(roiAnswers.roi_ci5_target_fcr_pct || 0) / 100;
                const avgTimePerInquiryMinutes = parseFloat(roiAnswers.roi_ci6 || 0);
                const annualCostLostCustomer = parseFloat(roiAnswers.roi_ci7 || 0);

                // Assumptions for impact
                const inquiryAutomationSavingsPct = 0.5; // 50% automation of manual inquiries
                const timePerInquiryReductionPct = 0.3; // 30% reduction in inquiry time
                const lostCustomerReductionPct = 0.1; // 10% reduction in lost customers due to poor service (direct cost saving)

                // Savings Calculations
                const manualInquirySavings = annualInquiries * avgCostPerManualInquiry * inquiryAutomationSavingsPct;
                detailedSavingsBreakdown.manualInquirySavingsCalculation = `(${annualInquiries} enquiries/year * $${avgCostPerManualInquiry}/enquiry * ${inquiryAutomationSavingsPct * 100}% automation) = $${manualInquirySavings.toFixed(2)}`;

                // Savings from improved FCR (reducing re-contacts)
                const improvedFCRSavings = annualInquiries * ( (1 - currentFCR) - (1 - targetFCR) ) * avgCostPerManualInquiry;
                detailedSavingsBreakdown.improvedFCRSavingsCalculation = `(${annualInquiries} enquiries * (current re-contact rate: ${((1 - currentFCR) * 100).toFixed(0)}% - target re-contact rate: ${((1 - targetFCR) * 100).toFixed(0)}%) * $${avgCostPerManualInquiry}/enquiry) = $${improvedFCRSavings.toFixed(2)}`;

                const hourlyCostCI = fteCI > 0 ? (avgAnnualSalaryCI / FTE_HOURS_PER_YEAR) : 0;
                const timeSavings = annualInquiries * (avgTimePerInquiryMinutes / 60) * hourlyCostCI * timePerInquiryReductionPct;
                detailedSavingsBreakdown.timeSavingsCalculation = `(${annualInquiries} enquiries/year * ${avgTimePerInquiryMinutes} mins/enquiry / 60 * $${hourlyCostCI.toFixed(2)}/hour * ${timePerInquiryReductionPct * 100}% reduction) = $${timeSavings.toFixed(2)}`;

                const lostCustomerSavings = annualCostLostCustomer * lostCustomerReductionPct;
                detailedSavingsBreakdown.lostCustomerSavingsCalculation = `($${annualCostLostCustomer}/year * ${lostCustomerReductionPct * 100}% reduction) = $${lostCustomerSavings.toFixed(2)}`;

                totalAnnualSavings = manualInquirySavings + improvedFCRSavings + timeSavings + lostCustomerSavings;

                roiResult.details = {
                    ManualInquirySavings: manualInquirySavings.toFixed(2),
                    ImprovedFCRSavings: improvedFCRSavings.toFixed(2),
                    TimeSavings: timeSavings.toFixed(2),
                    LostCustomerSavings: lostCustomerSavings.toFixed(2),
                };
            } else if (selectedModule === 'Cash Application') {
                // Inputs
                const avgCostManualApplication = parseFloat(roiAnswers.roi_ca1 || 0);
                const fteCA = parseFloat(roiAnswers.roi_ca2 || 0);
                const avgAnnualSalaryCA = parseFloat(roiAnswers.roi_ca3 || 0);
                const annualPaymentsReceived = parseFloat(roiAnswers.roi_ca4 || 0);
                const currentManualInterventionPct = parseFloat(roiAnswers.roi_ca5_current_manual_intervention_pct || 0) / 100;
                const targetManualInterventionPct = parseFloat(roiAnswers.roi_ca5_target_manual_intervention_pct || 0) / 100;
                const timeUnappliedCashHours = parseFloat(roiAnswers.roi_ca6 || 0);
                const annualUnappliedCashValue = parseFloat(roiAnswers.roi_ca7 || 0);
                const costOfCapital = parseFloat(roiAnswers.roi_ca8 || 0) / 100;

                // Assumptions for impact
                const unappliedCashReductionPct = 0.3; // 30% reduction in unapplied cash value (financial benefit)
                const timeReductionUnappliedCashPct = 0.6; // 60% reduction in time to resolve unapplied cash

                // Savings Calculations
                const manualApplicationSavings = (annualPaymentsReceived * (currentManualInterventionPct - targetManualInterventionPct)) * avgCostManualApplication;
                detailedSavingsBreakdown.manualApplicationSavingsCalculation = `(${annualPaymentsReceived} payments/year * (${(currentManualInterventionPct * 100).toFixed(0)}% current - ${(targetManualInterventionPct * 100).toFixed(0)}% target) * $${avgCostManualApplication}/payment) = $${manualApplicationSavings.toFixed(2)}`;

                const unappliedCashValueSavings = annualUnappliedCashValue * unappliedCashReductionPct * costOfCapital; // Cost of capital on unapplied cash
                detailedSavingsBreakdown.unappliedCashValueSavingsCalculation = `($${annualUnappliedCashValue}/year * ${unappliedCashReductionPct * 100}% reduction * ${costOfCapital * 100}% cost of capital) = $${unappliedCashValueSavings.toFixed(2)}`;
                
                const hourlyCostCA = fteCA > 0 ? (avgAnnualSalaryCA / FTE_HOURS_PER_YEAR) : 0;
                const timeResolutionSavings = (annualPaymentsReceived * currentManualInterventionPct) * timeUnappliedCashHours * hourlyCostCA * timeReductionUnappliedCashPct; // Assuming time is per manual item that needs resolution
                detailedSavingsBreakdown.timeResolutionSavingsCalculation = `((${annualPaymentsReceived} payments * ${(currentManualInterventionPct * 100).toFixed(0)}% manual) * ${timeUnappliedCashHours} hours/item * $${hourlyCostCA.toFixed(2)}/hour * ${timeReductionUnappliedCashPct * 100}% reduction) = $${timeResolutionSavings.toFixed(2)}`;

                totalAnnualSavings = manualApplicationSavings + unappliedCashValueSavings + timeResolutionSavings;

                roiResult.details = {
                    ManualApplicationSavings: manualApplicationSavings.toFixed(2),
                    UnappliedCashValueSavings: unappliedCashValueSavings.toFixed(2),
                    TimeResolutionSavings: timeResolutionSavings.toFixed(2),
                };
            } else if (selectedModule === 'Credit Management') {
                // Inputs
                const avgCostManualApplication = parseFloat(roiAnswers.roi_crm1 || 0);
                const fteCRM = parseFloat(roiAnswers.roi_crm2 || 0);
                const avgAnnualSalaryCRM = parseFloat(roiAnswers.roi_crm3 || 0);
                const annualNewApplications = parseFloat(roiAnswers.roi_crm4 || 0);
                const timeManualReviewHours = parseFloat(roiAnswers.roi_crm5 || 0);
                const annualBadDebt = parseFloat(roiAnswers.roi_crm6 || 0);
                const annualCostLostSales = parseFloat(roiAnswers.roi_crm7 || 0);

                // Assumptions for impact
                const automationSavingsPct = 0.7; // 70% automation of manual credit applications
                const badDebtReductionPct = 0.1; // 10% reduction in bad debt
                const lostSalesReductionPct = 0.2; // 20% reduction in lost sales due to slow decisions (direct cost saving)
                const timeReductionManualReviewPct = 0.5; // 50% reduction in manual review time

                // Savings Calculations
                const manualApplicationSavings = annualNewApplications * avgCostManualApplication * automationSavingsPct;
                detailedSavingsBreakdown.manualApplicationSavingsCalculation = `(${annualNewApplications} applications/year * $${avgCostManualApplication}/application * ${automationSavingsPct * 100}% automation) = $${manualApplicationSavings.toFixed(2)}`;

                const badDebtSavings = annualBadDebt * badDebtReductionPct;
                detailedSavingsBreakdown.badDebtReductionSavingsCalculation = `($${annualBadDebt}/year * ${badDebtReductionPct * 100}% reduction) = $${badDebtSavings.toFixed(2)}`;
                
                const lostSalesSavings = annualCostLostSales * lostSalesReductionPct;
                detailedSavingsBreakdown.lostSalesSavingsCalculation = `($${annualCostLostSales}/year * ${lostSalesReductionPct * 100}% reduction) = $${lostSalesSavings.toFixed(2)}`;

                const hourlyCostCRM = fteCRM > 0 ? (avgAnnualSalaryCRM / FTE_HOURS_PER_YEAR) : 0;
                const timeReviewSavings = annualNewApplications * timeManualReviewHours * hourlyCostCRM * timeReductionManualReviewPct;
                detailedSavingsBreakdown.timeReviewSavingsCalculation = `(${annualNewApplications} applications/year * ${timeManualReviewHours} hours/review * $${hourlyCostCRM.toFixed(2)}/hour * ${timeReductionManualReviewPct * 100}% reduction) = $${timeReviewSavings.toFixed(2)}`;

                totalAnnualSavings = manualApplicationSavings + badDebtSavings + lostSalesSavings + timeReviewSavings;

                roiResult.details = {
                    ManualApplicationSavings: manualApplicationSavings.toFixed(2),
                    BadDebtReductionSavings: badDebtSavings.toFixed(2),
                    LostSalesSavings: lostSalesSavings.toFixed(2),
                    TimeReviewSavings: timeReviewSavings.toFixed(2),
                };
            } else if (selectedModule === 'Procurement') {
                // Inputs
                const avgCostManualPO = parseFloat(roiAnswers.roi_p1 || 0);
                const fteP = parseFloat(roiAnswers.roi_p2 || 0);
                const avgAnnualSalaryP = parseFloat(roiAnswers.roi_p3 || 0);
                const annualPOs = parseFloat(roiAnswers.roi_p4 || 0);
                const currentMaverickSpendPct = parseFloat(roiAnswers.roi_p5_current_maverick_spend_pct || 0) / 100;
                const targetMaverickSpendPct = parseFloat(roiAnswers.roi_p5_target_maverick_spend_pct || 0) / 100;
                const timeManualPOApprovalHours = parseFloat(roiAnswers.roi_p6 || 0);
                const annualPOErrorCost = parseFloat(roiAnswers.roi_p7 || 0);
                const totalAnnualSpend = parseFloat(roiAnswers.roi_p8 || 0); // Used for maverick spend calculation

                // Assumptions for impact
                const automationSavingsPct = 0.6; // 60% automation of manual POs
                const poErrorReductionPct = 0.7; // 70% reduction in PO errors
                const timeApprovalReductionPct = 0.4; // 40% reduction in manual PO approval time

                // Savings Calculations
                const manualPOSavings = annualPOs * avgCostManualPO * automationSavingsPct;
                detailedSavingsBreakdown.manualPOSavingsCalculation = `(${annualPOs} POs/year * $${avgCostManualPO}/PO * ${automationSavingsPct * 100}% automation) = $${manualPOSavings.toFixed(2)}`;

                const maverickSpendSavings = totalAnnualSpend * (currentMaverickSpendPct - targetMaverickSpendPct); // Cost avoidance from better control
                detailedSavingsBreakdown.maverickSpendSavingsCalculation = `($${totalAnnualSpend}/year * (${(currentMaverickSpendPct * 100).toFixed(0)}% current - ${(targetMaverickSpendPct * 100).toFixed(0)}% target)) = $${maverickSpendSavings.toFixed(2)}`;
                
                const poErrorSavings = annualPOErrorCost * poErrorReductionPct;
                detailedSavingsBreakdown.poErrorSavingsCalculation = `($${annualPOErrorCost}/year * ${poErrorReductionPct * 100}% reduction) = $${poErrorSavings.toFixed(2)}`;

                const hourlyCostP = fteP > 0 ? (avgAnnualSalaryP / FTE_HOURS_PER_YEAR) : 0;
                const timeApprovalSavings = annualPOs * timeManualPOApprovalHours * hourlyCostP * timeApprovalReductionPct;
                detailedSavingsBreakdown.timeApprovalSavingsCalculation = `(${annualPOs} POs/year * ${timeManualPOApprovalHours} hours/PO * $${hourlyCostP.toFixed(2)}/hour * ${timeApprovalReductionPct * 100}% reduction) = $${timeApprovalSavings.toFixed(2)}`;

                totalAnnualSavings = manualPOSavings + maverickSpendSavings + poErrorSavings + timeApprovalSavings;

                roiResult.details = {
                    ManualPOSavings: manualPOSavings.toFixed(2),
                    MaverickSpendSavings: maverickSpendSavings.toFixed(2),
                    POErrorSavings: poErrorSavings.toFixed(2),
                    TimeApprovalSavings: timeApprovalSavings.toFixed(2),
                };
            } else if (selectedModule === 'Supplier Management') {
                // Inputs
                const avgCostManualOnboarding = parseFloat(roiAnswers.roi_sm1 || 0);
                const fteSM = parseFloat(roiAnswers.roi_sm2 || 0);
                const avgAnnualSalarySM = parseFloat(roiAnswers.roi_sm3 || 0);
                const annualNewSupplierOnboarding = parseFloat(roiAnswers.roi_sm4 || 0);
                const timeManualDataEntryHours = parseFloat(roiAnswers.roi_sm5 || 0);
                const annualNonComplianceCost = parseFloat(roiAnswers.roi_sm6 || 0);
                const currentInaccurateDataPct = parseFloat(roiAnswers.roi_sm7_current_inaccurate_data_pct || 0) / 100;
                const targetInaccurateDataPct = parseFloat(roiAnswers.roi_sm7_target_inaccurate_data_pct || 0) / 100;

                // Assumptions for impact
                const onboardingAutomationSavingsPct = 0.6; // 60% automation of manual onboarding
                const nonComplianceReductionPct = 0.2; // 20% reduction in non-compliance costs
                const timeDataEntryReductionPct = 0.5; // 50% reduction in manual data entry time

                // Savings Calculations
                const manualOnboardingSavings = annualNewSupplierOnboarding * avgCostManualOnboarding * onboardingAutomationSavingsPct;
                detailedSavingsBreakdown.manualOnboardingSavingsCalculation = `(${annualNewSupplierOnboarding} onboardings/year * $${avgCostManualOnboarding}/onboarding * ${onboardingAutomationSavingsPct * 100}% automation) = $${manualOnboardingSavings.toFixed(2)}`;

                const nonComplianceSavings = annualNonComplianceCost * nonComplianceReductionPct;
                detailedSavingsBreakdown.nonComplianceSavingsCalculation = `($${annualNonComplianceCost}/year * ${nonComplianceReductionPct * 100}% reduction) = $${nonComplianceSavings.toFixed(2)}`;
                
                const dataAccuracySavings = (annualNewSupplierOnboarding * (currentInaccurateDataPct - targetInaccurateDataPct)) * avgCostManualOnboarding; // Simplified: cost savings from fewer errors due to better data
                detailedSavingsBreakdown.dataAccuracySavingsCalculation = `(${annualNewSupplierOnboarding} onboardings * (${(currentInaccurateDataPct * 100).toFixed(0)}% current - ${(targetInaccurateDataPct * 100).toFixed(0)}% target) * $${avgCostManualOnboarding}/onboarding) = $${dataAccuracySavings.toFixed(2)}`;

                const hourlyCostSM = fteSM > 0 ? (avgAnnualSalarySM / FTE_HOURS_PER_YEAR) : 0;
                const timeDataEntrySavings = annualNewSupplierOnboarding * timeManualDataEntryHours * hourlyCostSM * timeDataEntryReductionPct;
                detailedSavingsBreakdown.timeDataEntrySavingsCalculation = `(${annualNewSupplierOnboarding} onboardings/year * ${timeManualDataEntryHours} hours/onboarding * $${hourlyCostSM.toFixed(2)}/hour * ${timeDataEntryReductionPct * 100}% reduction) = $${timeDataEntrySavings.toFixed(2)}`;

                totalAnnualSavings = manualOnboardingSavings + nonComplianceSavings + dataAccuracySavings + timeDataEntrySavings;

                roiResult.details = {
                    ManualOnboardingSavings: manualOnboardingSavings.toFixed(2),
                    NonComplianceSavings: nonComplianceSavings.toFixed(2),
                    DataAccuracySavings: dataAccuracySavings.toFixed(2),
                    TimeDataEntrySavings: timeDataEntrySavings.toFixed(2),
                };
            } else if (selectedModule === 'Sourcing') {
                // Inputs
                const avgCostManualSourcingEvent = parseFloat(roiAnswers.roi_s1 || 0);
                const fteS = parseFloat(roiAnswers.roi_s2 || 0);
                const avgAnnualSalaryS = parseFloat(roiAnswers.roi_s3 || 0);
                const annualSourcingEvents = parseFloat(roiAnswers.roi_s4 || 0);
                const avgSourcingCycleTimeDays = parseFloat(roiAnswers.roi_s5 || 0);
                const totalAnnualSpendUnderManagement = parseFloat(roiAnswers.roi_s6 || 0);
                const currentAvgSavingsPct = parseFloat(roiAnswers.roi_s7_current_avg_savings_pct || 0) / 100;
                const targetAvgSavingsPct = parseFloat(roiAnswers.roi_s7_target_avg_savings_pct || 0) / 100;

                // Assumptions for impact
                const automationSavingsPct = 0.5; // 50% automation of manual sourcing events

                // Savings Calculations
                const manualSourcingSavings = annualSourcingEvents * avgCostManualSourcingEvent * automationSavingsPct;
                detailedSavingsBreakdown.manualSourcingSavingsCalculation = `(${annualSourcingEvents} events/year * $${avgCostManualSourcingEvent}/event * ${automationSavingsPct * 100}% automation) = $${manualSourcingSavings.toFixed(2)}`;
                
                // Savings from increased average savings (target should be higher than current)
                const additionalSavings = totalAnnualSpendUnderManagement * (targetAvgSavingsPct - currentAvgSavingsPct);
                detailedSavingsBreakdown.additionalSavingsCalculation = `($${totalAnnualSpendUnderManagement}/year * (target savings: ${(targetAvgSavingsPct * 100).toFixed(0)}% - current savings: ${(currentAvgSavingsPct * 100).toFixed(0)}%)) = $${additionalSavings.toFixed(2)}`;

                totalAnnualSavings = manualSourcingSavings + additionalSavings;

                roiResult.details = {
                    ManualSourcingSavings: manualSourcingSavings.toFixed(2),
                    AdditionalSavings: additionalSavings.toFixed(2),
                };
            } else if (selectedModule === 'Claims & Deductions') {
                // Inputs
                const avgCostManualClaim = parseFloat(roiAnswers.roi_cd1 || 0);
                const fteCD = parseFloat(roiAnswers.roi_cd2 || 0);
                const avgAnnualSalaryCD = parseFloat(roiAnswers.roi_cd3 || 0);
                const annualClaims = parseFloat(roiAnswers.roi_cd4 || 0);
                const timeResolveClaimHours = parseFloat(roiAnswers.roi_cd5 || 0);
                const annualInvalidClaimsValue = parseFloat(roiAnswers.roi_cd6 || 0);
                const currentManualResearchPct = parseFloat(roiAnswers.roi_cd7_current_manual_research_pct || 0) / 100;
                const targetManualResearchPct = parseFloat(roiAnswers.roi_cd7_target_manual_research_pct || 0) / 100;

                // Assumptions for impact
                const automationSavingsPct = 0.6; // 60% automation of manual claims processing
                const invalidClaimsReductionPct = 0.25; // 25% reduction in invalid claims value (direct cost reduction)
                // manualResearchReductionPct no longer needed with current/target fields

                // Savings Calculations
                const manualClaimSavings = annualClaims * avgCostManualClaim * automationSavingsPct;
                detailedSavingsBreakdown.manualClaimSavingsCalculation = `(${annualClaims} claims/year * $${avgCostManualClaim}/claim * ${automationSavingsPct * 100}% automation) = $${manualClaimSavings.toFixed(2)}`;

                const invalidClaimsSavings = annualInvalidClaimsValue * invalidClaimsReductionPct;
                detailedSavingsBreakdown.invalidClaimsSavingsCalculation = `($${annualInvalidClaimsValue}/year * ${invalidClaimsReductionPct * 100}% reduction) = $${invalidClaimsSavings.toFixed(2)}`;

                const hourlyCostCD = fteCD > 0 ? (avgAnnualSalaryCD / FTE_HOURS_PER_YEAR) : 0;
                const researchTimeSavings = annualClaims * (currentManualResearchPct - targetManualResearchPct) * timeResolveClaimHours * hourlyCostCD;
                detailedSavingsBreakdown.researchTimeSavingsCalculation = `(${annualClaims} claims/year * (${(currentManualResearchPct * 100).toFixed(0)}% current - ${(targetManualResearchPct * 100).toFixed(0)}% target) manual research * ${timeResolveClaimHours} hours/claim * $${hourlyCostCD.toFixed(2)}/hour) = $${researchTimeSavings.toFixed(2)}`;

                totalAnnualSavings = manualClaimSavings + invalidClaimsSavings + researchTimeSavings;

                roiResult.details = {
                    ManualClaimSavings: manualClaimSavings.toFixed(2),
                    InvalidClaimsSavings: invalidClaimsSavings.toFixed(2),
                    ResearchTimeSavings: researchTimeSavings.toFixed(2),
                };
            } else if (selectedModule === 'Invoice Delivery') {
                // Inputs
                const avgCostPerInvoiceDelivery = parseFloat(roiAnswers.roi_id1 || 0);
                const fteID = parseFloat(roiAnswers.roi_id2 || 0);
                const avgAnnualSalaryID = parseFloat(roiAnswers.roi_id3 || 0);
                const annualInvoicesDelivered = parseFloat(roiAnswers.roi_id4 || 0);
                const currentManualInterventionPct = parseFloat(roiAnswers.roi_id5_current_manual_intervention_pct || 0) / 100;
                const targetManualInterventionPct = parseFloat(roiAnswers.roi_id5_target_manual_intervention_pct || 0) / 100;
                const timeFailedDeliveryHours = parseFloat(roiAnswers.roi_id6 || 0);
                const lostEarlyPaymentDiscounts = parseFloat(roiAnswers.roi_id7 || 0); // Although a financial benefit, it's a direct loss from manual process

                // Assumptions for impact
                const failedDeliveryReductionPct = 0.6; // 60% reduction in time resolving failed deliveries
                const earlyPaymentDiscountRecoveryPct = 0.3; // 30% recovery of lost early payment discounts (direct financial recovery)

                // Savings Calculations
                const manualDeliverySavings = (annualInvoicesDelivered * (currentManualInterventionPct - targetManualInterventionPct)) * avgCostPerInvoiceDelivery;
                detailedSavingsBreakdown.manualDeliverySavingsCalculation = `(${annualInvoicesDelivered} invoices/year * (${(currentManualInterventionPct * 100).toFixed(0)}% current - ${(targetManualInterventionPct * 100).toFixed(0)}% target) * $${avgCostPerInvoiceDelivery}/invoice) = $${manualDeliverySavings.toFixed(2)}`;
                
                const hourlyCostID = fteID > 0 ? (avgAnnualSalaryID / FTE_HOURS_PER_YEAR) : 0;
                const failedDeliveryTimeSavings = (annualInvoicesDelivered * currentManualInterventionPct) * timeFailedDeliveryHours * hourlyCostID * failedDeliveryReductionPct; // Assuming manual intervention is where failed deliveries originate
                detailedSavingsBreakdown.failedDeliveryTimeSavingsCalculation = `((${annualInvoicesDelivered} invoices * ${(currentManualInterventionPct * 100).toFixed(0)}% manual) * ${timeFailedDeliveryHours} hours/failed delivery * $${hourlyCostID.toFixed(2)}/hour * ${failedDeliveryReductionPct * 100}% reduction) = $${failedDeliveryTimeSavings.toFixed(2)}`;
                
                const earlyPaymentSavings = lostEarlyPaymentDiscounts * earlyPaymentDiscountRecoveryPct;
                detailedSavingsBreakdown.earlyPaymentSavingsCalculation = `($${lostEarlyPaymentDiscounts}/year * ${earlyPaymentDiscountRecoveryPct * 100}% recovery) = $${earlyPaymentSavings.toFixed(2)}`;

                totalAnnualSavings = manualDeliverySavings + failedDeliveryTimeSavings + earlyPaymentSavings;

                roiResult.details = {
                    ManualDeliverySavings: manualDeliverySavings.toFixed(2),
                    FailedDeliveryTimeSavings: failedDeliveryTimeSavings.toFixed(2),
                    EarlyPaymentSavings: earlyPaymentSavings.toFixed(2),
                };
            }

            // Calculate overall ROI metrics
            const netAnnualBenefit = totalAnnualSavings - annualInvestmentBase;
            const totalBenefitOverYears = totalAnnualSavings * yearsUtilized;
            const netBenefitOverYears = totalBenefitOverYears - totalInvestmentOverYears;

            const roiPercentage = totalInvestmentOverYears > 0 ? (netBenefitOverYears / totalInvestmentOverYears) * 100 : 0;

            let paybackPeriodMonths;
            if (netAnnualBenefit > 0) {
                // Payback period considers initial upfront cost + first year's subscription, recovered by net annual benefit
                paybackPeriodMonths = (upfrontProfessionalServices + annualInvestmentBase) / netAnnualBenefit * 12;
            } else {
                paybackPeriodMonths = Infinity; // Will never pay back if no net annual benefit
            }

            roiResult.totalAnnualSavings = totalAnnualSavings.toFixed(2);
            roiResult.annualEskerInvestment = annualInvestmentBase.toFixed(2); // Renamed to annualInvestmentBase for clarity
            roiResult.netAnnualBenefit = netAnnualBenefit.toFixed(2);
            roiResult.totalInvestmentOverYears = totalInvestmentOverYears.toFixed(2);
            roiResult.totalBenefitOverYears = totalBenefitOverYears.toFixed(2);
            roiResult.netBenefitOverYears = netBenefitOverYears.toFixed(2);
            roiResult.roiPercentage = roiPercentage.toFixed(2);
            roiResult.paybackPeriodMonths = paybackPeriodMonths.toFixed(1);

            // Annual Breakdown
            const annualBreakdown = [];
            let cumulativeInvestment = 0;
            let cumulativeBenefit = 0;

            for (let i = 1; i <= yearsUtilized; i++) {
                const year = i;
                let yearInvestment = annualInvestmentBase; // Base annual subscription

                if (year === 1) {
                    yearInvestment += upfrontProfessionalServices; // Add professional services in year 1
                }

                const yearSavings = totalAnnualSavings;
                const yearNetBenefit = yearSavings - yearInvestment;

                cumulativeInvestment += yearInvestment;
                cumulativeBenefit += yearSavings;

                const cumulativeNetBenefit = cumulativeBenefit - cumulativeInvestment;
                const cumulativeRoiPercentage = cumulativeInvestment > 0 ? (cumulativeNetBenefit / cumulativeInvestment) * 100 : 0;

                annualBreakdown.push({
                    year: year,
                    annualInvestment: yearInvestment.toFixed(2),
                    annualSavings: yearSavings.toFixed(2),
                    netAnnualBenefit: yearNetBenefit.toFixed(2),
                    cumulativeInvestment: cumulativeInvestment.toFixed(2),
                    cumulativeBenefit: cumulativeBenefit.toFixed(2),
                    cumulativeRoiPercentage: cumulativeRoiPercentage.toFixed(2)
                });
            }
            roiResult.annualBreakdown = annualBreakdown;
            roiResult.detailedSavingsBreakdown = detailedSavingsBreakdown; // Store detailed breakdown

            calculatedRoi = roiResult;
            renderAppContent(); // Re-render to show ROI results
        }

        // --- Export Functions ---

        function getReportData() {
            const data = {
                module: selectedModule,
                discovery: {},
                additionalNotes: additionalDiscoveryNotes[selectedModule] || [],
                roiInputs: {
                    annualSubscriptionCost: eskerSubscriptionCost[selectedModule],
                    professionalServicesCost: eskerProfessionalServicesCost[selectedModule],
                    numberOfYearsUtilized: numberOfYearsUtilized[selectedModule],
                    roiQuestions: {}
                },
                calculatedRoi: calculatedRoi
            };

            eskerModules[selectedModule].questions.forEach(q => {
                data.discovery[q.id] = { text: q.text, answer: discoveryAnswers[q.id] || 'N/A' };
            });

            eskerModules[selectedModule].roiQuestions.forEach(q => {
                data.roiInputs.roiQuestions[q.id] = { text: q.text, input: roiAnswers[q.id] || 'N/A' };
            });

            return data;
        }

        function generateMarkdownContent(data) {
            let content = `# Presales Discovery & ROI Report\n\n`;
            content += `## Module: ${data.module}\n\n`;

            content += `### Discovery Questions & Answers\n`;
            for (const key in data.discovery) {
                const q = data.discovery[key];
                content += `* **${q.text}**\n`;
                content += `  Answer: ${q.answer}\n\n`;
            }

            if (data.additionalNotes && data.additionalNotes.length > 0) {
                content += `### Additional Discovery Notes\n`;
                data.additionalNotes.forEach((note, index) => {
                    content += `* **Note ${index + 1}:**\n`;
                    content += `  ${note.text || 'N/A'}\n\n`;
                });
            }

            content += `### ROI Calculator Inputs\n`;
            content += `* **Annual Subscription Cost:** $${data.roiInputs.annualSubscriptionCost || 'N/A'}\n`;
            content += `* **Professional Services Upfront Cost:** $${data.roiInputs.professionalServicesCost || 'N/A'}\n`;
            content += `* **Number of Years Software Will Be Utilised For:** ${data.roiInputs.numberOfYearsUtilized || 'N/A'} Years\n\n`;

            for (const key in data.roiInputs.roiQuestions) {
                const q = data.roiInputs.roiQuestions[key];
                content += `* **${q.text}**\n`;
                content += `  Input: ${q.input}\n\n`;
            }

            if (data.calculatedRoi) {
                content += `### Calculated ROI Summary\n`;
                content += `* **Total Annual Savings:** $${data.calculatedRoi.totalAnnualSavings}\n`;
                content += `* **Total Annual Investment:** $${data.calculatedRoi.annualEskerInvestment}\n`;
                content += `* **Net Annual Benefit:** $${data.calculatedRoi.netAnnualBenefit}\n`;
                content += `* **Total Investment (${data.roiInputs.numberOfYearsUtilized || 3} Years):** $${data.calculatedRoi.totalInvestmentOverYears}\n`;
                content += `* **Total Benefit (${data.roiInputs.numberOfYearsUtilized || 3} Years):** $${data.calculatedRoi.totalBenefitOverYears}\n`;
                content += `* **Net Benefit (${data.roiInputs.numberOfYearsUtilized || 3} Years):** $${data.calculatedRoi.netBenefitOverYears}\n`;
                content += `* **ROI Percentage (${data.roiInputs.numberOfYearsUtilised || 3} Years):** ${data.calculatedRoi.roiPercentage}%\n`;
                content += `* **Payback Period:** ${data.calculatedRoi.paybackPeriodMonths} Months\n\n`;
                content += `#### Detailed Savings Breakdown:\n`;
                for (const key in data.calculatedRoi.details) {
                    content += `* **${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:** $${data.calculatedRoi.details[key]}\n`;
                }

                if (data.calculatedRoi.detailedSavingsBreakdown) {
                    content += `\n#### Savings Calculation Steps:\n`;
                    for (const key in data.calculatedRoi.detailedSavingsBreakdown) {
                        content += `* **${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:** ${data.calculatedRoi.detailedSavingsBreakdown[key]}\n`;
                    }
                }

                if (data.calculatedRoi.annualBreakdown && data.calculatedRoi.annualBreakdown.length > 0) {
                    content += `\n### Annual Breakdown of Investment, Savings & ROI\n`;
                    content += `| Year | Annual Investment ($) | Annual Savings ($) | Net Annual Benefit ($) | Cumulative Investment ($) | Cumulative Benefit ($) | Cumulative ROI (%) |\n`;
                    content += `|------|-----------------------|--------------------|------------------------|---------------------------|------------------------|--------------------|\n`;
                    data.calculatedRoi.annualBreakdown.forEach(yearData => {
                        content += `| ${yearData.year} | $${yearData.annualInvestment} | $${yearData.annualSavings} | $${yearData.netAnnualBenefit} | $${yearData.cumulativeInvestment} | $${yearData.cumulativeBenefit} | ${yearData.cumulativeRoiPercentage}% |\n`;
                    });
                }


            } else {
                content += `### Calculated ROI\nROI has not been calculated yet.\n`;
            }
            return content;
        }

        function generatePlainTextContent(data) {
            let content = `Presales Discovery & ROI Report\n\n`;
            content += `Module: ${data.module}\n\n`;

            content += `Discovery Questions & Answers\n`;
            for (const key in data.discovery) {
                const q = data.discovery[key];
                content += `- ${q.text}\n`;
                content += `  Answer: ${q.answer}\n\n`;
            }

            if (data.additionalNotes && data.additionalNotes.length > 0) {
                content += `Additional Discovery Notes\n`;
                data.additionalNotes.forEach((note, index) => {
                    content += `- Note ${index + 1}:\n`;
                    content += `  ${note.text || 'N/A'}\n\n`;
                });
            }

            content += `ROI Calculator Inputs\n`;
            content += `- Annual Subscription Cost: $${data.roiInputs.annualSubscriptionCost || 'N/A'}\n`;
            content += `- Professional Services Upfront Cost: $${data.roiInputs.professionalServicesCost || 'N/A'}\n`;
            content += `- Number of Years Software Will Be Utilised For: ${data.roiInputs.numberOfYearsUtilized || 'N/A'} Years\n\n`;

            for (const key in data.roiInputs.roiQuestions) {
                const q = data.roiInputs.roiQuestions[key];
                content += `- ${q.text}\n`;
                content += `  Input: ${q.input}\n\n`;
            }

            if (data.calculatedRoi) {
                content += `Calculated ROI Summary\n`;
                content += `- Total Annual Savings: $${data.calculatedRoi.totalAnnualSavings}\n`;
                content += `- Total Annual Investment: $${data.calculatedRoi.annualEskerInvestment}\n`;
                content += `- Net Annual Benefit: $${data.calculatedRoi.netAnnualBenefit}\n`;
                content += `- Total Investment (${data.roiInputs.numberOfYearsUtilized || 3} Years): $${data.calculatedRoi.totalInvestmentOverYears}\n`;
                content += `- Total Benefit (${data.roiInputs.numberOfYearsUtilized || 3} Years): $${data.calculatedRoi.totalBenefitOverYears}\n`;
                content += `- Net Benefit (${data.roiInputs.numberOfYearsUtilized || 3} Years): $${data.calculatedRoi.netBenefitOverYears}\n`;
                content += `- ROI Percentage (${data.roiInputs.numberOfYearsUtilized || 3} Years): ${data.calculatedRoi.roiPercentage}%\n`;
                content += `- Payback Period: ${data.calculatedRoi.paybackPeriodMonths} Months\n\n`;
                content += `Detailed Savings Breakdown:\n`;
                for (const key in data.calculatedRoi.details) {
                    content += `- ${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: $${data.calculatedRoi.details[key]}\n`;
                }

                if (data.calculatedRoi.detailedSavingsBreakdown) {
                    content += `\nSavings Calculation Steps:\n`;
                    for (const key in data.calculatedRoi.detailedSavingsBreakdown) {
                        content += `- ${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: ${data.calculatedRoi.detailedSavingsBreakdown[key]}\n`;
                    }
                }

                if (data.calculatedRoi.annualBreakdown && data.calculatedRoi.annualBreakdown.length > 0) {
                    content += `\nAnnual Breakdown of Investment, Savings & ROI\n`;
                    content += `Year | Annual Investment ($) | Annual Savings ($) | Net Annual Benefit ($) | Cumulative Investment ($) | Cumulative Benefit ($) | Cumulative ROI (%)\n`;
                    content += `-------------------------------------------------------------------------------------------------------------------------------------------------------------------\n`;
                    data.calculatedRoi.annualBreakdown.forEach(yearData => {
                        content += `${yearData.year} | $${yearData.annualInvestment} | $${yearData.annualSavings} | $${yearData.netAnnualBenefit} | $${yearData.cumulativeInvestment} | $${yearData.cumulativeBenefit} | ${yearData.cumulativeRoiPercentage}%\n`;
                    });
                }

            } else {
                content += `Calculated ROI\nROI has not been calculated yet.\n`;
            }
            return content;
        }

        function generateHtmlReportContent(data) {
            let content = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Presales Discovery & ROI Report - ${data.module}</title>
                    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
                    <style>
                        body { font-family: 'Inter', sans-serif; }
                        .text-ms-blue { color: #0078D4; }
                        .bg-ms-blue-light { background-color: #E0F0FA; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
                        th { background-color: #f8f8f8; }
                    </style>
                </head>
                <body class="p-6 bg-gray-100">
                    <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8">
                        <h1 class="text-3xl font-bold text-center text-ms-blue mb-6">Presales Discovery & ROI Report</h1>
                        <h2 class="text-2xl font-semibold text-blue-700 mb-4">Module: ${data.module}</h2>

                        <h3 class="text-xl font-semibold text-blue-600 mb-3">Discovery Questions & Answers</h3>
                        <div class="space-y-3 mb-6">
            `;
            for (const key in data.discovery) {
                const q = data.discovery[key];
                content += `
                            <p><strong>${q.text}</strong></p>
                            <p class="mb-2 pl-4">${q.answer}</p>
                `;
            }

            if (data.additionalNotes && data.additionalNotes.length > 0) {
                content += `
                        <h3 class="text-xl font-semibold text-blue-600 mb-3 mt-6">Additional Discovery Notes</h3>
                        <div class="space-y-3 mb-6">
                `;
                data.additionalNotes.forEach((note, index) => {
                    content += `
                            <p><strong>Note ${index + 1}:</strong></p>
                            <p class="mb-2 pl-4">${note.text || 'N/A'}</p>
                    `;
                });
                content += `
                        </div>
                `;
            }

            content += `
                        <h3 class="text-xl font-semibold text-blue-600 mb-3">ROI Calculator Inputs</h3>
                        <div class="space-y-3 mb-6">
                            <p><strong>Annual Subscription Cost:</strong> $${data.roiInputs.annualSubscriptionCost || 'N/A'}</p>
                            <p><strong>Professional Services Upfront Cost:</strong> $${data.roiInputs.professionalServicesCost || 'N/A'}</p>
                            <p><strong>Number of Years Software Will Be Utilised For:</strong> ${data.roiInputs.numberOfYearsUtilized || 'N/A'} Years</p>
            `;
            for (const key in data.roiInputs.roiQuestions) {
                const q = data.roiInputs.roiQuestions[key];
                content += `
                            <p><strong>${q.text}</strong></p>
                            <p class="mb-2 pl-4">${q.input}</p>
                `;
            }
            content += `
                        </div>
            `;

            if (data.calculatedRoi) {
                content += `
                        <h3 class="text-xl font-semibold text-blue-600 mb-3">Calculated ROI Summary</h3>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                                <p class="font-semibold">Total Annual Savings:</p>
                                <p class="text-right text-green-700 font-bold">$${data.calculatedRoi.totalAnnualSavings}</p>

                                <p class="font-semibold">Total Annual Investment:</p>
                                <p class="text-right text-red-700 font-bold">$${data.calculatedRoi.annualEskerInvestment}</p>

                                <p class="font-semibold">Net Annual Benefit:</p>
                                <p class="text-right text-blue-800 font-bold">$${data.calculatedRoi.netAnnualBenefit}</p>

                                <p class="font-semibold text-xl">Total Investment (${data.roiInputs.numberOfYearsUtilized || 3} Years):</p>
                                <p class="text-right text-xl text-red-700 font-bold">$${data.calculatedRoi.totalInvestmentOverYears}</p>

                                <p class="font-semibold text-xl">Total Benefit (${data.roiInputs.numberOfYearsUtilized || 3} Years):</p>
                                <p class="text-right text-xl text-green-700 font-bold">$${data.calculatedRoi.totalBenefitOverYears}</p>

                                <p class="font-semibold text-2xl">Net Benefit (${data.roiInputs.numberOfYearsUtilized || 3} Years):</p>
                                <p class="text-right text-2xl font-bold text-blue-800">$${data.calculatedRoi.netBenefitOverYears}</p>

                                <p class="font-semibold text-3xl">ROI Percentage (${data.roiInputs.numberOfYearsUtilized || 3} Years):</p>
                                <p class="text-right text-3xl font-bold text-purple-700">${data.calculatedRoi.roiPercentage}%</p>

                                <p class="font-semibold text-2xl">Payback Period:</p>
                                <p class="text-right text-2xl font-bold text-orange-700">${data.calculatedRoi.paybackPeriodMonths} Months</p>
                            </div>
                            <div class="mt-6 border-t pt-4 border-gray-200">
                                <h4 class="text-lg font-semibold text-blue-600 mb-2">Detailed Savings Breakdown:</h4>
                                <div class="space-y-1">
                `;
                for (const key in data.calculatedRoi.details) {
                    content += `
                                    <p class="text-gray-700">
                                        <span class="font-medium">${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:</span> $${data.calculatedRoi.details[key]}
                                    </p>
                    `;
                }
                if (data.calculatedRoi.detailedSavingsBreakdown) {
                    content += `
                                    <h5 class="text-md font-semibold text-blue-600 mt-4 mb-2">Savings Calculation Steps:</h5>
                    `;
                    for (const key in data.calculatedRoi.detailedSavingsBreakdown) {
                        content += `
                                        <p class="text-gray-700">
                                            <span class="font-medium">${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:</span> ${data.calculatedRoi.detailedSavingsBreakdown[key]}
                                        </p>
                        `;
                    }
                }
                content += `
                                </div>
                            </div>
                        </div>

                        <h3 class="text-xl font-semibold text-blue-600 mb-3 mt-6">Annual Breakdown of Investment, Savings & ROI</h3>
                        <div class="overflow-x-auto mb-6">
                            <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden shadow-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Annual Investment ($)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Annual Savings ($)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Annual Benefit ($)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cumulative Investment ($)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cumulative Benefit ($)</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cumulative ROI (%)</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                `;
                if (data.calculatedRoi.annualBreakdown) {
                    data.calculatedRoi.annualBreakdown.forEach(yearData => {
                        content += `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${yearData.year}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-700">$${yearData.annualInvestment}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-700">$${yearData.annualSavings}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-800">$${yearData.netAnnualBenefit}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-700">$${yearData.cumulativeInvestment}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-700">$${yearData.cumulativeBenefit}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold ${parseFloat(yearData.cumulativeRoiPercentage) >= 0 ? 'text-purple-700' : 'text-red-700'}">${yearData.cumulativeRoiPercentage}%</td>
                                    </tr>
                        `;
                    });
                }
                content += `
                                </tbody>
                            </table>
                        </div>
                `;
            } else {
                content += `
                        <h3 class="text-xl font-semibold text-blue-600 mb-3">Calculated ROI</h3>
                        <p class="text-gray-700">ROI has not been calculated yet.</p>
                `;
            }

            content += `
                    </div>
                    <footer class="mt-8 text-center text-gray-500 text-sm">
                        (c) Brad Whatman 2025
                    </footer>
                </body>
                </html>
            `;
            return content;
        }


        // Export data to selected file type
        function exportData() {
            if (!selectedModule) {
                showMessage(validationErrorMessage);
                return;
            }

            const format = document.querySelector('input[name="export-format"]:checked').value;
            const reportData = getReportData();
            let content;
            let filename = `${selectedModule.replace(/\s/g, '_')}_Discovery_ROI_Report`;
            let mimeType;

            switch (format) {
                case 'md':
                    content = generateMarkdownContent(reportData);
                    filename += '.md';
                    mimeType = 'text/markdown;charset=utf-8';
                    break;
                case 'txt':
                    content = generatePlainTextContent(reportData);
                    filename += '.txt';
                    mimeType = 'text/plain;charset=utf-8';
                    break;
                case 'html':
                    content = generateHtmlReportContent(reportData);
                    filename += '.html';
                    mimeType = 'text/html;charset=utf-8';
                    break;
                default:
                    console.error('Unknown export format');
                    return;
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showMessage(exportSuccessMessage);
            setTimeout(() => hideMessage(exportSuccessMessage), 3000);
        }

        // Event Listeners for new buttons
        clearFormButton.addEventListener('click', showConfirmationModal); // Changed to show modal
        confirmClearButton.addEventListener('click', executeClearForm); // New listener for modal OK
        cancelClearButton.addEventListener('click', hideConfirmationModal); // New listener for modal Cancel
        exportDataButton.addEventListener('click', exportData);

        // Add the missing change event listener for the moduleSelect dropdown
        moduleSelect.addEventListener('change', (e) => {
            selectedModule = e.target.value;
            // When module changes, clear previous ROI calculations and reset view to discovery
            calculatedRoi = null;
            currentView = 'discovery';
            renderAppContent(); // Re-render content based on new selection
        });


        // Initial setup on window load
        window.onload = () => {
            populateModuleDropdown();
            // Render initial empty state or default module content
            renderAppContent();
        };
    </script>
</body>
</html>
