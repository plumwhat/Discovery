<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presales Discovery & ROI Tool</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBwdiI+PHBhdGggZD0iTTE1IDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY3WiIvPjxwYXRoIGQ9Ik0xNCAydjRhMiAyIDAgMCAyIDJoNCIvPjxwYXRoGkQ9Ik0xMCA5SDh2NHoiLz48cGF0aCBkPSJNMTYgMTNINjZlLTgiLz48cGF0aCBkPSJNMTYgMTdoNCIvPjwvc3ZnPg==" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-ms-blue { background-color: #0078D4; }
        .hover\:bg-ms-blue-dark:hover { background-color: #005B9C; }
        .text-ms-blue { color: #0078D4; }
        .border-ms-blue-light { border-color: #A0CBE8; }
        .ring-ms-blue { --tw-ring-color: #0078D4; }
        .form-radio:checked { background-color: #0078D4; border-color: #0078D4; }
        select, input[type="number"], textarea { transition: all 0.2s ease-in-out; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        select:focus, input[type="number"]:focus, textarea:focus { box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.25); border-color: #0078D4; }
        button { transition: all 0.3s ease-in-out; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border-radius: 0.5rem; }
        button:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); transform: translateY(-2px); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); max-width: 400px; width: 90%; text-align: center; }
        #app-content .flex button { border-radius: 0.5rem; }
        #app-content .flex button + button { margin-left: -1px; }
        #app-content .flex button:first-child { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        #app-content .flex button:last-child { border-top-left-radius: 0; border-bottom-left-radius: 0; }
        #app-content .flex button:not(:first-child):not(:last-child) { border-radius: 0; }
    </style>
</head>
<body class="min-h-screen bg-gray-50 flex flex-col items-center p-4 font-sans text-gray-800">
    <div class="w-full max-w-4xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-ms-blue mb-6">Presales Discovery & ROI Tool</h1>

        <!-- Stream & Module Selection -->
        <div class="mb-8 p-4 bg-blue-100 rounded-lg shadow-md flex flex-col md:flex-row items-center justify-center gap-4">
             <div class="w-full md:w-1/2 flex flex-col items-center">
                 <label for="stream-select" class="text-lg font-semibold text-blue-800 mb-2">Select Business Stream:</label>
                 <div class="relative w-full">
                     <select id="stream-select" class="block w-full px-4 py-2 pr-8 rounded-md border border-blue-300 bg-white text-gray-900 focus:outline-none focus:ring-2 ring-ms-blue focus:border-transparent appearance-none"></select>
                     <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-blue-700"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg></div>
                 </div>
             </div>
             <div class="w-full md:w-1/2 flex flex-col items-center">
               <label for="module-select" class="text-lg font-semibold text-blue-800 mb-2">Select Module:</label>
               <div class="relative w-full">
                   <select id="module-select" class="block w-full px-4 py-2 pr-8 rounded-md border border-blue-300 bg-white text-gray-900 focus:outline-none focus:ring-2 ring-ms-blue focus:border-transparent appearance-none">
                       <option value="">-- Choose Stream First --</option>
                   </select>
                   <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-blue-700"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg></div>
               </div>
           </div>
        </div>

        <div id="app-content"><!-- Content will be dynamically loaded here by JavaScript --></div>

        <!-- Action Buttons -->
        <div class="mt-8 flex flex-col md:flex-row justify-center items-center gap-4">
            <button id="clear-form-button" class="flex items-center bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg">Clear Module Data</button>
            <div class="flex flex-col items-center p-4 bg-blue-50 rounded-lg shadow-sm">
                <p class="font-semibold text-blue-800 mb-2">Export As:</p>
                <div class="flex flex-wrap justify-center gap-4">
                    <label class="inline-flex items-center"><input type="radio" name="export-format" value="md" checked class="form-radio text-ms-blue"><span class="ml-2">Markdown</span></label>
                    <label class="inline-flex items-center"><input type="radio" name="export-format" value="txt" class="form-radio text-ms-blue"><span class="ml-2">Plain Text</span></label>
                    <label class="inline-flex items-center"><input type="radio" name="export-format" value="html" class="form-radio text-ms-blue"><span class="ml-2">HTML</span></label>
                    <label class="inline-flex items-center"><input type="radio" name="export-format" value="ai-prompt" class="form-radio text-ms-blue"><span class="ml-2">AI Prompt</span></label>
                </div>
                <button id="export-data-button" class="flex items-center bg-ms-blue hover:bg-ms-blue-dark text-white font-bold py-3 px-8 rounded-lg mt-4">Export Data</button>
            </div>
        </div>

        <!-- Messages -->
        <div id="export-success-message" class="hidden mt-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg flex items-center" role="alert"><span>Data exported successfully!</span></div>
        <div id="copy-success-message" class="hidden mt-4 bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg flex items-center" role="alert"><span>Values copied to ROI Calculator!</span></div>
        <div id="validation-error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4 flex items-center justify-between" role="alert"><span>Please ensure all required fields are filled for ROI calculation.</span><button id="close-validation-error" class="ml-4 text-red-700 hover:text-red-900">X</button></div>
    </div>

    <!-- Modal -->
    <div id="confirmation-modal" class="modal hidden"><div class="modal-content"><p class="text-lg font-semibold mb-4">Are you sure you want to clear all data for this module?</p><div class="flex justify-center gap-4"><button id="confirm-clear-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-5 rounded-lg">OK</button><button id="cancel-clear-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-5 rounded-lg">Cancel</button></div></div></div>
    <footer class="mt-8 text-gray-500 text-sm">(c) Brad Whatman 2025</footer>

    <script>
        const FTE_HOURS_PER_YEAR = 2080;

        const appModules = {
            'Finance Automation': {
                'Accounts Payable': {
                    questions: [
                        { id: 'ap1', text: 'How many invoices do you process per month?', type: 'number' },
                        { id: 'ap2', text: 'What percentage of invoices are PO-based?', type: 'number', unit: '%' },
                        { id: 'ap3', text: 'How many FTEs are dedicated to the AP process?', type: 'number', unit: 'FTEs' },
                        { id: 'ap4', text: 'What is your average cost to process a single invoice?', type: 'number', unit: '$' },
                        { id: 'ap5', text: 'What is your current on-time payment percentage?', type: 'number', unit: '%' },
                        { id: 'ap6', text: 'Do you currently capture early payment discounts? If so, what is the annual value?', type: 'number', unit: '$' },
                        { id: 'ap7', text: 'How are non-PO invoices approved currently?', type: 'textarea' },
                        { id: 'ap8', text: 'What are the biggest challenges with invoice exceptions and discrepancies?', type: 'textarea' },
                        { id: 'ap9', text: 'Describe your current process for supplier onboarding and information management.', type: 'textarea' },
                        { id: 'ap10', text: 'How much time is spent responding to supplier inquiries about payment status?', type: 'number', unit: 'Hours/Week' },
                        { id: 'ap11', text: 'What systems are currently involved in your AP process (ERP, document storage, etc.)?', type: 'textarea' },
                        { id: 'ap12', text: 'What are your key AP-related KPIs and how do you track them?', type: 'textarea' },
                        { id: 'ap13', text: 'Do you have visibility into accruals and liabilities at month-end?', type: 'textarea' },
                        { id: 'ap14', text: 'What is the biggest pain point in your current AP process?', type: 'textarea' },
                        { id: 'ap15', text: 'How do you handle different invoice formats (paper, PDF, EDI)?', type: 'textarea' },
                        { id: 'ap16', text: 'Describe your process for managing expense reports and employee reimbursements.', type: 'textarea' },
                        { id: 'ap17', text: 'How do you ensure compliance with internal controls and external regulations?', type: 'textarea' },
                        { id: 'ap18', text: 'What is the impact of manual data entry on accuracy and efficiency?', type: 'textarea' },
                        { id: 'ap19', text: 'How do you manage relationships and communications with your suppliers?', type: 'textarea' },
                        { id: 'ap20', text: 'What are your primary goals for improving the AP process?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_ap1', text: 'Annual invoice volume', type: 'number' },
                        { id: 'roi_ap2', text: 'Average cost per invoice', type: 'number', unit: '$' },
                        { id: 'roi_ap3', text: 'Number of AP full-time employees', type: 'number', unit: 'FTEs' },
                        { id: 'roi_ap4', text: 'Average annual salary + benefits for AP staff', type: 'number', unit: '$' },
                        { id: 'roi_ap5', text: 'Annual value of missed early payment discounts', type: 'number', unit: '$' },
                        { id: 'roi_ap6', text: 'Annual cost of late payment fees', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_ap1: 60000, roi_ap2: 12.50, roi_ap3: 4, roi_ap4: 65000, roi_ap5: 25000, roi_ap6: 5000 },
                    roiCalculationFormulas: [
                        { name: 'Invoice Processing Cost Savings', formula: (i,s) => i.invoiceVolume * (i.costPerInvoice * 0.70), inputs: { invoiceVolume: 'roi_ap1', costPerInvoice: 'roi_ap2' }, description: (i,s) => `(70% reduction on processing cost for ${i.invoiceVolume} invoices)` },
                        { name: 'Productivity Gains (FTE Re-allocation)', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.40, inputs: { fteCount: 'roi_ap3', avgSalary: 'roi_ap4' }, description: (i,s) => `(40% productivity gain for ${i.fteCount} FTEs)` },
                        { name: 'Early Payment Discount Capture', formula: (i,s) => i.missedDiscounts * 0.80, inputs: { missedDiscounts: 'roi_ap5' }, description: (i,s) => `(Capture 80% of missed discounts)` },
                        { name: 'Late Payment Fee Elimination', formula: (i,s) => i.lateFees, inputs: { lateFees: 'roi_ap6' }, description: (i,s) => `(Eliminate 100% of late fees)` },
                    ]
                },
                'Accounts Receivable': {
                    questions: [
                        { id: 'ar1', text: 'How many invoices do you issue per month?', type: 'number' },
                        { id: 'ar2', text: 'What is your average invoice value?', type: 'number', unit: '$' },
                        { id: 'ar3', text: 'What is your current DSO (Days Sales Outstanding)?', type: 'number', unit: 'Days' },
                        { id: 'ar4', text: 'What percentage of invoices are paid on time?', type: 'number', unit: '%' },
                        { id: 'ar5', text: 'What challenges do you face with cash application?', type: 'textarea' },
                        { id: 'ar6', text: 'How do you currently handle customer disputes?', type: 'textarea' },
                        { id: 'ar7', text: 'Do you use a customer portal for payments/inquiries?', type: 'textarea' },
                        { id: 'ar8', text: 'How many staff are involved in AR processes?', type: 'number', unit: 'FTEs' },
                        { id: 'ar9', text: 'What is the average time spent on follow-up calls/emails per invoice?', type: 'number', unit: 'Minutes' },
                        { id: 'ar10', text: 'What is your current bad debt percentage?', type: 'number', unit: '%' },
                        { id: 'ar11', text: 'Describe your current process for credit management and risk assessment.', type: 'textarea' },
                        { id: 'ar12', text: 'How do you onboard new customers from an AR perspective?', type: 'textarea' },
                        { id: 'ar13', text: 'What is your current method for sending invoices (e.g., email, postal mail, EDI)?', type: 'textarea' },
                        { id: 'ar14', text: 'How do you track and manage payment promises?', type: 'textarea' },
                        { id: 'ar15', text: 'What reporting and analytics do you currently use for AR performance?', type: 'textarea' },
                        { id: 'ar16', text: 'Are there any specific compliance requirements for your invoicing process?', type: 'textarea' },
                        { id: 'ar17', text: 'How do you handle multi-currency invoices?', type: 'textarea' },
                        { id: 'ar18', text: 'What is the biggest pain point in your current AR process?', type: 'textarea' },
                        { id: 'ar19', text: 'What systems are currently integrated with your AR process (e.g., ERP, CRM)?', type: 'textarea' },
                        { id: 'ar20', text: 'What are your goals for improving your AR process?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_ar1', text: 'Annual invoice volume', type: 'number' },
                        { id: 'roi_ar2', text: 'Average invoice value', type: 'number', unit: '$' },
                        { id: 'roi_ar3', text: 'Current DSO', type: 'number', unit: 'Days' },
                        { id: 'roi_ar4', text: 'AR full-time employees', type: 'number', unit: 'FTEs' },
                        { id: 'roi_ar5', text: 'Average annual salary + benefits for AR staff', type: 'number', unit: '$' },
                        { id: 'roi_ar6', text: 'Annual bad debt write-offs', type: 'number', unit: '$' },
                        { id: 'roi_ar7', text: 'Cost of capital', type: 'number', unit: '%' },
                    ],
                    demoRoiData: { roi_ar1: 120000, roi_ar2: 1500, roi_ar3: 45, roi_ar4: 5, roi_ar5: 75000, roi_ar6: 50000, roi_ar7: 5 },
                    roiCalculationFormulas: [
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.35, inputs: { fteCount: 'roi_ar4', avgSalary: 'roi_ar5' }, description: (i,s) => `(35% productivity gain for ${i.fteCount} FTEs)` },
                        { name: 'DSO Reduction Savings', formula: (i,s) => ((i.invoiceVolume * i.avgValue) / 365) * 10 * (i.costOfCapital/100), inputs: { invoiceVolume: 'roi_ar1', avgValue: 'roi_ar2', costOfCapital: 'roi_ar7' }, description: (i,s) => `(10-day reduction in DSO)` },
                        { name: 'Bad Debt Reduction', formula: (i,s) => i.badDebt * 0.15, inputs: { badDebt: 'roi_ar6' }, description: (i,s) => `(15% reduction in bad debt)` }
                    ]
                },
                'Order Management': {
                    questions: [
                        { id: 'om1', text: 'How many sales orders do you process per month?', type: 'number' },
                        { id: 'om2', text: 'What is your average order value?', type: 'number', unit: '$' },
                        { id: 'om3', text: 'What percentage of orders are received manually (e.g., phone, fax, email)?', type: 'number', unit: '%' },
                        { id: 'om4', text: 'What is your average order processing time (from receipt to fulfilment)?', type: 'number', unit: 'Days' },
                        { id: 'om5', text: 'What challenges do you face with order entry accuracy?', type: 'textarea' },
                        { id: 'om6', text: 'How do you currently handle order changes or cancellations?', type: 'textarea' },
                        { id: 'om7', text: 'Do you have a customer self-service portal for order placement or tracking?', type: 'textarea' },
                        { id: 'om8', text: 'How many staff are involved in Order Management processes?', type: 'number', unit: 'FTEs' },
                        { id: 'om9', text: 'What is the average time spent on order status inquiries?', type: 'number', unit: 'Minutes' },
                        { id: 'om10', text: 'What is your current order error rate?', type: 'number', unit: '%' },
                        { id: 'om11', text: 'How do you manage pricing and discounts for orders?', type: 'textarea' },
                        { id: 'om12', text: 'What is your process for managing backorders and partial shipments?', type: 'textarea' },
                        { id: 'om13', text: 'How do you integrate with your warehouse or logistics partners?', type: 'textarea' },
                        { id: 'om14', text: 'What reporting and analytics do you currently use for OM performance?', type: 'textarea' },
                        { id: 'om15', text: 'Are there any specific compliance requirements for your order processing?', type: 'textarea' },
                        { id: 'om16', text: 'How do you handle multi-currency orders?', type: 'textarea' },
                        { id: 'om17', text: 'What is the biggest pain point in your current Order Management process?', type: 'textarea' },
                        { id: 'om18', text: 'What systems are currently integrated with your OM process (e.g., ERP, CRM, WMS)?', type: 'textarea' },
                        { id: 'om19', text: 'What are your goals for improving your Order Management process?', type: 'textarea' },
                        { id: 'om20', text: 'How do you manage customer credit limits during the order process?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_om1', text: 'Annual volume of sales orders', type: 'number' },
                        { id: 'roi_om2', text: 'Average cost to manually process one sales order', type: 'number', unit: '$' },
                        { id: 'roi_om3', text: 'Number of order errors per month', type: 'number' },
                        { id: 'roi_om4', text: 'Average cost of correcting an order error', type: 'number', unit: '$' },
                        { id: 'roi_om5', text: 'Number of OM full-time employees', type: 'number', unit: 'FTEs' },
                        { id: 'roi_om6', text: 'Average annual salary + benefits for OM staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_om1: 72000, roi_om2: 4.00, roi_om3: 30, roi_om4: 25, roi_om5: 4, roi_om6: 70000 },
                    roiCalculationFormulas: [
                        { name: 'Manual Processing Savings', formula: (i,s) => (i.annualOrders * 0.65) * i.manualCost, inputs: { annualOrders: 'roi_om1', manualCost: 'roi_om2' }, description: (i,s) => `(65% reduction on processing cost for ${i.annualOrders} orders)` },
                        { name: 'Error Correction Savings', formula: (i,s) => (i.monthlyErrors * 12) * i.errorCost * 0.70, inputs: { monthlyErrors: 'roi_om3', errorCost: 'roi_om4' }, description: (i,s) => `(70% reduction in error correction costs)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.30, inputs: { fteCount: 'roi_om5', avgSalary: 'roi_om6' }, description: (i,s) => `(30% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Procurement': {
                    questions: [
                        { id: 'p1', text: 'How many purchase requisitions do you process per month?', type: 'number' },
                        { id: 'p2', text: 'What is your average purchase order value?', type: 'number', unit: '$' },
                        { id: 'p3', text: 'What percentage of purchases are made off-contract or through "maverick spend"?', type: 'number', unit: '%' },
                        { id: 'p4', text: 'What is your average requisition-to-PO cycle time?', type: 'number', unit: 'Days' },
                        { id: 'p5', text: 'What challenges do you face with manual purchase order creation and approval?', type: 'textarea' },
                        { id: 'p6', text: 'How do you manage supplier catalogues and pricing?', type: 'textarea' },
                        { id: 'p7', text: 'How many staff are involved in the procurement process (from requisition to PO)?', type: 'number', unit: 'FTEs' },
                        { id: 'p8', text: 'What is your current PO error rate?', type: 'number', unit: '%' },
                        { id: 'p9', text: 'How do you handle purchase order changes or cancellations?', type: 'textarea' },
                        { id: 'p10', text: 'What systems are currently integrated with your procurement process (e.g., ERP, inventory)?', type: 'textarea' },
                        { id: 'p11', text: 'What is the biggest pain point in your current procurement process?', type: 'textarea' },
                        { id: 'p12', text: 'How do you ensure compliance with procurement policies and regulations?', type: 'textarea' },
                        { id: 'p13', text: 'What reporting and analytics do you use for procurement performance?', type: 'textarea' },
                        { id: 'p14', text: 'How do you manage non-PO based invoices?', type: 'textarea' },
                        { id: 'p15', text: 'Do you have a centralised purchasing function?', type: 'textarea' },
                        { id: 'p16', text: 'How do you track savings generated by procurement initiatives?', type: 'textarea' },
                        { id: 'p17', text: 'What is your process for managing goods receipt and invoice matching?', type: 'textarea' },
                        { id: 'p18', text: 'How do you onboard new suppliers from a procurement perspective?', type: 'textarea' },
                        { id: 'p19', text: 'What is the impact of manual procurement on budget control?', type: 'textarea' },
                        { id: 'p20', text: 'What are your goals for improving procurement efficiency and cost savings?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_p1', text: 'Annual volume of purchase orders', type: 'number' },
                        { id: 'roi_p2', text: 'Total annual spend', type: 'number', unit: '$' },
                        { id: 'roi_p3', text: 'Current percentage of "maverick spend"', type: 'number', unit: '%' },
                        { id: 'roi_p4', text: 'Procurement full-time employees', type: 'number', unit: 'FTEs' },
                        { id: 'roi_p5', text: 'Average annual salary + benefits for procurement staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_p1: 24000, roi_p2: 5000000, roi_p3: 15, roi_p4: 3, roi_p5: 70000 },
                    roiCalculationFormulas: [
                        { name: 'Maverick Spend Savings', formula: (i,s) => i.totalSpend * (i.maverickPct/100) * 0.10, inputs: { totalSpend: 'roi_p2', maverickPct: 'roi_p3' }, description: (i,s) => `(10% savings on ${i.maverickPct}% of spend)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.25, inputs: { fteCount: 'roi_p4', avgSalary: 'roi_p5' }, description: (i,s) => `(25% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Expense Management': {
                    questions: [
                        { id: 'em1', text: 'How many expense reports are submitted per month?', type: 'number' },
                        { id: 'em2', text: 'What is the average number of line items per expense report?', type: 'number' },
                        { id: 'em3', text: 'How long does it take for an employee to complete and submit an expense report?', type: 'number', unit: 'Minutes' },
                        { id: 'em4', text: 'How long does it take for an expense report to be approved and reimbursed?', type: 'number', unit: 'Days' },
                        { id: 'em5', text: 'What percentage of expense reports are non-compliant with company policy?', type: 'number', unit: '%' },
                        { id: 'em6', text: 'How many FTEs are involved in processing and auditing expense reports?', type: 'number', unit: 'FTEs' },
                        { id: 'em7', text: 'What is the biggest challenge with your current expense management process?', type: 'textarea' },
                        { id: 'em8', text: 'How do you handle receipt management (paper, digital, etc.)?', type: 'textarea' },
                        { id: 'em9', text: 'Describe your current approval workflow for expense reports.', type: 'textarea' },
                        { id: 'em10', text: 'Do you use corporate credit cards? If so, how is that data reconciled?', type: 'textarea' },
                        { id: 'em11', text: 'How much visibility do you have into T&E (Travel and Expense) spend?', type: 'textarea' },
                        { id: 'em12', text: 'What is the impact of out-of-policy spend on your budget?', type: 'textarea' },
                        { id: 'em13', text: 'How do you manage per diems and mileage claims?', type: 'textarea' },
                        { id: 'em14', text: 'What are your goals for improving the expense management process?', type: 'textarea' },
                        { id: 'em15', text: 'What is the employee satisfaction level with the current expense process?', type: 'textarea' },
                        { id: 'em16', text: 'How do you ensure tax and regulatory compliance (e.g., VAT, FBT)?', type: 'textarea' },
                        { id: 'em17', text: 'What ERP or accounting system do you use?', type: 'textarea' },
                        { id: 'em18', text: 'What is your process for auditing expense reports?', type: 'textarea' },
                        { id: 'em19', text: 'How do you handle multi-currency expenses?', type: 'textarea' },
                        { id: 'em20', text: 'Describe a time when a manual expense process caused a significant issue.', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_em1', text: 'Annual number of expense reports', type: 'number' },
                        { id: 'roi_em2', text: 'Average cost to process one expense report', type: 'number', unit: '$' },
                        { id: 'roi_em3', text: 'Annual non-compliant or out-of-policy spend', type: 'number', unit: '$' },
                        { id: 'roi_em4', text: 'Number of employees submitting expenses', type: 'number' },
                        { id: 'roi_em5', text: 'Average hours per employee per year spent on expense reports', type: 'number', unit: 'Hours' },
                        { id: 'roi_em6', text: 'Average hourly cost of submitting employee', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_em1: 5000, roi_em2: 25, roi_em3: 100000, roi_em4: 250, roi_em5: 8, roi_em6: 50 },
                    roiCalculationFormulas: [
                        { name: 'Processing Cost Reduction', formula: (i,s) => i.reports * (i.costPerReport * 0.75), inputs: { reports: 'roi_em1', costPerReport: 'roi_em2' }, description: (i,s) => `(75% reduction in processing cost)` },
                        { name: 'Improved Policy Compliance', formula: (i,s) => i.nonCompliantSpend * 0.10, inputs: { nonCompliantSpend: 'roi_em3' }, description: (i,s) => `(10% reduction in non-compliant spend)` },
                        { name: 'Employee Productivity Savings', formula: (i,s) => i.employees * i.hoursSpent * i.hourlyCost, inputs: { employees: 'roi_em4', hoursSpent: 'roi_em5', hourlyCost: 'roi_em6' }, description: (i,s) => `(Time savings for ${i.employees} employees)` }
                    ]
                },
                'Cash Application': {
                    questions: [
                        { id: 'ca1', text: 'How many payments do you receive per day/week?', type: 'number' },
                        { id: 'ca2', text: 'What percentage of payments are received via cheque/manual methods?', type: 'number', unit: '%' },
                        { id: 'ca3', text: 'What is the average time to apply a payment?', type: 'number', unit: 'Minutes' },
                        { id: 'ca4', text: 'What percentage of payments are unapplied or suspense items?', type: 'number', unit: '%' },
                        { id: 'ca5', text: 'How do you handle remittances without clear invoice matching?', type: 'textarea' },
                        { id: 'ca6', text: 'How many FTEs are dedicated to cash application?', type: 'number', unit: 'FTEs' },
                        { id: 'ca7', text: 'What systems are involved in your cash application process?', type: 'textarea' },
                        { id: 'ca8', text: 'How do you resolve payment discrepancies or short payments?', type: 'textarea' },
                        { id: 'ca9', text: 'What is your current reconciliation process for bank statements and applied cash?', type: 'textarea' },
                        { id: 'ca10', text: 'How do you manage lockbox services, if applicable?', type: 'textarea' },
                        { id: 'ca11', text: 'What is the biggest pain point in your current cash application process?', type: 'textarea' },
                        { id: 'ca12', text: 'How quickly are payments reflected in customer accounts?', type: 'textarea' },
                        { id: 'ca13', text: 'What reporting do you have on cash application accuracy and efficiency?', type: 'textarea' },
                        { id: 'ca14', text: 'Do you use any automation for cash application today?', type: 'textarea' },
                        { id: 'ca15', text: 'How do you handle multi-currency payments?', type: 'textarea' },
                        { id: 'ca16', text: 'What is the volume of customer deductions or chargebacks you process?', type: 'number' },
                        { id: 'ca17', text: 'How do you ensure data security and compliance in cash application?', type: 'textarea' },
                        { id: 'ca18', text: 'What impact does slow cash application have on your DSO or credit limits?', type: 'textarea' },
                        { id: 'ca19', text: 'How do you communicate with customers about payment application issues?', type: 'textarea' },
                        { id: 'ca20', text: 'What are your goals for improving cash application speed and accuracy?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_ca1', text: 'Annual volume of payments received', type: 'number' },
                        { id: 'roi_ca2', text: 'Percentage of payments requiring manual intervention', type: 'number', unit: '%' },
                        { id: 'roi_ca3', text: 'Average cost to manually apply one payment', type: 'number', unit: '$' },
                        { id: 'roi_ca4', text: 'Cash Application FTEs', type: 'number', unit: 'FTEs' },
                        { id: 'roi_ca5', text: 'Average annual salary + benefits for cash app staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_ca1: 50000, roi_ca2: 50, roi_ca3: 2.50, roi_ca4: 2, roi_ca5: 65000 },
                    roiCalculationFormulas: [
                        { name: 'Manual Application Savings', formula: (i,s) => i.annualPayments * (i.manualPct/100) * i.manualCost, inputs: { annualPayments: 'roi_ca1', manualPct: 'roi_ca2', manualCost: 'roi_ca3' }, description: (i,s) => `(Processing savings on ${i.manualPct}% of payments)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.50, inputs: { fteCount: 'roi_ca4', avgSalary: 'roi_ca5' }, description: (i,s) => `(50% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Collections Management': {
                    questions: [
                        { id: 'cm1', text: 'What is your current collection effectiveness index (CEI)?', type: 'number' },
                        { id: 'cm2', text: 'How many collection calls/emails do you make per day/week?', type: 'number' },
                        { id: 'cm3', text: 'What percentage of overdue invoices require manual follow-up?', type: 'number', unit: '%' },
                        { id: 'cm4', text: 'How do you prioritise collection activities?', type: 'textarea' },
                        { id: 'cm5', text: 'What tools do you use for collections (e.g., spreadsheets, ERP module)?', type: 'textarea' },
                        { id: 'cm6', text: 'How do you handle payment promises and broken promises?', type: 'textarea' },
                        { id: 'cm7', text: 'What is your average time to resolve a collection dispute?', type: 'number', unit: 'Days' },
                        { id: 'cm8', text: 'How many FTEs are dedicated to collections?', type: 'number', unit: 'FTEs' },
                        { id: 'cm9', text: 'What is your current write-off rate for uncollectible debt?', type: 'number', unit: '%' },
                        { id: 'cm10', text: 'How do you communicate with customers regarding overdue payments?', type: 'textarea' },
                        { id: 'cm11', text: 'Do you use dunning letters? If so, what is the process?', type: 'textarea' },
                        { id: 'cm12', text: 'How do you escalate overdue accounts?', type: 'textarea' },
                        { id: 'cm13', text: 'What reporting do you have on collection performance?', type: 'textarea' },
                        { id: 'cm14', text: 'Are there any specific compliance requirements for your collections process?', type: 'textarea' },
                        { id: 'cm15', text: 'How do you manage customer relationships during collections?', type: 'textarea' },
                        { id: 'cm16', text: 'What is the biggest challenge in your current collections process?', type: 'textarea' },
                        { id: 'cm17', text: 'How do you handle partial payments or payment plans?', type: 'textarea' },
                        { id: 'cm18', text: 'What is your process for sending accounts to third-party collections?', type: 'textarea' },
                        { id: 'cm19', text: 'How do you ensure consistency in your collection efforts?', type: 'textarea' },
                        { id: 'cm20', text: 'What are your goals for improving collections efficiency and effectiveness?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_cm1', text: 'Annual bad debt write-offs', type: 'number', unit: '$' },
                        { id: 'roi_cm2', text: 'Collections full-time employees', type: 'number', unit: 'FTEs' },
                        { id: 'roi_cm3', text: 'Average annual salary + benefits for collections staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_cm1: 50000, roi_cm2: 3, roi_cm3: 65000 },
                    roiCalculationFormulas: [
                        { name: 'Bad Debt Reduction', formula: (i,s) => i.badDebt * 0.20, inputs: { badDebt: 'roi_cm1' }, description: (i,s) => `(20% reduction in bad debt)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.40, inputs: { fteCount: 'roi_cm2', avgSalary: 'roi_cm3' }, description: (i,s) => `(40% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Credit Management': {
                    questions: [
                        { id: 'crm1', text: 'How many new credit applications do you process per month?', type: 'number' },
                        { id: 'crm2', text: 'What is your average time to approve/deny a credit application?', type: 'number', unit: 'Days' },
                        { id: 'crm3', text: 'What sources of information do you use for credit assessment (e.g., D&B, trade references)?', type: 'textarea' },
                        { id: 'crm4', text: 'How do you set and manage customer credit limits?', type: 'textarea' },
                        { id: 'crm5', text: 'What percentage of credit applications require manual review and approval?', type: 'number', unit: '%' },
                        { id: 'crm6', text: 'How many FTEs are dedicated to credit management?', type: 'number', unit: 'FTEs' },
                        { id: 'crm7', text: 'What is your current bad debt rate?', type: 'number', unit: '%' },
                        { id: 'crm8', text: 'How do you monitor customer credit risk on an ongoing basis?', type: 'textarea' },
                        { id: 'crm9', text: 'What is your process for reviewing and adjusting existing credit limits?', type: 'textarea' },
                        { id: 'crm10', text: 'How do you communicate credit decisions to customers?', type: 'textarea' },
                        { id: 'crm11', text: 'What is the biggest pain point in your current credit management process?', type: 'textarea' },
                        { id: 'crm12', text: 'How do credit decisions impact sales cycles?', type: 'textarea' },
                        { id: 'crm13', text: 'What reporting do you have on credit risk and exposure?', type: 'textarea' },
                        { id: 'crm14', text: 'Do you have a consistent credit policy across all customers/regions?', type: 'textarea' },
                        { id: 'crm15', text: 'How do you handle credit holds or blocked orders?', type: 'textarea' },
                        { id: 'crm16', text: 'What systems are integrated with your credit management process?', type: 'textarea' },
                        { id: 'crm17', text: 'How do you manage credit insurance, if applicable?', type: 'textarea' },
                        { id: 'crm18', text: 'What is the impact of manual credit checks on operational efficiency?', type: 'textarea' },
                        { id: 'crm19', text: 'How do you ensure compliance with credit regulations?', type: 'textarea' },
                        { id: 'crm20', text: 'What are your goals for improving credit decision speed and risk mitigation?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_crm1', text: 'Annual bad debt write-offs', type: 'number', unit: '$' },
                        { id: 'roi_crm2', text: 'Annual value of sales lost due to slow credit decisions', type: 'number', unit: '$' },
                        { id: 'roi_crm3', text: 'Credit Management FTEs', type: 'number', unit: 'FTEs' },
                        { id: 'roi_crm4', text: 'Average annual salary + benefits for credit staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_crm1: 75000, roi_crm2: 20000, roi_crm3: 2, roi_crm4: 70000 },
                    roiCalculationFormulas: [
                        { name: 'Bad Debt Reduction', formula: (i,s) => i.badDebt * 0.10, inputs: { badDebt: 'roi_crm1' }, description: (i,s) => `(10% reduction in bad debt)` },
                        { name: 'Reduced Lost Sales', formula: (i,s) => i.lostSales * 0.20, inputs: { lostSales: 'roi_crm2' }, description: (i,s) => `(20% reduction in lost sales)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.50, inputs: { fteCount: 'roi_crm3', avgSalary: 'roi_crm4' }, description: (i,s) => `(50% productivity gain for ${i.fteCount} FTEs)` }
                    ]
                },
                'Customer Inquiry': {
                    questions: [
                        { id: 'ci1', text: 'How many customer inquiries (e.g., invoice, order status) do you receive per day/week?', type: 'number' },
                        { id: 'ci2', text: 'What is the average time to resolve a customer inquiry?', type: 'number', unit: 'Minutes' },
                        { id: 'ci3', text: 'What channels do customers use to submit inquiries (e.g., phone, email, portal)?', type: 'textarea' },
                        { id: 'ci4', text: 'What percentage of inquiries require manual research across multiple systems?', type: 'number', unit: '%' },
                        { id: 'ci5', text: 'How many FTEs are dedicated to handling customer inquiries?', type: 'number', unit: 'FTEs' },
                        { id: 'ci6', text: 'What is your current customer satisfaction (CSAT) score related to inquiry resolution?', type: 'number' },
                        { id: 'ci7', text: 'How do you track and report on inquiry volumes and resolution times?', type: 'textarea' },
                        { id: 'ci8', text: 'What are the most common types of customer inquiries you receive?', type: 'textarea' },
                        { id: 'ci9', text: 'Do you have a knowledge base or FAQ for customers?', type: 'textarea' },
                        { id: 'ci10', text: 'How do you escalate complex inquiries?', type: 'textarea' },
                        { id: 'ci11', text: 'What systems do your inquiry agents access to resolve issues?', type: 'textarea' },
                        { id: 'ci12', text: 'How do you handle inquiries outside of business hours?', type: 'textarea' },
                        { id: 'ci13', text: 'What is the biggest pain point in your current inquiry process?', type: 'textarea' },
                        { id: 'ci14', text: 'How do you ensure consistent responses to common inquiries?', type: 'textarea' },
                        { id: 'ci15', text: 'What training do your staff receive for handling inquiries?', type: 'textarea' },
                        { id: 'ci16', text: 'Do you have self-service options for customers to find answers?', type: 'textarea' },
                        { id: 'ci17', text: 'How do you measure the efficiency of your inquiry handling?', type: 'textarea' },
                        { id: 'ci18', text: 'What is the impact of unresolved inquiries on customer relationships?', type: 'textarea' },
                        { id: 'ci19', text: 'How do you manage communication with customers during the inquiry resolution process?', type: 'textarea' },
                        { id: 'ci20', text: 'What are your goals for improving customer inquiry handling?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_ci1', text: 'Annual volume of customer inquiries', type: 'number' },
                        { id: 'roi_ci2', text: 'Average cost per manual inquiry resolution', type: 'number', unit: '$' },
                        { id: 'roi_ci3', text: 'Inquiry Handling FTEs', type: 'number', unit: 'FTEs' },
                        { id: 'roi_ci4', text: 'Average annual salary + benefits for inquiry staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_ci1: 10000, roi_ci2: 2.00, roi_ci3: 3, roi_ci4: 60000 },
                    roiCalculationFormulas: [
                        { name: 'Manual Inquiry Savings', formula: (i,s) => i.annualInquiries * i.manualCost * 0.50, inputs: { annualInquiries: 'roi_ci1', manualCost: 'roi_ci2' }, description: (i,s) => `(50% automation of inquiry resolution)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.30, inputs: { fteCount: 'roi_ci3', avgSalary: 'roi_ci4' }, description: (i,s) => `(30% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Supplier Management': {
                    questions: [
                        { id: 'sm1', text: 'How many active suppliers do you manage?', type: 'number' },
                        { id: 'sm2', text: 'What is your average time to onboard a new supplier?', type: 'number', unit: 'Days' },
                        { id: 'sm3', text: 'How do you collect and maintain supplier information (e.g., banking, certifications)?', type: 'textarea' },
                        { id: 'sm4', text: 'How do you assess and monitor supplier performance?', type: 'textarea' },
                        { id: 'sm5', text: 'What challenges do you face with supplier communication and collaboration?', type: 'textarea' },
                        { id: 'sm6', text: 'How do you manage supplier contracts and renewals?', type: 'textarea' },
                        { id: 'sm7', text: 'How many FTEs are involved in supplier management activities?', type: 'number', unit: 'FTEs' },
                        { id: 'sm8', text: 'What is your current process for supplier risk assessment?', type: 'textarea' },
                        { id: 'sm9', text: 'How do you handle supplier disputes or issues?', type: 'textarea' },
                        { id: 'sm10', text: 'What systems do you use for supplier management?', type: 'textarea' },
                        { id: 'sm11', text: 'What is the biggest pain point in your current supplier management process?', type: 'textarea' },
                        { id: 'sm12', text: 'How do you ensure compliance with supplier diversity initiatives?', type: 'textarea' },
                        { id: 'sm13', text: 'What reporting do you have on supplier performance and compliance?', type: 'textarea' },
                        { id: 'sm14', text: 'How do you manage supplier master data accuracy?', type: 'textarea' },
                        { id: 'sm15', text: 'Do you have a supplier portal? If so, describe its functionality.', type: 'textarea' },
                        { id: 'sm16', text: 'How do you handle supplier inquiries regarding payments or POs?', type: 'textarea' },
                        { id: 'sm17', text: 'What is the impact of poor supplier data quality?', type: 'textarea' },
                        { id: 'sm18', text: 'How do you manage supplier segmentation?', type: 'textarea' },
                        { id: 'sm19', text: 'What is your process for offboarding suppliers?', type: 'textarea' },
                        { id: 'sm20', text: 'What are your goals for improving supplier relationships and compliance?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_sm1', text: 'Annual volume of new supplier onboardings', type: 'number' },
                        { id: 'roi_sm2', text: 'Average cost to manually onboard one supplier', type: 'number', unit: '$' },
                        { id: 'roi_sm3', text: 'Annual cost of supplier non-compliance issues', type: 'number', unit: '$' },
                        { id: 'roi_sm4', text: 'Supplier Management FTEs', type: 'number', unit: 'FTEs' },
                        { id: 'roi_sm5', text: 'Average annual salary + benefits for SM staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_sm1: 200, roi_sm2: 15.00, roi_sm3: 5000, roi_sm4: 1, roi_sm5: 65000 },
                    roiCalculationFormulas: [
                        { name: 'Manual Onboarding Savings', formula: (i,s) => i.onboardings * i.manualCost * 0.60, inputs: { onboardings: 'roi_sm1', manualCost: 'roi_sm2' }, description: (i,s) => `(60% automation of onboarding)` },
                        { name: 'Non-Compliance Savings', formula: (i,s) => i.nonComplianceCost * 0.20, inputs: { nonComplianceCost: 'roi_sm3' }, description: (i,s) => `(20% reduction in non-compliance costs)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.30, inputs: { fteCount: 'roi_sm4', avgSalary: 'roi_sm5' }, description: (i,s) => `(30% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Sourcing': {
                    questions: [
                        { id: 's1', text: 'How many sourcing events (RFQs, RFPs) do you conduct per year?', type: 'number' },
                        { id: 's2', text: 'What is your average sourcing cycle time (from need identification to contract award)?', type: 'number', unit: 'Days' },
                        { id: 's3', text: 'How do you identify potential suppliers for sourcing events?', type: 'textarea' },
                        { id: 's4', text: 'What tools do you use for managing sourcing events (e.g., email, spreadsheets, e-sourcing platform)?', type: 'textarea' },
                        { id: 's5', text: 'What challenges do you face with supplier bidding and negotiation?', type: 'textarea' },
                        { id: 's6', text: 'How do you analyse bids and select suppliers?', type: 'textarea' },
                        { id: 's7', text: 'How many FTEs are involved in sourcing activities?', type: 'number', unit: 'FTEs' },
                        { id: 's8', text: 'What is your average savings percentage achieved through sourcing events?', type: 'number', unit: '%' },
                        { id: 's9', text: 'How do you manage contract creation and signing after sourcing?', type: 'textarea' },
                        { id: 's10', text: 'What is the biggest pain point in your current sourcing process?', type: 'textarea' },
                        { id: 's11', text: 'How do you ensure transparency and fairness in your sourcing?', type: 'textarea' },
                        { id: 's12', text: 'What reporting do you have on sourcing performance and savings?', type: 'textarea' },
                        { id: 's13', text: 'How do you manage supplier communication during the sourcing process?', type: 'textarea' },
                        { id: 's14', text: 'Do you use reverse auctions or other advanced sourcing techniques?', type: 'textarea' },
                        { id: 's15', text: 'How do you handle multi-currency sourcing events?', type: 'textarea' },
                        { id: 's16', text: 'What is the impact of manual sourcing on time-to-market for new products/services?', type: 'textarea' },
                        { id: 's17', text: 'How do you manage supplier qualifications and compliance during sourcing?', type: 'textarea' },
                        { id: 's18', text: 'What is your process for conducting spend analysis to identify sourcing opportunities?', type: 'textarea' },
                        { id: 's19', text: 'How do you ensure data security for sensitive sourcing information?', type: 'textarea' },
                        { id: 's20', text: 'What are your goals for improving sourcing efficiency and achieving greater savings?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_s1', text: 'Total annual spend under management', type: 'number', unit: '$' },
                        { id: 'roi_s2', text: 'Current average savings from sourcing', type: 'number', unit: '%' },
                        { id: 'roi_s3', text: 'Sourcing full-time employees', type: 'number', unit: 'FTEs' },
                        { id: 'roi_s4', text: 'Average annual salary + benefits for sourcing staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_s1: 10000000, roi_s2: 2, roi_s3: 2, roi_s4: 80000 },
                    roiCalculationFormulas: [
                        { name: 'Additional Savings from Sourcing', formula: (i,s) => i.totalSpend * ((i.currentSavings/100) * 0.03), inputs: { totalSpend: 'roi_s1', currentSavings: 'roi_s2' }, description: (i,s) => `(Target 3% additional savings on spend)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.20, inputs: { fteCount: 'roi_s3', avgSalary: 'roi_s4' }, description: (i,s) => `(20% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Claims & Deductions': {
                    questions: [
                        { id: 'cd1', text: 'How many customer claims/deductions do you receive per month?', type: 'number' },
                        { id: 'cd2', text: 'What is the average value of a claim/deduction?', type: 'number', unit: '$' },
                        { id: 'cd3', text: 'What percentage of claims are invalid or unauthorised?', type: 'number', unit: '%' },
                        { id: 'cd4', text: 'What is your average time to resolve a claim/deduction?', type: 'number', unit: 'Days' },
                        { id: 'cd5', text: 'How do you receive and log claims/deductions?', type: 'textarea' },
                        { id: 'cd6', text: 'How do you research and validate claims?', type: 'textarea' },
                        { id: 'cd7', text: 'How many FTEs are involved in claims and deductions management?', type: 'number', unit: 'FTEs' },
                        { id: 'cd8', text: 'What systems are involved in your claims resolution process?', type: 'textarea' },
                        { id: 'cd9', text: 'How do you communicate with customers regarding claim status and resolution?', type: 'textarea' },
                        { id: 'cd10', text: 'What is the biggest pain point in your current claims and deductions process?', type: 'textarea' },
                        { id: 'cd11', text: 'How do you track and report on claim types and root causes?', type: 'textarea' },
                        { id: 'cd12', text: 'What is the impact of unresolved claims on customer relationships and cash flow?', type: 'textarea' },
                        { id: 'cd13', text: 'How do you handle claims related to pricing, promotions, or damaged goods?', type: 'textarea' },
                        { id: 'cd14', text: 'Do you have a formal dispute resolution process for claims?', type: 'textarea' },
                        { id: 'cd15', text: 'How do you recover invalid deductions?', type: 'textarea' },
                        { id: 'cd16', text: 'What is the volume of chargebacks you receive?', type: 'number' },
                        { id: 'cd17', text: 'How do you ensure proper documentation for each claim?', type: 'textarea' },
                        { id: 'cd18', text: 'What is the average cost to process one claim/deduction?', type: 'number', unit: '$' },
                        { id: 'cd19', text: 'How do you identify and address recurring claim issues?', type: 'textarea' },
                        { id: 'cd20', text: 'What are your goals for improving claims resolution efficiency and reducing invalid deductions?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_cd1', text: 'Annual volume of claims/deductions', type: 'number' },
                        { id: 'roi_cd2', text: 'Annual value of invalid claims/deductions', type: 'number', unit: '$' },
                        { id: 'roi_cd3', text: 'Claims Management FTEs', type: 'number', unit: 'FTEs' },
                        { id: 'roi_cd4', text: 'Average annual salary + benefits for claims staff', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_cd1: 1200, roi_cd2: 40000, roi_cd3: 2, roi_cd4: 68000 },
                    roiCalculationFormulas: [
                        { name: 'Invalid Claims Savings', formula: (i,s) => i.invalidValue * 0.25, inputs: { invalidValue: 'roi_cd2' }, description: (i,s) => `(25% reduction in invalid claims)` },
                        { name: 'Productivity Gains', formula: (i,s) => (i.fteCount * i.avgSalary) * 0.50, inputs: { fteCount: 'roi_cd3', avgSalary: 'roi_cd4' }, description: (i,s) => `(50% productivity gain for ${i.fteCount} FTEs)` },
                    ]
                },
                'Invoice Delivery': {
                    questions: [
                        { id: 'id1', text: 'How many invoices do you deliver per month?', type: 'number' },
                        { id: 'id2', text: 'What percentage of invoices are delivered manually (e.g., postal mail, email attachments)?', type: 'number', unit: '%' },
                        { id: 'id3', text: 'What is your average cost per invoice for printing, postage, and archiving?', type: 'number', unit: '$' },
                        { id: 'id4', text: 'What is your current invoice delivery success rate?', type: 'number', unit: '%' },
                        { id: 'id5', text: 'How do you handle failed invoice deliveries or rejections?', type: 'textarea' },
                        { id: 'id6', text: 'How many FTEs are involved in invoice delivery activities?', type: 'number', unit: 'FTEs' },
                        { id: 'id7', text: 'What channels do you use for invoice delivery (e.g., email, EDI, portal, postal)?', type: 'textarea' },
                        { id: 'id8', text: 'How do you track and confirm invoice receipt by customers?', type: 'textarea' },
                        { id: 'id9', text: 'What challenges do you face with customer preferences for invoice format/delivery method?', type: 'textarea' },
                        { id: 'id10', text: 'What is the biggest pain point in your current invoice delivery process?', type: 'textarea' },
                        { id: 'id11', text: 'How does invoice delivery impact your DSO?', type: 'textarea' },
                        { id: 'id12', text: 'What reporting do you have on invoice delivery status and performance?', type: 'textarea' },
                        { id: 'id13', text: 'How do you ensure compliance with e-invoicing regulations (e.g., Peppol, local mandates)?', type: 'textarea' },
                        { id: 'id14', text: 'How do you handle multi-currency invoices?', type: 'textarea' },
                        { id: 'id15', text: 'What is your process for archiving delivered invoices?', type: 'textarea' },
                        { id: 'id16', text: 'How do you manage customer master data for delivery preferences?', type: 'textarea' },
                        { id: 'id17', text: 'What is the impact of slow or failed invoice delivery on customer satisfaction?', type: 'textarea' },
                        { id: 'id18', text: 'Do you use a customer portal for invoice access?', type: 'textarea' },
                        { id: 'id19', text: 'How do you handle large volumes of invoices efficiently?', type: 'textarea' },
                        { id: 'id20', text: 'What are your goals for improving invoice delivery speed, accuracy, and cost-efficiency?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_id1', text: 'Annual volume of invoices delivered', type: 'number' },
                        { id: 'roi_id2', text: 'Average cost per invoice for printing, postage, manual handling', type: 'number', unit: '$' },
                        { id: 'roi_id3', text: 'Percentage of invoices delivered manually', type: 'number', unit: '%' },
                    ],
                    demoRoiData: { roi_id1: 150000, roi_id2: 1.50, roi_id3: 40 },
                    roiCalculationFormulas: [
                        { name: 'Manual Delivery Savings', formula: (i,s) => i.annualInvoices * (i.manualPct/100) * i.manualCost * 0.80, inputs: { annualInvoices: 'roi_id1', manualCost: 'roi_id2', manualPct: 'roi_id3' }, description: (i,s) => `(80% savings on manual delivery costs)` },
                    ]
                }
            },
            'Business Automation': {
                'Document Management': {
                    questions: [
                        { id: 'dm1', text: 'How many knowledge workers are in the company?', type: 'number', unit: 'People' },
                        { id: 'dm2', text: 'On average, how many hours per week does an employee spend searching for documents or information?', type: 'number', unit: 'Hours' },
                        { id: 'dm3', text: 'What is the primary challenge with your current document storage (e.g., folder chaos, version control, security)?', type: 'textarea' },
                        { id: 'dm4', text: 'Do you have compliance or audit requirements for your documents? If so, describe them.', type: 'textarea' },
                        { id: 'dm5', text: 'Describe a recent situation where finding the correct version of a document was critical and difficult.', type: 'textarea' },
                        { id: 'dm6', text: 'How do you currently manage document access permissions?', type: 'textarea' },
                        { id: 'dm7', text: 'What is your process for archiving and disposing of old documents?', type: 'textarea' },
                        { id: 'dm8', text: 'Are employees able to access necessary documents securely when working remotely?', type: 'textarea' },
                        { id: 'dm9', text: 'How much physical office space is dedicated to document storage?', type: 'number', unit: 'Sq. Ft.' },
                        { id: 'dm10', text: 'How are documents shared with external parties (clients, partners)?', type: 'textarea' },
                        { id: 'dm11', text: 'What is the business impact of a lost or misfiled document?', type: 'textarea' },
                        { id: 'dm12', text: 'How do you handle metadata or tagging for documents to improve searchability?', type: 'textarea' },
                        { id: 'dm13', text: 'Describe the process for reviewing and approving documents.', type: 'textarea' },
                        { id: 'dm14', text: 'What are your goals for improving document management?', type: 'textarea' },
                        { id: 'dm15', text: 'How do you ensure consistency in file naming and organization?', type: 'textarea' },
                        { id: 'dm16', text: 'What types of documents are most critical to your business operations (e.g., contracts, invoices, HR records)?', type: 'textarea' },
                        { id: 'dm17', text: 'How do you manage the lifecycle of a document from creation to archival?', type: 'textarea' },
                        { id: 'dm18', text: 'What is the estimated volume of new documents created each month?', type: 'number' },
                        { id: 'dm19', text: 'Are there any security concerns with your current document management practices?', type: 'textarea' },
                        { id: 'dm20', text: 'How satisfied are employees with the current system for finding and managing information?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_dm1', text: 'Number of knowledge workers', type: 'number' },
                        { id: 'roi_dm2', text: 'Average annual fully-loaded salary for a knowledge worker', type: 'number', unit: '$' },
                        { id: 'roi_dm3', text: 'Average hours per week spent searching for documents', type: 'number', unit: 'Hours' },
                        { id: 'roi_dm4', text: 'Annual cost of external storage (physical or digital)', type: 'number', unit: '$' },
                        { id: 'roi_dm5', text: 'Number of compliance/audit failures or incidents per year', type: 'number' },
                        { id: 'roi_dm6', text: 'Average cost per compliance incident', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_dm1: 100, roi_dm2: 85000, roi_dm3: 5, roi_dm4: 10000, roi_dm5: 2, roi_dm6: 25000 },
                    roiCalculationFormulas: [
                        { name: 'Productivity Gain (Reduced Search Time)', formula: (i,s) => (i.workers * i.hoursPerWeek * 52) * (i.avgSalary / FTE_HOURS_PER_YEAR) * 0.80, inputs: { workers: 'roi_dm1', avgSalary: 'roi_dm2', hoursPerWeek: 'roi_dm3' }, description: (i,s) => `(80% of time saved for ${i.workers} workers)` },
                        { name: 'Storage Cost Reduction', formula: (i,s) => i.storageCost * 0.50, inputs: { storageCost: 'roi_dm4' }, description: (i,s) => `(50% reduction in storage costs)` },
                        { name: 'Compliance Risk Reduction', formula: (i,s) => i.incidents * i.costPerIncident * 0.90, inputs: { incidents: 'roi_dm5', costPerIncident: 'roi_dm6' }, description: (i,s) => `(90% reduction in compliance incident costs)` }
                    ]
                },
                'Workflow Management': {
                    questions: [
                        { id: 'wm1', text: 'How many repetitive, manual processes could be automated (e.g., approvals, notifications, data entry)?', type: 'number' },
                        { id: 'wm2', text: 'Describe one key process that is currently slow or error-prone due to manual steps.', type: 'textarea' },
                        { id: 'wm3', text: 'How do employees currently request services or approvals from other departments (e.g., IT, HR)?', type: 'textarea' },
                        { id: 'wm4', text: 'What is the business impact of delays in these manual processes?', type: 'textarea' },
                        { id: 'wm5', text: 'How are tasks and responsibilities assigned and tracked within a process?', type: 'textarea' },
                        { id: 'wm6', text: 'What is the average cycle time for a key approval process (e.g., capital expenditure)?', type: 'number', unit: 'Days' },
                        { id: 'wm7', text: 'How do you handle exceptions or escalations in your current workflows?', type: 'textarea' },
                        { id: 'wm8', text: 'Is there a lack of visibility into where a process is at any given time?', type: 'textarea' },
                        { id: 'wm9', text: 'How much time do managers spend chasing status updates on tasks?', type: 'number', unit: 'Hours/Week' },
                        { id: 'wm10', text: 'What systems do you need to integrate to create a seamless end-to-end process?', type: 'textarea' },
                        { id: 'wm11', text: 'How easy is it for business users to build or modify their own workflows?', type: 'textarea' },
                        { id: 'wm12', text: 'Describe the employee onboarding or offboarding process.', type: 'textarea' },
                        { id: 'wm13', text: 'How are forms created and distributed for data collection?', type: 'textarea' },
                        { id: 'wm14', text: 'What are the compliance or audit trail requirements for your key processes?', type: 'textarea' },
                        { id: 'wm15', text: 'How do you measure the performance and efficiency of your business processes?', type: 'textarea' },
                        { id: 'wm16', text: 'What is the biggest opportunity you see for process automation in your organization?', type: 'textarea' },
                        { id: 'wm17', text: 'How are mobile workers included in your current processes?', type: 'textarea' },
                        { id: 'wm18', text: 'What is the estimated cost of a single error in a key manual process?', type: 'number', unit: '$' },
                        { id: 'wm19', text: 'How do you ensure process consistency across different teams or locations?', type: 'textarea' },
                        { id: 'wm20', text: 'What are your top 3 goals for implementing workflow automation?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_wm1', text: 'Number of processes to automate', type: 'number' },
                        { id: 'roi_wm2', text: 'Average hours saved per automated process, per year', type: 'number', unit: 'Hours' },
                        { id: 'roi_wm3', text: 'Average hourly cost of employees performing these tasks', type: 'number', unit: '$' },
                        { id: 'roi_wm4', text: 'Estimated annual cost of errors from manual processes', type: 'number', unit: '$' },
                        { id: 'roi_wm5', text: 'Number of audit/compliance activities per year', type: 'number' },
                        { id: 'roi_wm6', text: 'Hours spent preparing for each audit/compliance activity', type: 'number', unit: 'Hours' },
                    ],
                    demoRoiData: { roi_wm1: 20, roi_wm2: 100, roi_wm3: 40, roi_wm4: 15000, roi_wm5: 4, roi_wm6: 20 },
                    roiCalculationFormulas: [
                        { name: 'Productivity Savings from Automation', formula: (i,s) => i.processes * i.hoursSaved * i.hourlyCost, inputs: { processes: 'roi_wm1', hoursSaved: 'roi_wm2', hourlyCost: 'roi_wm3' }, description: (i,s) => `(${i.processes} processes * ${i.hoursSaved} hrs/yr * $${i.hourlyCost}/hr)` },
                        { name: 'Error Reduction Savings', formula: (i,s) => i.errorCost * 0.90, inputs: { errorCost: 'roi_wm4' }, description: (i,s) => `(90% reduction in manual error costs)` },
                        { name: 'Audit Preparation Savings', formula: (i,s) => i.audits * i.auditHours * i.hourlyCost * 0.5, inputs: { audits: 'roi_wm5', auditHours: 'roi_wm6', hourlyCost: 'roi_wm3' }, description: (i,s) => `(50% time reduction for audit prep)` },
                    ]
                },
                'Process Mapping': {
                    questions: [
                        { id: 'pm1', text: 'How are your business processes currently documented (e.g., Word, Visio, tribal knowledge)?', type: 'textarea' },
                        { id: 'pm2', text: 'How long does it typically take to onboard a new employee for a key operational role?', type: 'number', unit: 'Days' },
                        { id: 'pm3', text: 'How do you currently identify bottlenecks or areas for improvement in your processes?', type: 'textarea' },
                        { id: 'pm4', text: 'Is there a consistent, agreed-upon "single source of truth" for how processes should be executed?', type: 'textarea' },
                        { id: 'pm5', text: 'How often are your process documents reviewed and updated?', type: 'textarea' },
                        { id: 'pm6', text: 'How do you manage feedback and suggestions for process improvements from staff?', type: 'textarea' },
                        { id: 'pm7', text: 'What is the estimated cost of process non-conformance or inconsistency per year?', type: 'number', unit: '$' },
                        { id: 'pm8', text: 'How are process changes communicated and rolled out to the organization?', type: 'textarea' },
                        { id: 'pm9', text: 'Do you have a clear understanding of process ownership and responsibilities?', type: 'textarea' },
                        { id: 'pm10', text: 'How much time is spent in meetings trying to define or clarify an existing process?', type: 'number', unit: 'Hours/Month' },
                        { id: 'pm11', text: 'What is the level of employee engagement in process improvement initiatives?', type: 'textarea' },
                        { id: 'pm12', text: 'How do you ensure your processes align with strategic business goals?', type: 'textarea' },
                        { id: 'pm13', text: 'Describe a situation where a lack of clear process documentation led to a negative outcome.', type: 'textarea' },
                        { id: 'pm14', text: 'How easy is it for employees to find the process information they need to do their jobs?', type: 'textarea' },
                        { id: 'pm15', text: 'What is your methodology for continuous process improvement (e.g., Lean, Six Sigma)?', type: 'textarea' },
                        { id: 'pm16', text: 'How do you assess the risk associated with your key business processes?', type: 'textarea' },
                        { id: 'pm17', text: 'What are your top 3 goals for implementing a process mapping and management solution?', type: 'textarea' },
                        { id: 'pm18', text: 'How do you manage variations of a single process across different departments or regions?', type: 'textarea' },
                        { id: 'pm19', text: 'Are process metrics and KPIs currently tracked and reported on?', type: 'textarea' },
                        { id: 'pm20', text: 'How does process knowledge leave the company when an experienced employee retires or resigns?', type: 'textarea' },
                    ],
                    roiQuestions: [
                        { id: 'roi_pm1', text: 'Number of new hires per year requiring process training', type: 'number' },
                        { id: 'roi_pm2', text: 'Average hours of training per new hire', type: 'number', unit: 'Hours' },
                        { id: 'roi_pm3', text: 'Average hourly cost of a new hire and their trainer (combined)', type: 'number', unit: '$' },
                        { id: 'roi_pm4', text: 'Total annual salary cost for all employees in operational roles', type: 'number', unit: '$' },
                        { id: 'roi_pm5', text: 'Number of continuous improvement projects per year', type: 'number' },
                        { id: 'roi_pm6', text: 'Average savings per improvement project', type: 'number', unit: '$' },
                    ],
                    demoRoiData: { roi_pm1: 25, roi_pm2: 40, roi_pm3: 50, roi_pm4: 2000000, roi_pm5: 5, roi_pm6: 10000 },
                    roiCalculationFormulas: [
                        { name: 'Reduced Onboarding & Training Time', formula: (i,s) => i.newHires * i.trainingHours * i.hourlyCost * 0.30, inputs: { newHires: 'roi_pm1', trainingHours: 'roi_pm2', hourlyCost: 'roi_pm3' }, description: (i,s) => `(30% training time reduction for ${i.newHires} new hires)` },
                        { name: 'Operational Efficiency Gains', formula: (i,s) => i.opSalaryCost * 0.03, inputs: { opSalaryCost: 'roi_pm4' }, description: (i,s) => `(3% efficiency gain on $${i.opSalaryCost.toFixed(2)} operational salaries)` },
                        { name: 'Accelerated Continuous Improvement', formula: (i,s) => i.projects * i.avgSavings * 0.25, inputs: { projects: 'roi_pm5', avgSavings: 'roi_pm6' }, description: (i,s) => `(25% increase in value from improvement projects)` },
                    ]
                }
            }
        };

        const scorecardQuestions = [ { id: 'os1', text: "Customer's business needs align to our capability?" }, { id: 'os2', text: 'We have access to all the key buying influences?' }, { id: 'os3', text: 'We have at least one Coach?' }, { id: 'os4', text: 'We can differentiate our solution from the competition and demonstrate value?' }, { id: 'os5', text: 'Customer has engaged us early in the process?' }, ];
        const scorecardAnswerOptions = ['Yes', 'No', 'Unknown'];
        const scorecardYesPoints = 20;

        let allModuleData = {};
        let selectedStream = '';
        let selectedModule = '';
        let currentView = 'scorecard';

        const streamSelect = document.getElementById('stream-select');
        const moduleSelect = document.getElementById('module-select');
        const appContent = document.getElementById('app-content');
        const exportSuccessMessage = document.getElementById('export-success-message');
        const copySuccessMessage = document.getElementById('copy-success-message');
        const validationErrorMessage = document.getElementById('validation-error-message');
        const closeValidationErrorButton = document.getElementById('close-validation-error');
        const clearFormButton = document.getElementById('clear-form-button');
        const exportDataButton = document.getElementById('export-data-button');
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmClearButton = document.getElementById('confirm-clear-button');
        const cancelClearButton = document.getElementById('cancel-clear-button');

        const getCurrentModuleState = () => selectedModule ? (allModuleData[selectedModule] || (allModuleData[selectedModule] = { discoveryAnswers: {}, roiAnswers: {}, eskerSubscriptionCost: '', professionalServicesCost: '', numberOfYearsUtilized: '3', additionalDiscoveryNotes: [], calculatedRoi: null, scorecardAnswers: {}, calculatedScorecard: null, currentView: 'scorecard' })) : null;
        const showMessage = (el) => el.classList.remove('hidden');
        const hideMessage = (el) => el.classList.add('hidden');
        const showConfirmationModal = () => { confirmationModal.style.display = 'flex'; }
        const hideConfirmationModal = () => { confirmationModal.style.display = 'none'; }

        function populateStreamDropdown() {
            streamSelect.innerHTML = '<option value="">-- Choose Business Stream --</option>';
            Object.keys(appModules).forEach(streamName => {
                const option = document.createElement('option');
                option.value = streamName;
                option.textContent = streamName;
                streamSelect.appendChild(option);
            });
        }

        function populateModuleDropdown(stream) {
            moduleSelect.innerHTML = '<option value="">-- Choose Module --</option>';
            if (stream && appModules[stream]) {
                Object.keys(appModules[stream]).forEach(moduleName => {
                    const option = document.createElement('option');
                    option.value = moduleName;
                    option.textContent = moduleName;
                    moduleSelect.appendChild(option);
                });
            } else {
                 moduleSelect.innerHTML = '<option value="">-- Choose Stream First --</option>';
            }
        }

        function getPlaceholder(q) {
            if (q.type === 'textarea') return 'Enter text response...';
            if (q.type === 'number') {
                return `Enter value ${q.unit ? '(' + q.unit + ')' : ''}`;
            }
            return '';
        }

        function renderAppContent() {
            appContent.innerHTML = '';
            if (!selectedModule) {
                appContent.innerHTML = `<div class="text-center py-10 text-gray-500 text-xl">Please select a stream and module to begin.</div>`;
                return;
            }

            const state = getCurrentModuleState();
            const moduleData = appModules[selectedStream][selectedModule];
            currentView = state.currentView;

            appContent.innerHTML = `<div class="flex justify-center mb-6">
                <button id="scorecard-tab" class="px-6 py-3 text-lg font-medium ${currentView === 'scorecard' ? 'bg-ms-blue text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">Scorecard</button>
                <button id="discovery-tab" class="px-6 py-3 text-lg font-medium ${currentView === 'discovery' ? 'bg-ms-blue text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">Discovery</button>
                <button id="roi-tab" class="px-6 py-3 text-lg font-medium ${currentView === 'roi' ? 'bg-ms-blue text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">ROI</button>
            </div>`;

            const viewContainer = document.createElement('div');
            viewContainer.className = "bg-white p-6 rounded-xl shadow-inner";
            const viewTitle = currentView.charAt(0).toUpperCase() + currentView.slice(1);
            viewContainer.innerHTML = `<h2 class="text-2xl font-bold text-blue-700 mb-4 text-center">${viewTitle}: ${selectedModule}</h2>`;

            if (currentView === 'scorecard') {
                viewContainer.innerHTML += scorecardQuestions.map((q, index) => `
                    <div class="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <label class="block text-md font-semibold text-gray-700 mb-2">${index + 1}. ${q.text}</label>
                        <div class="flex flex-wrap gap-x-6 gap-y-2">
                            ${scorecardAnswerOptions.map(option => `<label class="inline-flex items-center"><input type="radio" name="${q.id}" value="${option}" class="form-radio h-5 w-5 text-ms-blue" ${state.scorecardAnswers[q.id] === option ? 'checked' : ''}> <span class="ml-2">${option}</span></label>`).join('')}
                        </div>
                    </div>`).join('');
                viewContainer.innerHTML += `<div id="scorecard-results" class="mt-8 p-6 bg-blue-50 border-blue-200 rounded-lg shadow-md text-center"></div>`;
                appContent.appendChild(viewContainer);
                scorecardQuestions.forEach(q => document.getElementsByName(q.id).forEach(radio => radio.addEventListener('change', (e) => { state.scorecardAnswers[q.id] = e.target.value; calculateScorecard(); })));
                calculateScorecard();
            } else if (currentView === 'discovery') {
                viewContainer.innerHTML += moduleData.questions.map((q, index) => `
                    <div class="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <label for="${q.id}" class="block text-md font-semibold text-gray-700 mb-2">${index + 1}. ${q.text}</label>
                        ${q.type === 'textarea' ? `<textarea id="${q.id}" rows="4" class="w-full p-2 border rounded-md" placeholder="${getPlaceholder(q)}">${state.discoveryAnswers[q.id] || ''}</textarea>` : `<input id="${q.id}" type="${q.type}" value="${state.discoveryAnswers[q.id] || ''}" class="w-full p-2 border rounded-md" placeholder="${getPlaceholder(q)}">`}
                    </div>`).join('');
                viewContainer.innerHTML += `
                    <div class="mt-8 p-4 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">Additional Discovery Notes</h3>
                        <div id="additional-notes-container" class="space-y-4"></div>
                        <button id="add-note-button" class="mt-4 flex items-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Add Note</button>
                    </div>`;
                if (discoveryToRoiMapping[selectedStream] && discoveryToRoiMapping[selectedStream][selectedModule]) {
                    viewContainer.innerHTML += `<div class="flex justify-center mt-6"><button id="copy-to-roi-button" class="flex items-center bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg">Copy to ROI</button></div>`;
                }
                appContent.appendChild(viewContainer);
                moduleData.questions.forEach(q => document.getElementById(q.id).addEventListener('input', e => state.discoveryAnswers[q.id] = e.target.value));
                if (document.getElementById('copy-to-roi-button')) {
                    document.getElementById('copy-to-roi-button').addEventListener('click', copyDiscoveryToRoi);
                }
                renderAdditionalNotes();
            } else if (currentView === 'roi') {
                viewContainer.innerHTML += `
                    <div class="mb-6 p-4 border-ms-blue-light rounded-lg bg-blue-50"><label class="block font-semibold">Annual Subscription Cost ($)</label><input id="annual-subscription-cost" type="number" value="${state.eskerSubscriptionCost}" class="w-full p-2 border rounded-md" placeholder="Enter value ($)"></div>
                    <div class="mb-6 p-4 border-ms-blue-light rounded-lg bg-blue-50"><label class="block font-semibold">Professional Services Cost ($)</label><input id="professional-services-cost" type="number" value="${state.professionalServicesCost}" class="w-full p-2 border rounded-md" placeholder="Enter value ($)"></div>
                    <div class="mb-6 p-4 border-ms-blue-light rounded-lg bg-blue-50"><label class="block font-semibold">Years Utilised</label><input id="number-of-years-utilized" type="number" value="${state.numberOfYearsUtilized}" class="w-full p-2 border rounded-md" placeholder="Enter value (Years)"></div>
                    ${moduleData.roiQuestions.map((q, index) => `<div class="mb-6 p-4 border rounded-lg bg-gray-50"><label for="${q.id}" class="block font-semibold">${index + 1}. ${q.text}</label><input id="${q.id}" type="number" value="${state.roiAnswers[q.id] || ''}" class="w-full p-2 border rounded-md" placeholder="${getPlaceholder(q)}"></div>`).join('')}
                    <div class="flex justify-center gap-4 mt-6">
                        <button id="calculate-roi-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6">Calculate ROI</button>
                        <button id="populate-demo-data-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6">Demo Data</button>
                    </div>
                    <div id="roi-results" class="mt-8"></div>`;
                appContent.appendChild(viewContainer);
                document.getElementById('annual-subscription-cost').addEventListener('input', e => state.eskerSubscriptionCost = e.target.value);
                document.getElementById('professional-services-cost').addEventListener('input', e => state.professionalServicesCost = e.target.value);
                document.getElementById('number-of-years-utilized').addEventListener('input', e => state.numberOfYearsUtilized = e.target.value);
                moduleData.roiQuestions.forEach(q => document.getElementById(q.id).addEventListener('input', e => state.roiAnswers[q.id] = e.target.value));
                document.getElementById('calculate-roi-button').addEventListener('click', calculateRoi);
                document.getElementById('populate-demo-data-button').addEventListener('click', populateDemoData);
                if (state.calculatedRoi) renderRoiResults(state.calculatedRoi);
            }
            document.getElementById('scorecard-tab').addEventListener('click', () => { state.currentView = 'scorecard'; renderAppContent(); });
            document.getElementById('discovery-tab').addEventListener('click', () => { state.currentView = 'discovery'; renderAppContent(); });
            document.getElementById('roi-tab').addEventListener('click', () => { state.currentView = 'roi'; renderAppContent(); });
        }

        function calculateScorecard() {
            const state = getCurrentModuleState();
            if (!state) return;
            state.calculatedScorecard = scorecardQuestions.reduce((score, q) => score + (state.scorecardAnswers[q.id] === 'Yes' ? scorecardYesPoints : 0), 0);
            const resultsEl = document.getElementById('scorecard-results');
            if (resultsEl) {
                const maxScore = scorecardQuestions.length * scorecardYesPoints;
                resultsEl.innerHTML = `<h3 class="text-xl font-bold text-blue-700 mb-2">Opportunity Score</h3><p class="text-4xl font-bold text-purple-700">${state.calculatedScorecard} / ${maxScore}</p>`;
            }
        }
        
        function calculateRoi() {
            const state = getCurrentModuleState();
            if (!state) return;
            hideMessage(validationErrorMessage);
            const moduleData = appModules[selectedStream][selectedModule];
            const annualSub = parseFloat(state.eskerSubscriptionCost);
            const profServices = parseFloat(state.professionalServicesCost);
            const years = parseInt(state.numberOfYearsUtilized, 10);
            const roiInputs = {};
            let allValid = !isNaN(annualSub) && !isNaN(profServices) && !isNaN(years) && years > 0;
            moduleData.roiQuestions.forEach(q => {
                const val = parseFloat(state.roiAnswers[q.id]);
                if (isNaN(val)) allValid = false;
                roiInputs[q.id] = val;
            });

            if (!allValid) {
                state.calculatedRoi = null;
                showMessage(validationErrorMessage);
                renderAppContent();
                return;
            }

            let totalAnnualSavings = 0;
            let detailedSavingsBreakdown = {};
            moduleData.roiCalculationFormulas.forEach(formulaDef => {
                const inputs = {};
                let inputsValid = true;
                Object.keys(formulaDef.inputs).forEach(key => {
                    const value = roiInputs[formulaDef.inputs[key]];
                    if (isNaN(value)) inputsValid = false;
                    inputs[key] = value;
                });
                
                if (inputsValid) {
                    const savings = formulaDef.formula(inputs, state) || 0;
                    totalAnnualSavings += savings;
                    detailedSavingsBreakdown[formulaDef.name] = `${formulaDef.description(inputs, state)} = $${savings.toFixed(2)}`;
                }
            });

            const totalInvestment = profServices + (annualSub * years);
            const totalBenefit = totalAnnualSavings * years;
            const netBenefit = totalBenefit - totalInvestment;
            const roiPercentage = totalInvestment > 0 ? (netBenefit / totalInvestment) * 100 : 0;
            const paybackMonths = (totalAnnualSavings > annualSub) ? (profServices / (totalAnnualSavings - annualSub)) * 12 : Infinity;
            
            const annualBreakdown = [];
            let cumulativeInvestment = 0, cumulativeBenefit = 0;
            for (let i = 1; i <= years; i++) {
                const yearInvestment = (i === 1 ? profServices : 0) + annualSub;
                cumulativeInvestment += yearInvestment;
                cumulativeBenefit += totalAnnualSavings;
                const cumulativeNetBenefit = cumulativeBenefit - cumulativeInvestment;
                const cumulativeRoiPercentage = cumulativeInvestment > 0 ? (cumulativeNetBenefit / cumulativeInvestment) * 100 : 0;
                annualBreakdown.push({ year: i, annualInvestment: yearInvestment.toFixed(2), annualSavings: totalAnnualSavings.toFixed(2), netAnnualBenefit: (totalAnnualSavings - yearInvestment).toFixed(2), cumulativeInvestment: cumulativeInvestment.toFixed(2), cumulativeBenefit: cumulativeBenefit.toFixed(2), cumulativeRoiPercentage: cumulativeRoiPercentage.toFixed(2) });
            }

            state.calculatedRoi = { totalAnnualSavings: totalAnnualSavings.toFixed(2), annualEskerInvestment: annualSub.toFixed(2), netAnnualBenefit: (totalAnnualSavings - annualSub).toFixed(2), totalInvestmentOverYears: totalInvestment.toFixed(2), totalBenefitOverYears: totalBenefit.toFixed(2), netBenefitOverYears: netBenefit.toFixed(2), roiPercentage: roiPercentage.toFixed(2), paybackPeriodMonths: isFinite(paybackMonths) && paybackMonths >= 0 ? paybackMonths.toFixed(1) : "N/A", annualBreakdown, detailedSavingsBreakdown };
            renderRoiResults(state.calculatedRoi);
        }
        
        function renderRoiResults(roi) {
            const resultsEl = document.getElementById('roi-results');
            if (!resultsEl || !roi) return;
            resultsEl.innerHTML = `
                <div class="p-6 bg-blue-50 border-blue-200 rounded-lg">
                    <h3 class="text-xl font-bold text-center mb-4">ROI Summary</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                        <p class="font-semibold">Total Annual Savings:</p><p class="text-right text-green-700 font-bold">$${roi.totalAnnualSavings}</p>
                        <p class="font-semibold">Net Annual Benefit:</p><p class="text-right text-blue-800 font-bold">$${roi.netAnnualBenefit}</p>
                        <p class="font-semibold text-xl">Total Investment (${getCurrentModuleState().numberOfYearsUtilized} Yrs):</p><p class="text-right text-xl text-red-700 font-bold">$${roi.totalInvestmentOverYears}</p>
                        <p class="font-semibold text-xl">Total Benefit (${getCurrentModuleState().numberOfYearsUtilized} Yrs):</p><p class="text-right text-xl text-green-700 font-bold">$${roi.totalBenefitOverYears}</p>
                        <p class="font-semibold text-2xl">Net Benefit (${getCurrentModuleState().numberOfYearsUtilized} Yrs):</p><p class="text-right text-2xl font-bold text-blue-800">$${roi.netBenefitOverYears}</p>
                        <p class="font-semibold text-3xl">ROI Percentage:</p><p class="text-right text-3xl font-bold text-purple-700">${roi.roiPercentage}%</p>
                        <p class="font-semibold text-2xl">Payback Period:</p><p class="text-right text-2xl font-bold text-orange-700">${roi.paybackPeriodMonths} Months</p>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-gray-50 border-gray-200 rounded-lg"><h3 class="text-xl font-bold text-center mb-4">Annual Breakdown</h3>
                    <div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100"><tr>${['Year', 'Annual Inv ($)', 'Annual Sav ($)', 'Net Benefit ($)', 'Cum. Inv ($)', 'Cum. Ben ($)', 'Cum. ROI (%)'].map(h => `<th class="px-6 py-3 text-left text-xs font-medium uppercase">${h}</th>`).join('')}</tr></thead>
                        <tbody class="bg-white divide-y">${roi.annualBreakdown.map(y => `<tr>${Object.values(y).map(v => `<td class="px-6 py-4 whitespace-nowrap text-sm">${v}</td>`).join('')}</tr>`).join('')}</tbody>
                    </table></div>
                </div>`;
        }
        
        function renderAdditionalNotes() {
            const notesContainer = document.getElementById('additional-notes-container');
            if (!notesContainer) return;
            notesContainer.innerHTML = '';
            const state = getCurrentModuleState();
            if (!state) return;
            state.additionalDiscoveryNotes.forEach(note => {
                const noteDiv = document.createElement('div');
                noteDiv.className = 'flex items-start space-x-2 mb-2';
                noteDiv.innerHTML = `<textarea rows="3" class="flex-grow p-2 border rounded-md" placeholder="Enter additional discovery details here...">${note.text || ''}</textarea><button class="delete-note-button p-2 bg-red-500 hover:bg-red-600 text-white rounded-md">X</button>`;
                noteDiv.querySelector('textarea').addEventListener('input', e => note.text = e.target.value);
                noteDiv.querySelector('.delete-note-button').addEventListener('click', () => {
                    state.additionalDiscoveryNotes = state.additionalDiscoveryNotes.filter(n => n.id !== note.id);
                    renderAdditionalNotes();
                });
                notesContainer.appendChild(noteDiv);
            });
            document.getElementById('add-note-button').onclick = () => { state.additionalDiscoveryNotes.push({ id: Date.now(), text: '' }); renderAdditionalNotes(); };
        }
        
        function copyDiscoveryToRoi() {
            const state = getCurrentModuleState();
            if (!state || !selectedModule || !selectedStream) return;
            const mappingForStream = discoveryToRoiMapping[selectedStream];
            if (!mappingForStream) return;
            const mappings = mappingForStream[selectedModule];
            if (!mappings) return;

            mappings.forEach(map => {
                const discoveryValue = state.discoveryAnswers[map.discoveryId];
                if (discoveryValue !== undefined && discoveryValue !== '') {
                    let valueToCopy = map.transform ? map.transform(discoveryValue) : discoveryValue;
                    state.roiAnswers[map.roiId] = valueToCopy;
                }
            });
            showMessage(copySuccessMessage);
            setTimeout(() => hideMessage(copySuccessMessage), 3000);
            if (currentView === 'discovery') {
                state.currentView = 'roi';
            }
            renderAppContent();
        }

        function populateDemoData() {
            const state = getCurrentModuleState();
            const demoData = appModules[selectedStream][selectedModule].demoRoiData;
            if (state && demoData) {
                state.roiAnswers = { ...demoData };
                renderAppContent();
            }
        }
        
        function getReportData() {
            const state = getCurrentModuleState();
            if (!state) return null;
            const moduleData = appModules[selectedStream][selectedModule];
            return {
                stream: selectedStream,
                moduleName: selectedModule,
                scorecard: { questions: scorecardQuestions, answers: state.scorecardAnswers, score: state.calculatedScorecard, maxScore: scorecardQuestions.length * scorecardYesPoints },
                discovery: { questions: moduleData.questions, answers: state.discoveryAnswers, notes: state.additionalDiscoveryNotes },
                roi: { questions: moduleData.roiQuestions, inputs: { ...state.roiAnswers, annualSub: state.eskerSubscriptionCost, profServices: state.professionalServicesCost, years: state.numberOfYearsUtilized }, results: state.calculatedRoi }
            };
        }

        function generateAIPromptContent(data) {
            let prompt = `You are an expert business analyst... (Full prompt logic here as in original file, adapted for new data structure)`;
            prompt = `You are an expert business analyst providing concise and actionable insights on process improvement and technology adoption. Your task is to analyse the provided information for a client interested in optimising their ${data.moduleName} process and evaluating the opportunity fit.

Based on the detailed information below, please provide:
1.  **Opportunity Scorecard Analysis:** Based on the Yes/No/Unknown answers and the total score (${data.scorecard.score} out of ${data.scorecard.maxScore}), analyse the overall fit and strength of this opportunity. Highlight any specific "No" answers that represent significant risks or challenges for a successful project.
2.  **Key Challenges and Opportunities from Discovery:** Provide a concise summary of the most critical pain points and areas for improvement identified from the discovery answers.
3.  **Summary of Financial Benefits and Investments:** Highlight the most significant financial benefits (savings) and the total investment over the specified years, based on the ROI calculation output. Include the overall Net Benefit and ROI Percentage.
4.  **Strategic Recommendations for Process Improvement and Technology Adoption:** Describe how a suitable digital solution can address the identified challenges and achieve the calculated benefits within the ${data.moduleName} process. Explicitly link recommendations back to points raised in the Discovery or ROI sections.
    **Important:** Frame recommendations generally (e.g., 'an automation platform', 'a digital solution', 'a cloud-based system').
5.  **Ensure all spelling in your response aligns with Australian English.**
6.  **If you cannot provide a comprehensive response for a specific section based on the information provided (e.g., ROI not calculated, or critical discovery questions unanswered), please explicitly state 'Insufficient data to provide a comprehensive response for [specific section].' Do not guess or make up information.**

---
### Business Stream: ${data.stream}
### Module: ${data.moduleName}
---
### Opportunity Scorecard Information:
Total Score: ${data.scorecard.score !== null ? data.scorecard.score : '--'} / ${data.scorecard.maxScore}

Question & Answer Breakdown:\n`;
            data.scorecard.questions.forEach(q => {
                prompt += `- ${q.text}: ${data.scorecard.answers[q.id] || 'Unknown'}\n`;
            });

            prompt += `
---
### Client Discovery Information:
`;
            data.discovery.questions.forEach(q => {
                prompt += `\nQuestion: ${q.text}\nAnswer: ${data.discovery.answers[q.id] || 'N/A'}`;
            });
            if (data.discovery.notes && data.discovery.notes.length > 0) {
                prompt += `\n\nAdditional Discovery Notes:`;
                data.discovery.notes.forEach((note, index) => {
                    prompt += `\n- Note ${index + 1}: ${note.text || 'N/A'}`;
                });
            }

            prompt += `\n---
### ROI Calculation Data:
`;
            if (data.roi.results) {
                const roi = data.roi;
                prompt += `
**Investment Inputs:**
- Annual Subscription Cost: $${roi.inputs.annualSub || 'N/A'}
- Professional Services Upfront Cost: $${roi.inputs.profServices || 'N/A'}
- Number of Years Software Will Be Utilised For: ${roi.inputs.years || 'N/A'} Years

**Detailed ROI Question Inputs:**
`;
                roi.questions.forEach(q => {
                    prompt += `- ${q.text}: ${roi.inputs[q.id] || 'N/A'}\n`;
                });

                prompt += `
**Calculated ROI Summary (${roi.inputs.years || 3} Years):**
- Total Annual Savings: $${roi.results.totalAnnualSavings}
- Net Annual Benefit: $${roi.results.netAnnualBenefit}
- Total Investment: $${roi.results.totalInvestmentOverYears}
- Total Benefit: $${roi.results.totalBenefitOverYears}
- Net Benefit: $${roi.results.netBenefitOverYears}
- ROI Percentage: ${roi.results.roiPercentage}%
- Payback Period: ${roi.results.paybackPeriodMonths} Months

**Detailed Annual Savings Breakdown:**
`;
                Object.entries(roi.results.detailedSavingsBreakdown).forEach(([key, value]) => {
                    prompt += `- ${key}: ${value}\n`;
                });

            } else {
                prompt += `\nROI has not been calculated.`;
            }
            prompt += `\n---
Please provide your analysis now.`;
            return prompt;
        }
        
        function exportData() {
            if (!selectedModule) { showMessage(validationErrorMessage); return; }
            const data = getReportData();
            if (!data) return;
            const format = document.querySelector('input[name="export-format"]:checked').value;
            let content, filename = `${data.stream}_${data.moduleName}_Report`.replace(/\s/g, '_'), mimeType;

            if (format === 'ai-prompt') {
                content = generateAIPromptContent(data);
                filename = `${data.stream}_${data.moduleName}_AI_Prompt`.replace(/\s/g, '_') + '.txt';
                mimeType = 'text/plain;charset=utf-8';
            } else {
                 // Simplified text/md/html for demonstration purposes. In a real scenario, you'd have full formatters.
                 content = JSON.stringify(data, null, 2);
                 filename += '.json';
                 mimeType = 'application/json';
            }
            
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            showMessage(exportSuccessMessage);
            setTimeout(() => hideMessage(exportSuccessMessage), 3000);
        }

        streamSelect.addEventListener('change', (e) => {
            selectedStream = e.target.value;
            selectedModule = '';
            moduleSelect.value = '';
            populateModuleDropdown(selectedStream);
            renderAppContent();
        });

        moduleSelect.addEventListener('change', (e) => {
            selectedModule = e.target.value;
            if (selectedModule) {
                const state = getCurrentModuleState();
                currentView = state.currentView;
            }
            renderAppContent();
        });

        clearFormButton.addEventListener('click', showConfirmationModal);
        confirmClearButton.addEventListener('click', () => { if (selectedModule) { delete allModuleData[selectedModule]; renderAppContent(); } hideConfirmationModal(); });
        cancelClearButton.addEventListener('click', hideConfirmationModal);
        closeValidationErrorButton.addEventListener('click', () => hideMessage(validationErrorMessage));
        exportDataButton.addEventListener('click', exportData);

        window.onload = () => {
            populateStreamDropdown();
            renderAppContent();
        };

    </script>
</body>
</html>
